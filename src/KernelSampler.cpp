#include "main.h"
#include "KernelSampler.h"

#define USE_SSE2
#include "sse_mathfun.h"

//precomputed Mie phase (RGB channels) for cloud droplets, 1024*3 entries
static const dfloat3 mied[] = {
	{0.0903309,0.0916879,0.0930239},{0.0917433,0.0902461,0.0827627},{0.0873219,0.0810707,0.0757723},{0.0680399,0.0703224,0.0849134},
	{0.0590436,0.0682252,0.0684236},{0.0636800,0.0645551,0.0439802},{0.0707418,0.0558057,0.0359818},{0.0684084,0.0501695,0.0494246},
	{0.0595963,0.0575097,0.0633603},{0.0607631,0.0680286,0.0625536},{0.0695137,0.0711089,0.0603133},{0.0764528,0.0706502,0.0621504},
	{0.0778651,0.0710434,0.0660488},{0.0754088,0.0723541,0.0687374},{0.0729525,0.0723541,0.0681548},{0.0712331,0.0704535,0.0652422},
	{0.0690839,0.0671766,0.0620159},{0.0659521,0.0633427,0.0592377},{0.0620833,0.0598691,0.0563700},{0.0580611,0.0563956,0.0536815},
	{0.0543152,0.0528566,0.0512617},{0.0509992,0.0498090,0.0483940},{0.0482051,0.0472530,0.0451901},{0.0457795,0.0448937,0.0422327},
	{0.0435074,0.0427636,0.0397906},{0.0412967,0.0406664,0.0382895},{0.0392703,0.0385037,0.0374830},{0.0375816,0.0367341,0.0365195},
	{0.0361999,0.0353579,0.0352200},{0.0350024,0.0343747,0.0337637},{0.0339893,0.0335883,0.0323298},{0.0330681,0.0326872,0.0312321},
	{0.0321470,0.0316222,0.0307392},{0.0312412,0.0306391,0.0304031},{0.0305350,0.0300329,0.0295293},{0.0299517,0.0295413,0.0285659},
	{0.0293223,0.0289351,0.0280506},{0.0286468,0.0283125,0.0277817},{0.0280326,0.0276735,0.0276249},{0.0275414,0.0269690,0.0275353},
	{0.0271269,0.0264938,0.0270424},{0.0267124,0.0263792,0.0261909},{0.0263133,0.0262808,0.0254292},{0.0260215,0.0259858,0.0248692},
	{0.0257146,0.0255599,0.0246899},{0.0252846,0.0250520,0.0249811},{0.0248855,0.0246260,0.0252051},{0.0247013,0.0244622,0.0248692},
	{0.0245785,0.0243965,0.0243763},{0.0244249,0.0242819,0.0239729},{0.0242561,0.0241180,0.0236593},{0.0240104,0.0238231,0.0236145},
	{0.0237341,0.0234954,0.0236593},{0.0234884,0.0232824,0.0234577},{0.0232429,0.0231677,0.0231887},{0.0229665,0.0230203,0.0230543},
	{0.0227823,0.0228564,0.0228303},{0.0227055,0.0226598,0.0225503},{0.0225674,0.0224468,0.0224158},{0.0223985,0.0222502,0.0223598},
	{0.0222757,0.0220045,0.0223151},{0.0220915,0.0218242,0.0223262},{0.0218459,0.0217260,0.0222701},{0.0217230,0.0216440,0.0220574},
	{0.0216617,0.0215621,0.0217324},{0.0215849,0.0214965,0.0214860},{0.0214467,0.0214146,0.0213740},{0.0213085,0.0213163,0.0213292},
	{0.0211704,0.0212016,0.0213404},{0.0210321,0.0210869,0.0213963},{0.0209401,0.0210050,0.0213740},{0.0209247,0.0209231,0.0212508},
	{0.0208787,0.0208247,0.0212059},{0.0207865,0.0207428,0.0211836},{0.0207405,0.0206446,0.0211163},{0.0207098,0.0205626,0.0210155},
	{0.0206177,0.0205954,0.0208699},{0.0205410,0.0205626,0.0208027},{0.0204488,0.0204479,0.0208923},{0.0203720,0.0203660,0.0209370},
	{0.0203720,0.0203660,0.0207802},{0.0204181,0.0203004,0.0206459},{0.0204181,0.0202185,0.0206123},{0.0202953,0.0202513,0.0206234},
	{0.0201417,0.0202677,0.0206795},{0.0200804,0.0202185,0.0207131},{0.0200958,0.0201857,0.0206795},{0.0200804,0.0201857,0.0206570},
	{0.0200343,0.0201857,0.0206907},{0.0200497,0.0201367,0.0207018},{0.0201264,0.0201038,0.0206346},{0.0201571,0.0200710,0.0205786},
	{0.0201264,0.0200383,0.0206123},{0.0200804,0.0199891,0.0206682},{0.0200958,0.0199891,0.0206346},{0.0201264,0.0200219,0.0205114},
	{0.0201111,0.0200875,0.0204330},{0.0200036,0.0201530,0.0205227},{0.0199114,0.0201530,0.0207131},{0.0198961,0.0201202,0.0208586},
	{0.0199268,0.0200710,0.0209259},{0.0200036,0.0200547,0.0208923},{0.0201111,0.0200383,0.0207915},{0.0201724,0.0200710,0.0207131},
	{0.0201571,0.0201367,0.0206907},{0.0201264,0.0202185,0.0206682},{0.0201417,0.0202349,0.0207131},{0.0201111,0.0202022,0.0208811},
	{0.0200958,0.0201694,0.0210491},{0.0201724,0.0202022,0.0210268},{0.0202492,0.0202513,0.0209707},{0.0202492,0.0203004,0.0210155},
	{0.0202032,0.0203496,0.0211163},{0.0202492,0.0203496,0.0211500},{0.0203107,0.0203496,0.0211500},{0.0203107,0.0203988,0.0211947},
	{0.0203107,0.0204479,0.0212620},{0.0203720,0.0204807,0.0212731},{0.0204642,0.0205134,0.0212508},{0.0205256,0.0205626,0.0212843},
	{0.0205256,0.0205789,0.0214413},{0.0205410,0.0205789,0.0215868},{0.0206023,0.0206609,0.0215533},{0.0206330,0.0207265,0.0215197},
	{0.0206484,0.0207428,0.0216317},{0.0206330,0.0207920,0.0217101},{0.0206637,0.0209067,0.0216876},{0.0207252,0.0209067,0.0217549},
	{0.0208172,0.0208903,0.0218445},{0.0208787,0.0209394,0.0219006},{0.0209094,0.0209722,0.0220013},{0.0209554,0.0209886,0.0221133},
	{0.0210321,0.0210378,0.0221469},{0.0210936,0.0211360,0.0221469},{0.0211089,0.0212671,0.0221581},{0.0211857,0.0213163,0.0222253},
	{0.0212778,0.0213163,0.0223262},{0.0213392,0.0213818,0.0224269},{0.0213392,0.0214965,0.0225503},{0.0213546,0.0215784,0.0226510},
	{0.0214467,0.0216276,0.0226735},{0.0215541,0.0216440,0.0227071},{0.0216156,0.0216768,0.0227967},{0.0216156,0.0217260,0.0228975},
	{0.0216156,0.0217915,0.0229648},{0.0216770,0.0218078,0.0229871},{0.0217537,0.0218406,0.0229423},{0.0217998,0.0218570,0.0229423},
	{0.0217383,0.0218897,0.0230543},{0.0216463,0.0219389,0.0231216},{0.0216923,0.0219389,0.0230768},{0.0217383,0.0219061,0.0230096},
	{0.0216770,0.0219061,0.0230319},{0.0216309,0.0218734,0.0230543},{0.0216617,0.0217915,0.0229871},{0.0216463,0.0217095,0.0229871},
	{0.0215541,0.0216440,0.0230543},{0.0214927,0.0216276,0.0230768},{0.0215388,0.0215784,0.0229871},{0.0216156,0.0215292,0.0228864},
	{0.0216617,0.0214965,0.0228078},{0.0216463,0.0215129,0.0227630},{0.0216156,0.0215457,0.0226959},{0.0216617,0.0215292,0.0225951},
	{0.0216617,0.0215292,0.0225278},{0.0215849,0.0216440,0.0224830},{0.0215081,0.0217587,0.0224494},{0.0215388,0.0218078,0.0224269},
	{0.0215234,0.0218242,0.0225839},{0.0213546,0.0219389,0.0228975},{0.0212318,0.0221027,0.0231887},{0.0212471,0.0222338,0.0234128},
	{0.0213239,0.0222666,0.0237936},{0.0214007,0.0222994,0.0243313},{0.0215081,0.0223977,0.0248242},{0.0217076,0.0225616,0.0252724},
	{0.0221069,0.0227090,0.0255860},{0.0226748,0.0228729,0.0258101},{0.0232275,0.0231677,0.0260341},{0.0238723,0.0235446,0.0261909},
	{0.0248088,0.0239706,0.0260341},{0.0258066,0.0244949,0.0258773},{0.0265896,0.0251831,0.0259446},{0.0273264,0.0259858,0.0261237},
	{0.0281555,0.0268215,0.0263254},{0.0288617,0.0276571,0.0267959},{0.0294604,0.0285255,0.0275353},{0.0299978,0.0293612,0.0284987},
	{0.0303662,0.0301639,0.0298877},{0.0306579,0.0309668,0.0314785},{0.0310877,0.0317696,0.0329572},{0.0314715,0.0325561,0.0345255},
	{0.0316557,0.0333262,0.0364522},{0.0319628,0.0341126,0.0381327},{0.0325154,0.0348991,0.0393424},{0.0330067,0.0356527,0.0406419},
	{0.0333138,0.0364720,0.0420983},{0.0338971,0.0372912,0.0429272},{0.0347875,0.0381760,0.0431512},{0.0356166,0.0389624,0.0433978},
	{0.0363534,0.0395850,0.0438010},{0.0374895,0.0402077,0.0434650},{0.0389633,0.0406992,0.0425688},{0.0402221,0.0409286,0.0421206},
	{0.0411740,0.0409614,0.0421654},{0.0420029,0.0408303,0.0423224},{0.0425863,0.0404371,0.0429721},{0.0427706,0.0399782,0.0440475},
	{0.0426170,0.0397489,0.0450108},{0.0422179,0.0396506,0.0458399},{0.0416038,0.0395195,0.0467360},{0.0410511,0.0393229,0.0474082},
	{0.0405599,0.0391918,0.0475874},{0.0399765,0.0391918,0.0474977},{0.0393010,0.0390936,0.0473634},{0.0387484,0.0388969,0.0470048},
	{0.0382264,0.0387003,0.0463775},{0.0376430,0.0385365,0.0455933},{0.0370289,0.0383070,0.0446972},{0.0365070,0.0379794,0.0436666},
	{0.0360157,0.0375862,0.0424792},{0.0354630,0.0372585,0.0412021},{0.0349104,0.0368325,0.0399251},{0.0344191,0.0363409,0.0385584},
	{0.0339278,0.0358493,0.0370796},{0.0334058,0.0352923,0.0356457},{0.0328532,0.0346369,0.0342567},{0.0323312,0.0340143,0.0327555},
	{0.0318092,0.0333917,0.0311648},{0.0313027,0.0326380,0.0296861},{0.0307346,0.0318188,0.0282971},{0.0301666,0.0310487,0.0268631},
	{0.0295832,0.0302950,0.0254069},{0.0290306,0.0294594,0.0240625},{0.0284779,0.0286074,0.0227743},{0.0279252,0.0277717,0.0214972},
	{0.0273725,0.0269198,0.0202873},{0.0268353,0.0260515,0.0191447},{0.0262518,0.0252322,0.0180245},{0.0256685,0.0244294,0.0169378},
	{0.0251619,0.0235774,0.0159072},{0.0246399,0.0226926,0.0149550},{0.0240104,0.0219226,0.0141262},{0.0233810,0.0211360,0.0133644},
	{0.0228590,0.0202841,0.0126363},{0.0222911,0.0194812,0.0119641},{0.0216156,0.0188095,0.0113872},{0.0209862,0.0180885,0.0108718},
	{0.0205102,0.0172693,0.0103733},{0.0200036,0.0165238,0.0098804},{0.0193896,0.0159422,0.0094267},{0.0187448,0.0153687,0.0091075},
	{0.0180693,0.0147871,0.0089170},{0.0174244,0.0142382,0.0087154},{0.0168872,0.0136893,0.0084185},{0.0163959,0.0130913,0.0082169},
	{0.0157972,0.0125588,0.0081720},{0.0151447,0.0121573,0.0080880},{0.0145614,0.0118051,0.0079032},{0.0140317,0.0114036,0.0077800},
	{0.0134866,0.0110104,0.0077577},{0.0129801,0.0106336,0.0077072},{0.0125732,0.0102732,0.0075672},{0.0121510,0.0099946,0.0074047},
	{0.0116599,0.0097651,0.0073432},{0.0112146,0.0095195,0.0072984},{0.0108846,0.0092572,0.0071639},{0.0105929,0.0090115,0.0070126},
	{0.0102782,0.0087903,0.0068950},{0.0099788,0.0086101,0.0067550},{0.0096794,0.0084790,0.0065981},{0.0093647,0.0083766,0.0064749},
	{0.0091037,0.0082374,0.0063685},{0.0089272,0.0080325,0.0062789},{0.0087813,0.0078318,0.0061836},{0.0085971,0.0077253,0.0060549},
	{0.0084129,0.0076598,0.0059317},{0.0082593,0.0075655,0.0058475},{0.0081212,0.0074468,0.0058028},{0.0079983,0.0073444,0.0057524},
	{0.0078985,0.0072625,0.0056656},{0.0078141,0.0071887,0.0055787},{0.0077067,0.0071355,0.0055144},{0.0075954,0.0071150,0.0054332},
	{0.0074879,0.0070946,0.0053631},{0.0073881,0.0070289,0.0053715},{0.0073152,0.0069511,0.0053743},{0.0072615,0.0069061,0.0053295},
	{0.0071885,0.0068774,0.0053071},{0.0071079,0.0068488,0.0053239},{0.0070312,0.0068118,0.0053548},{0.0069736,0.0067668,0.0053968},
	{0.0069353,0.0067299,0.0054163},{0.0068969,0.0067136,0.0054302},{0.0068546,0.0067095,0.0054416},{0.0068201,0.0067136,0.0054499},
	{0.0067856,0.0067177,0.0054667},{0.0067549,0.0067054,0.0055116},{0.0067280,0.0066890,0.0055592},{0.0066896,0.0066931,0.0056067},
	{0.0066359,0.0066931,0.0056879},{0.0065975,0.0066726,0.0057804},{0.0065745,0.0066603,0.0058420},{0.0065399,0.0066481,0.0059204},
	{0.0065092,0.0066398,0.0060101},{0.0064901,0.0066439,0.0060604},{0.0064823,0.0066481,0.0061164},{0.0064785,0.0066481,0.0061781},
	{0.0064747,0.0066398,0.0062453},{0.0064593,0.0066481,0.0063068},{0.0064440,0.0066603,0.0063629},{0.0064286,0.0066357,0.0064525},
	{0.0064094,0.0066111,0.0065478},{0.0063979,0.0065989,0.0066262},{0.0063787,0.0065784,0.0067213},{0.0063404,0.0065784,0.0068166},
	{0.0063250,0.0065906,0.0068839},{0.0063442,0.0065702,0.0069398},{0.0063480,0.0065456,0.0070182},{0.0063250,0.0065497,0.0070855},
	{0.0063058,0.0065661,0.0071191},{0.0063135,0.0065661,0.0071303},{0.0063288,0.0065211,0.0071806},{0.0063288,0.0064719,0.0072590},
	{0.0063173,0.0064637,0.0072984},{0.0063135,0.0064514,0.0073263},{0.0063173,0.0064064,0.0073935},{0.0063097,0.0063818,0.0074495},
	{0.0063058,0.0063736,0.0074663},{0.0063135,0.0063367,0.0074944},{0.0063212,0.0063039,0.0075111},{0.0063288,0.0062999,0.0074775},
	{0.0063288,0.0063121,0.0074271},{0.0062943,0.0063121,0.0074383},{0.0062867,0.0062712,0.0074608},{0.0063442,0.0062179,0.0073879},
	{0.0063903,0.0062016,0.0072703},{0.0063442,0.0062261,0.0072198},{0.0062943,0.0062138,0.0072198},{0.0063097,0.0061565,0.0071750},
	{0.0063672,0.0061073,0.0070630},{0.0063941,0.0060746,0.0069623},{0.0063518,0.0060868,0.0069062},{0.0062905,0.0061360,0.0068166},
	{0.0062713,0.0061483,0.0067213},{0.0062867,0.0060746,0.0066710},{0.0062943,0.0060172,0.0065981},{0.0062636,0.0060336,0.0064694},
	{0.0061868,0.0060664,0.0063741},{0.0060947,0.0060623,0.0063404},{0.0060448,0.0060091,0.0063012},{0.0060257,0.0059517,0.0062284},
	{0.0059604,0.0059231,0.0061781},{0.0058453,0.0059271,0.0061389},{0.0057609,0.0059353,0.0060549},{0.0057032,0.0058902,0.0059932},
	{0.0056112,0.0058083,0.0060212},{0.0054960,0.0057550,0.0060380},{0.0054193,0.0057100,0.0059876},{0.0053694,0.0056281,0.0059428},
	{0.0052964,0.0055502,0.0059148},{0.0052159,0.0054807,0.0058980},{0.0051391,0.0053947,0.0058980},{0.0050815,0.0053085,0.0058700},
	{0.0050431,0.0052308,0.0058083},{0.0050048,0.0051652,0.0057327},{0.0049433,0.0051324,0.0056487},{0.0048819,0.0050874,0.0055815},
	{0.0048397,0.0050096,0.0055172},{0.0048166,0.0049440,0.0054191},{0.0047783,0.0049195,0.0052819},{0.0047246,0.0049031,0.0051586},
	{0.0046785,0.0048498,0.0050690},{0.0046670,0.0047557,0.0049962},{0.0046478,0.0046860,0.0048926},{0.0045941,0.0046696,0.0047694},
	{0.0045442,0.0046327,0.0046742},{0.0045250,0.0045508,0.0045986},{0.0045097,0.0044648,0.0045258},{0.0044790,0.0044115,0.0044418},
	{0.0044405,0.0043747,0.0043549},{0.0043983,0.0043214,0.0042878},{0.0043523,0.0042600,0.0042484},{0.0043024,0.0042027,0.0042092},
	{0.0042640,0.0041433,0.0041477},{0.0042256,0.0040961,0.0040888},{0.0041757,0.0040490,0.0040496},{0.0041258,0.0039937,0.0040356},
	{0.0040645,0.0039446,0.0040412},{0.0040030,0.0038995,0.0040524},{0.0039531,0.0038607,0.0040440},{0.0039186,0.0038340,0.0040048},
	{0.0038898,0.0038032,0.0039656},{0.0038476,0.0037541,0.0039740},{0.0037843,0.0037192,0.0039964},{0.0037248,0.0037152,0.0039768},
	{0.0036864,0.0037111,0.0039320},{0.0036519,0.0036865,0.0039152},{0.0036134,0.0036558,0.0039152},{0.0035904,0.0036395,0.0038844},
	{0.0035789,0.0036374,0.0038227},{0.0035501,0.0036332,0.0037921},{0.0035060,0.0036210,0.0037976},{0.0034791,0.0036005,0.0038004},
	{0.0034715,0.0035821,0.0037807},{0.0034638,0.0035779,0.0037443},{0.0034676,0.0035779,0.0036912},{0.0034753,0.0035739,0.0036408},
	{0.0034638,0.0035637,0.0036323},{0.0034446,0.0035472,0.0036464},{0.0034465,0.0035391,0.0036295},{0.0034638,0.0035452,0.0035819},
	{0.0034715,0.0035472,0.0035539},{0.0034753,0.0035411,0.0035539},{0.0034829,0.0035350,0.0035427},{0.0034926,0.0035268,0.0035344},
	{0.0034983,0.0035124,0.0035372},{0.0035041,0.0035002,0.0035399},{0.0035098,0.0034838,0.0035483},{0.0035117,0.0034633,0.0035736},
	{0.0035117,0.0034571,0.0035819},{0.0035156,0.0034694,0.0035623},{0.0035252,0.0034673,0.0035623},{0.0035309,0.0034490,0.0035847},
	{0.0035328,0.0034469,0.0035959},{0.0035271,0.0034633,0.0035931},{0.0035195,0.0034756,0.0036016},{0.0035156,0.0034899,0.0036044},
	{0.0035175,0.0035124,0.0035847},{0.0035233,0.0035247,0.0035736},{0.0035271,0.0035206,0.0035875},{0.0035195,0.0035247,0.0035987},
	{0.0035041,0.0035472,0.0036044},{0.0034945,0.0035616,0.0036128},{0.0035079,0.0035555,0.0036184},{0.0035328,0.0035452,0.0036184},
	{0.0035501,0.0035493,0.0036156},{0.0035521,0.0035637,0.0036211},{0.0035482,0.0035759,0.0036464},{0.0035463,0.0035800,0.0036771},
	{0.0035635,0.0035842,0.0036800},{0.0035981,0.0035882,0.0036520},{0.0036307,0.0035923,0.0036295},{0.0036346,0.0036005,0.0036323},
	{0.0036134,0.0036251,0.0036520},{0.0035962,0.0036497,0.0036659},{0.0036077,0.0036517,0.0036687},{0.0036403,0.0036456,0.0036520},
	{0.0036672,0.0036578,0.0036239},{0.0036730,0.0036783,0.0036211},{0.0036576,0.0036926,0.0036548},{0.0036461,0.0037070,0.0036828},
	{0.0036538,0.0037214,0.0036856},{0.0036787,0.0037172,0.0036856},{0.0036999,0.0037111,0.0036968},{0.0037094,0.0037214,0.0037051},
	{0.0037113,0.0037377,0.0037164},{0.0037171,0.0037438,0.0037360},{0.0037229,0.0037501,0.0037584},{0.0037344,0.0037603,0.0037752},
	{0.0037517,0.0037643,0.0037863},{0.0037747,0.0037664,0.0037921},{0.0037900,0.0037787,0.0038004},{0.0037957,0.0037991,0.0038144},
	{0.0038035,0.0038176,0.0038255},{0.0038226,0.0038278,0.0038368},{0.0038399,0.0038402,0.0038480},{0.0038495,0.0038647,0.0038536},
	{0.0038687,0.0038872,0.0038480},{0.0038975,0.0038975,0.0038508},{0.0039167,0.0039016,0.0038788},{0.0039186,0.0039241,0.0039011},
	{0.0039340,0.0039610,0.0038956},{0.0039647,0.0039753,0.0038928},{0.0039877,0.0039753,0.0039264},{0.0039992,0.0039937,0.0039600},
	{0.0040146,0.0040203,0.0039684},{0.0040414,0.0040388,0.0039768},{0.0040567,0.0040490,0.0040104},{0.0040683,0.0040593,0.0040468},
	{0.0040913,0.0040756,0.0040665},{0.0041182,0.0040982,0.0040721},{0.0041373,0.0041268,0.0040804},{0.0041451,0.0041392,0.0041280},
	{0.0041603,0.0041453,0.0041813},{0.0041872,0.0041699,0.0041925},{0.0042180,0.0042067,0.0041813},{0.0042487,0.0042313,0.0042036},
	{0.0042717,0.0042476,0.0042428},{0.0042947,0.0042805,0.0042681},{0.0043177,0.0043214,0.0042848},{0.0043446,0.0043501,0.0043129},
	{0.0043792,0.0043828,0.0043297},{0.0044252,0.0044074,0.0043297},{0.0044636,0.0044320,0.0043437},{0.0044751,0.0044688,0.0043773},
	{0.0044751,0.0045139,0.0044165},{0.0045019,0.0045426,0.0044388},{0.0045634,0.0045590,0.0044361},{0.0046171,0.0045794,0.0044446},
	{0.0046363,0.0046122,0.0045033},{0.0046516,0.0046532,0.0045594},{0.0046901,0.0047065,0.0045761},{0.0047360,0.0047433,0.0046070},
	{0.0047707,0.0047474,0.0046882},{0.0048128,0.0047720,0.0047274},{0.0048743,0.0048212,0.0047134},{0.0049164,0.0048539,0.0047329},
	{0.0049164,0.0048785,0.0048338},{0.0049203,0.0049112,0.0049178},{0.0049856,0.0049440,0.0049206},{0.0050700,0.0049769,0.0049039},
	{0.0051084,0.0050178,0.0049486},{0.0051237,0.0050588,0.0050298},{0.0051621,0.0051079,0.0050746},{0.0052120,0.0051570,0.0051055},
	{0.0052504,0.0052062,0.0051558},{0.0053003,0.0052595,0.0051894},{0.0053732,0.0053045,0.0052006},{0.0054384,0.0053496,0.0052314},
	{0.0054614,0.0054110,0.0052987},{0.0054768,0.0054807,0.0053715},{0.0055306,0.0055421,0.0054023},{0.0056226,0.0055830,0.0054107},
	{0.0056994,0.0056157,0.0054527},{0.0057340,0.0056690,0.0055367},{0.0057647,0.0057428,0.0055956},{0.0058184,0.0058125,0.0056292},
	{0.0058760,0.0058534,0.0056907},{0.0059297,0.0058780,0.0057804},{0.0059988,0.0059148,0.0058308},{0.0060756,0.0059721,0.0058588},
	{0.0061293,0.0060418,0.0059204},{0.0061562,0.0061073,0.0060380},{0.0062099,0.0061647,0.0061333},{0.0063097,0.0062138,0.0061836},
	{0.0064171,0.0062630,0.0062228},{0.0064709,0.0063367,0.0062957},{0.0064977,0.0064269,0.0063797},{0.0065629,0.0064883,0.0064525},
	{0.0066551,0.0065292,0.0065086},{0.0067280,0.0066030,0.0065478},{0.0067894,0.0066890,0.0065981},{0.0068546,0.0067709,0.0066598},
	{0.0069275,0.0068447,0.0067271},{0.0070121,0.0069266,0.0067942},{0.0070965,0.0070003,0.0068726},{0.0071809,0.0070863,0.0069454},
	{0.0072691,0.0071887,0.0069959},{0.0073575,0.0072829,0.0070518},{0.0074265,0.0073607,0.0071527},{0.0075032,0.0074386,0.0072534},
	{0.0076069,0.0075082,0.0073151},{0.0077028,0.0075901,0.0073768},{0.0077680,0.0076844,0.0074719},{0.0078487,0.0077786,0.0075559},
	{0.0079446,0.0078605,0.0076399},{0.0080444,0.0079302,0.0077577},{0.0081366,0.0080162,0.0078640},{0.0082363,0.0081226,0.0079424},
	{0.0083284,0.0082291,0.0080321},{0.0084205,0.0083275,0.0081441},{0.0085127,0.0084053,0.0082785},{0.0086201,0.0084872,0.0083793},
	{0.0087199,0.0086019,0.0084522},{0.0088120,0.0087083,0.0085473},{0.0089041,0.0087985,0.0086818},{0.0089963,0.0089051,0.0087938},
	{0.0091037,0.0090115,0.0088946},{0.0092419,0.0091098,0.0089954},{0.0093570,0.0092245,0.0090907},{0.0094568,0.0093638,0.0092139},
	{0.0095490,0.0094866,0.0093596},{0.0096640,0.0095931,0.0094939},{0.0098099,0.0097161,0.0095779},{0.0099557,0.0098389,0.0096621},
	{0.0100632,0.0099700,0.0098189},{0.0101477,0.0101010,0.0099924},{0.0102858,0.0102403,0.0101100},{0.0104546,0.0103632,0.0101940},
	{0.0105929,0.0104943,0.0103229},{0.0107003,0.0106336,0.0104798},{0.0108231,0.0107646,0.0106254},{0.0109690,0.0108876,0.0107542},
	{0.0111071,0.0110186,0.0108774},{0.0112453,0.0111661,0.0110007},{0.0113835,0.0112889,0.0111462},{0.0115294,0.0114118,0.0113143},
	{0.0116752,0.0115593,0.0114656},{0.0118210,0.0117149,0.0116057},{0.0119668,0.0118624,0.0117736},{0.0121204,0.0120017,0.0119304},
	{0.0122969,0.0121491,0.0120761},{0.0124658,0.0122966,0.0122329},{0.0126193,0.0124523,0.0124009},{0.0127652,0.0125997,0.0125913},
	{0.0129033,0.0127717,0.0127595},{0.0130722,0.0129602,0.0128715},{0.0132487,0.0131159,0.0130171},{0.0134176,0.0132060,0.0132635},
	{0.0135942,0.0133615,0.0134315},{0.0137784,0.0136073,0.0135099},{0.0139242,0.0138204,0.0136892},{0.0140624,0.0139678,0.0140141},
	{0.0142696,0.0141481,0.0142157},{0.0145229,0.0143693,0.0142941},{0.0147378,0.0145822,0.0144846},{0.0148991,0.0147707,0.0147870},
	{0.0150910,0.0149754,0.0150111},{0.0153059,0.0152131,0.0151679},{0.0154825,0.0154260,0.0154143},{0.0156743,0.0156063,0.0156720},
	{0.0159046,0.0157947,0.0158401},{0.0161042,0.0160077,0.0160417},{0.0162731,0.0162207,0.0163106},{0.0165034,0.0164173,0.0165346},
	{0.0167337,0.0166303,0.0167139},{0.0169025,0.0168433,0.0170051},{0.0171021,0.0170727,0.0172628},{0.0173631,0.0173021,0.0174196},
	{0.0176087,0.0175315,0.0176325},{0.0177929,0.0177445,0.0179461},{0.0180386,0.0179739,0.0181813},{0.0183148,0.0182196,0.0183606},
	{0.0185451,0.0184817,0.0186070},{0.0187601,0.0187275,0.0189095},{0.0190210,0.0189733,0.0191560},{0.0193128,0.0192191,0.0193912},
	{0.0195584,0.0194812,0.0196712},{0.0198040,0.0197598,0.0199401},{0.0200958,0.0200055,0.0202314},{0.0203720,0.0202513,0.0205562},
	{0.0206330,0.0205462,0.0208139},{0.0209401,0.0208412,0.0210491},{0.0211857,0.0211033,0.0213852},{0.0214160,0.0213655,0.0217549},
	{0.0217230,0.0216603,0.0220013},{0.0220915,0.0219389,0.0222030},{0.0223678,0.0222174,0.0225390},{0.0225980,0.0225287,0.0229312},
	{0.0228744,0.0228564,0.0232559},{0.0232275,0.0231514,0.0235025},{0.0235652,0.0234463,0.0238161},{0.0238570,0.0237575,0.0241745},
	{0.0241333,0.0240853,0.0245554},{0.0244710,0.0244130,0.0248692},{0.0248394,0.0247243,0.0251603},{0.0251311,0.0250520,0.0255637},
	{0.0254229,0.0254124,0.0259446},{0.0258220,0.0257565,0.0262582},{0.0262211,0.0260515,0.0266166},{0.0264975,0.0264282,0.0270424},
	{0.0267738,0.0268379,0.0274456},{0.0271883,0.0271984,0.0277592},{0.0276489,0.0274932,0.0280730},{0.0279866,0.0278537,0.0285210},
	{0.0282476,0.0282961,0.0289468},{0.0286007,0.0287221,0.0293052},{0.0290766,0.0290498,0.0296413},{0.0294758,0.0294102,0.0300445},
	{0.0298288,0.0298363,0.0304703},{0.0301973,0.0302623,0.0308735},{0.0306272,0.0306555,0.0312769},{0.0310263,0.0310651,0.0317473},
	{0.0314408,0.0314747,0.0321954},{0.0319014,0.0319335,0.0325763},{0.0323312,0.0323430,0.0330245},{0.0327303,0.0327364,0.0335622},
	{0.0331602,0.0332115,0.0339878},{0.0335901,0.0336867,0.0343687},{0.0340200,0.0341126,0.0348616},{0.0344498,0.0345386,0.0353320},
	{0.0349411,0.0349974,0.0357577},{0.0353709,0.0354561,0.0362058},{0.0358008,0.0359477,0.0367212},{0.0362614,0.0364064,0.0372589},
	{0.0367525,0.0368980,0.0377294},{0.0372745,0.0373896,0.0381998},{0.0377658,0.0378483,0.0387600},{0.0382571,0.0383399,0.0393201},
	{0.0386869,0.0388969,0.0398354},{0.0392089,0.0393884,0.0403507},{0.0397923,0.0398472,0.0408660},{0.0403143,0.0403716,0.0414261},
	{0.0407748,0.0409614,0.0420086},{0.0413275,0.0415185,0.0425463},{0.0418802,0.0420755,0.0430841},{0.0424328,0.0426326,0.0437114},
	{0.0430162,0.0431897,0.0442939},{0.0435996,0.0437468,0.0448765},{0.0441523,0.0443693,0.0455038},{0.0447049,0.0449592,0.0461087},
	{0.0452882,0.0455490,0.0466912},{0.0459024,0.0461061,0.0473634},{0.0464550,0.0466959,0.0479906},{0.0470384,0.0473186,0.0485283},
	{0.0476525,0.0478757,0.0490660},{0.0482051,0.0484327,0.0497382},{0.0487271,0.0490553,0.0504104},{0.0493411,0.0497762,0.0509481},
	{0.0500781,0.0503661,0.0516201},{0.0507536,0.0510543,0.0523819},{0.0514290,0.0518079,0.0531437},{0.0521352,0.0524961,0.0539054},
	{0.0528415,0.0532826,0.0545328},{0.0535169,0.0539707,0.0552946},{0.0542231,0.0544950,0.0561011},{0.0548986,0.0551831,0.0566836},
	{0.0554820,0.0560023,0.0573558},{0.0561267,0.0566578,0.0582071},{0.0568944,0.0573131,0.0588793},{0.0576926,0.0580668,0.0595515},
	{0.0583681,0.0588206,0.0604028},{0.0590436,0.0596397,0.0612542},{0.0598420,0.0604262,0.0620159},{0.0607017,0.0611144,0.0627777},
	{0.0614692,0.0619335,0.0635842},{0.0621447,0.0628183,0.0644805},{0.0629430,0.0636048,0.0653766},{0.0638027,0.0643257,0.0661833},
	{0.0646011,0.0651449,0.0669898},{0.0654608,0.0659969,0.0677963},{0.0663205,0.0668161,0.0686477},{0.0671187,0.0676354,0.0696335},
	{0.0677942,0.0685530,0.0707089},{0.0685926,0.0694705,0.0715604},{0.0696365,0.0703224,0.0722773},{0.0707418,0.0710434,0.0730839},
	{0.0716015,0.0718954,0.0741593},{0.0722770,0.0728785,0.0753242},{0.0730139,0.0740581,0.0762205},{0.0740578,0.0750413,0.0770270},
	{0.0751018,0.0756966,0.0781921},{0.0760843,0.0765486,0.0792675},{0.0771283,0.0776628,0.0799845},{0.0781107,0.0786458,0.0808806},
	{0.0788476,0.0796289,0.0821800},{0.0796460,0.0806119,0.0833451},{0.0807513,0.0815951,0.0842413},{0.0819180,0.0825126,0.0850927},
	{0.0829006,0.0835611,0.0860785},{0.0838217,0.0845443,0.0873332},{0.0849270,0.0855928,0.0884086},{0.0860324,0.0867070,0.0893496},
	{0.0869535,0.0879522,0.0906042},{0.0880588,0.0890008,0.0918588},{0.0894098,0.0900494,0.0928447},{0.0906380,0.0910981,0.0940098},
	{0.0914977,0.0924089,0.0952644},{0.0926030,0.0937196,0.0964294},{0.0940154,0.0947027,0.0975048},{0.0952435,0.0958168,0.0987594},
	{0.0962875,0.0971931,0.1000141},{0.0973929,0.0985038,0.1012688},{0.0988052,0.0996836,0.1023442},{0.1000334,0.1008632,0.1035988},
	{0.1012001,0.1020429,0.1051224},{0.1024897,0.1032882,0.1062875},{0.1038406,0.1047300,0.1070940},{0.1050074,0.1060408,0.1085280},
	{0.1061742,0.1071549,0.1102306},{0.1076479,0.1084657,0.1113061},{0.1090603,0.1099076,0.1122920},{0.1102884,0.1113493,0.1136362},
	{0.1115166,0.1126601,0.1151597},{0.1129904,0.1137742,0.1166832},{0.1144642,0.1152161,0.1178482},{0.1157538,0.1169857,0.1189237},
	{0.1171047,0.1183619,0.1205368},{0.1187014,0.1194761,0.1223292},{0.1201137,0.1210490,0.1236734},{0.1215875,0.1228841,0.1247488},
	{0.1231841,0.1243259,0.1262723},{0.1246579,0.1257022,0.1280647},{0.1261317,0.1273407,0.1296779},{0.1278511,0.1289136,0.1311117},
	{0.1294477,0.1305520,0.1325457},{0.1309215,0.1322560,0.1341587},{0.1326409,0.1336979,0.1358615},{0.1342376,0.1352708,0.1375643},
	{0.1357113,0.1369748,0.1390879},{0.1373079,0.1386788,0.1407009},{0.1390273,0.1403828,0.1424037},{0.1408695,0.1419556,0.1440168},
	{0.1425889,0.1436597,0.1458092},{0.1441855,0.1454947,0.1476911},{0.1457822,0.1471988,0.1494835},{0.1477473,0.1489028,0.1511863},
	{0.1494667,0.1507378,0.1527994},{0.1513089,0.1524418,0.1547710},{0.1530283,0.1540147,0.1568322},{0.1547477,0.1561119,0.1585350},
	{0.1565899,0.1580781,0.1603274},{0.1584322,0.1597821,0.1623886},{0.1603972,0.1614860,0.1644498},{0.1623623,0.1634522,0.1664214},
	{0.1643274,0.1655494,0.1683034},{0.1661696,0.1676466,0.1703646},{0.1681347,0.1694817,0.1726051},{0.1703453,0.1714479,0.1746663},
	{0.1724332,0.1735451,0.1768172},{0.1743982,0.1756423,0.1789680},{0.1763633,0.1780017,0.1809396},{0.1784512,0.1800989,0.1830904},
	{0.1806618,0.1816719,0.1856893},{0.1827497,0.1839001,0.1876610},{0.1848375,0.1863906,0.1894533},{0.1869254,0.1884878,0.1917834},
	{0.1891361,0.1904540,0.1944720},{0.1912240,0.1928133,0.1964436},{0.1936803,0.1950416,0.1987737},{0.1960138,0.1974010,0.2009245},
	{0.1981016,0.2000225,0.2032545},{0.2004352,0.2021197,0.2059432},{0.2028915,0.2043480,0.2084525},{0.2053478,0.2071006,0.2106033},
	{0.2076813,0.2095910,0.2131126},{0.2102604,0.2120816,0.2156220},{0.2127167,0.2147031,0.2181313},{0.2151730,0.2168003,0.2209990},
	{0.2176294,0.2192907,0.2235084},{0.2199628,0.2223054,0.2253008},{0.2224191,0.2246648,0.2281685},{0.2249983,0.2267620,0.2312155},
	{0.2275774,0.2295147,0.2335456},{0.2301566,0.2322673,0.2360549},{0.2327356,0.2350199,0.2385643},{0.2353148,0.2380347,0.2412527},
	{0.2380168,0.2402630,0.2448375},{0.2410871,0.2430156,0.2475261},{0.2439119,0.2462924,0.2496769},{0.2468594,0.2490451,0.2530825},
	{0.2498070,0.2516666,0.2564879},{0.2525090,0.2552056,0.2589973},{0.2554565,0.2580893,0.2624027},{0.2586498,0.2603176,0.2654497},
	{0.2615974,0.2634634,0.2676007},{0.2640537,0.2663472,0.2704684},{0.2665100,0.2684444,0.2738739},{0.2694576,0.2718523,0.2763832},
	{0.2724052,0.2752604,0.2792509},{0.2760896,0.2778819,0.2831942},{0.2800197,0.2815520,0.2864206},{0.2837042,0.2857464,0.2898260},
	{0.2873886,0.2891544,0.2943070},{0.2910731,0.2928246,0.2984294},{0.2942664,0.2975433,0.3014764},{0.2979508,0.3012135,0.3054196},
	{0.3021266,0.3035728,0.3093629},{0.3063023,0.3069808,0.3118721},{0.3097411,0.3106509,0.3145607},{0.3124431,0.3137967,0.3185038},
	{0.3146537,0.3174669,0.3224471},{0.3168644,0.3211371,0.3256734},{0.3205489,0.3237586,0.3281826},{0.3249702,0.3258558,0.3303335},
	{0.3286547,0.3284773,0.3328429},{0.3311111,0.3318853,0.3362483},{0.3335674,0.3355554,0.3401916},{0.3360237,0.3394877,0.3441348},
	{0.3394624,0.3434200,0.3473611},{0.3443752,0.3468280,0.3507665},{0.3492878,0.3499738,0.3547097},{0.3534635,0.3544304,0.3590114},
	{0.3571480,0.3594113,0.3634923},{0.3610780,0.3641301,0.3685110},{0.3654994,0.3691110,0.3731711},{0.3704121,0.3735676,0.3774728},
	{0.3755703,0.3774999,0.3821330},{0.3802373,0.3822186,0.3867931},{0.3844130,0.3874616,0.3907364},{0.3888344,0.3919182,0.3957549},
	{0.3932557,0.3961127,0.4004152},{0.3976771,0.4008314,0.4043583},{0.4020985,0.4052880,0.4090186},{0.4067655,0.4092203,0.4136787},
	{0.4114324,0.4139390,0.4172634},{0.4156082,0.4186579,0.4215651},{0.4195383,0.4223279,0.4269422},{0.4239596,0.4267845,0.4312439},
	{0.4286267,0.4315034,0.4344701},{0.4332937,0.4356977,0.4391303},{0.4377150,0.4396300,0.4441489},{0.4421363,0.4446110,0.4484506},
	{0.4465578,0.4490676,0.4531108},{0.4514704,0.4535242,0.4581294},{0.4563830,0.4585051,0.4624311},{0.4610500,0.4637481,0.4667328},
	{0.4662082,0.4684669,0.4721099},{0.4713665,0.4731856,0.4774870},{0.4765247,0.4786908,0.4821471},{0.4816830,0.4844582,0.4871658},
	{0.4868413,0.4891769,0.4929014},{0.4919996,0.4946822,0.4979199},{0.4974035,0.5004495,0.5025802},{0.5025617,0.5054304,0.5079573},
	{0.5079656,0.5104113,0.5133344},{0.5133694,0.5159165,0.5183529},{0.5182821,0.5214217,0.5233716},{0.5236860,0.5264026,0.5291072},
	{0.5290899,0.5316457,0.5344843},{0.5344937,0.5374130,0.5395029},{0.5398976,0.5431804,0.5448801},{0.5457928,0.5484234,0.5513326},
	{0.5521792,0.5541908,0.5570681},{0.5580744,0.5604825,0.5628037},{0.5644608,0.5672984,0.5688978},{0.5708472,0.5735901,0.5753503},
	{0.5772336,0.5798818,0.5814444},{0.5836200,0.5861734,0.5878968},{0.5900064,0.5929894,0.5939909},{0.5963928,0.5987568,0.6000850},
	{0.6027793,0.6045241,0.6065375},{0.6091657,0.6108158,0.6122731},{0.6150608,0.6176317,0.6180086},{0.6209560,0.6239234,0.6244612},
	{0.6273424,0.6291665,0.6305553},{0.6337288,0.6349338,0.6366494},{0.6396240,0.6417497,0.6423849},{0.6460103,0.6485657,0.6477620},
	{0.6523968,0.6548574,0.6545730},{0.6587832,0.6611491,0.6617425},{0.6661522,0.6684894,0.6685535},{0.6735211,0.6763539,0.6746476},
	{0.6813813,0.6836943,0.6821755},{0.6892415,0.6910345,0.6907789},{0.6971017,0.6999477,0.6986653},{0.7054532,0.7088608,0.7061932},
	{0.7142958,0.7162012,0.7147966},{0.7231386,0.7235414,0.7241169},{0.7309988,0.7324546,0.7323618},{0.7383677,0.7418921,0.7391728},
	{0.7462279,0.7497567,0.7463423},{0.7540881,0.7560484,0.7542287},{0.7619483,0.7623400,0.7606812},{0.7683348,0.7696803,0.7664169},
	{0.7742299,0.7764962,0.7728693},{0.7801250,0.7822636,0.7800388},{0.7870028,0.7890796,0.7850575},{0.7938804,0.7964198,0.7907930},
	{0.8012493,0.8032359,0.7979624},{0.8096008,0.8100518,0.8065658},{0.8184436,0.8184407,0.8158862},{0.8272863,0.8284025,0.8244895},
	{0.8371115,0.8394129,0.8338099},{0.8489018,0.8504233,0.8445640},{0.8606922,0.8614337,0.8560352},{0.8724824,0.8729685,0.8675064},
	{0.8847640,0.8850275,0.8789775},{0.8970456,0.8976108,0.8904487},{0.9088359,0.9096699,0.9019198},{0.9211174,0.9217288,0.9141080},
	{0.9329078,0.9332635,0.9255791},{0.9446980,0.9447983,0.9363333},{0.9559971,0.9563330,0.9478045},{0.9677874,0.9678677,0.9585586},
	{0.9800690,0.9794025,0.9700298},{0.9923505,0.9914614,0.9815010},{1.0056146,1.0050935,0.9929721},{1.0188787,1.0182011,1.0051603},
	{1.0336166,1.0318330,1.0194992},{1.0483545,1.0470379,1.0345551},{1.0640749,1.0627670,1.0503279},{1.0817603,1.0790204,1.0661008},
	{1.1004283,1.0957982,1.0833076},{1.1181137,1.1146732,1.1005143},{1.1377643,1.1345968,1.1184380},{1.1583973,1.1545204,1.1370787},
	{1.1790303,1.1754927,1.1564362},{1.2006459,1.1964649,1.1765107},{1.2242265,1.2195343,1.1965852},{1.2478071,1.2426038,1.2180936},
	{1.2723702,1.2667218,1.2417529},{1.2979159,1.2918884,1.2675630},{1.3264091,1.3191523,1.2948070},{1.3578500,1.3485135,1.3227680},
	{1.3912558,1.3799717,1.3507290},{1.4276092,1.4156245,1.3815577},{1.4659277,1.4544231,1.4174050},{1.5032636,1.4900759,1.4525354},
	{1.5405996,1.5278259,1.4869489},{1.5789181,1.5655758,1.5213624},{1.6192016,1.6043744,1.5572098},{1.6614502,1.6431730,1.5930571},
	{1.7056639,1.6840689,1.6303385},{1.7488949,1.7249647,1.6676197},{1.7940911,1.7669091,1.7049009},{1.8402699,1.8088535,1.7421822},
	{1.8864485,1.8518466,1.7808973},{1.9336097,1.8969369,1.8181786},{1.9788059,1.9430757,1.8568938},{2.0240021,1.9902632,1.8956089},
	{2.0711633,2.0374506,1.9343241},{2.1222546,2.0835896,1.9701715},{2.1753110,2.1244854,2.0060188},{2.2264022,2.1664298,2.0461679},
	{2.2735635,2.2104715,2.0877509},{2.3187596,2.2545131,2.1307678},{2.3639558,2.2985548,2.1723507},{2.4091519,2.3425964,2.2139336},
	{2.4523831,2.3866380,2.2540826},{2.4975793,2.4285826,2.2942317},{2.5388453,2.4705269,2.3329469},{2.5801113,2.5103741,2.3716621},
	{2.6213775,2.5502213,2.4089433},{2.6606784,2.5879713,2.4447907},{2.6980144,2.6236241,2.4792042},{2.7353504,2.6592769,2.5121837},
	{2.7687562,2.6928324,2.5437295},{2.8021620,2.7263880,2.5752750},{2.8336028,2.7557490,2.6039530},{2.8630786,2.7851102,2.6297631},
	{2.8905894,2.8102768,2.6555733},{2.9141700,2.8354435,2.6785156},{2.9377506,2.8564156,2.7000240},{2.9593661,2.8773879,2.7186646},
	{2.9770516,2.8941657,2.7344375},{2.9927720,2.9109434,2.7502103},{3.0065273,2.9235267,2.7616815},{3.0163526,2.9340129,2.7717187},
	{3.0261778,2.9424018,2.7803221},{3.0320730,2.9486935,2.7846238},{3.0340380,2.9507907,2.7874916},{3.0340380,2.9507907,2.7889255}
};

//preintegrated cumulative distribution (from 1D pdf)
static const dfloat3 miecdf[] = {
	{0.0000000,0.0000000,0.0000000},{0.0000027,0.0000027,0.0000026},{0.0000107,0.0000103,0.0000096},{0.0000222,0.0000215,0.0000216},
	{0.0000353,0.0000359,0.0000375},{0.0000517,0.0000536,0.0000524},{0.0000736,0.0000732,0.0000655},{0.0001004,0.0000936,0.0000819},
	{0.0001288,0.0001175,0.0001070},{0.0001591,0.0001491,0.0001387},{0.0001958,0.0001883,0.0001732},{0.0002412,0.0002324,0.0002113},
	{0.0002938,0.0002807,0.0002550},{0.0003505,0.0003337,0.0003049},{0.0004098,0.0003916,0.0003596},{0.0004718,0.0004529,0.0004169},
	{0.0005362,0.0005161,0.0004753},{0.0006021,0.0005799,0.0005346},{0.0006685,0.0006437,0.0005945},{0.0007343,0.0007074,0.0006548},
	{0.0007992,0.0007705,0.0007154},{0.0008631,0.0008328,0.0007759},{0.0009263,0.0008946,0.0008354},{0.0009889,0.0009560,0.0008937},
	{0.0010510,0.0010169,0.0009507},{0.0011125,0.0010774,0.0010073},{0.0011733,0.0011372,0.0010645},{0.0012335,0.0011962,0.0011226},
	{0.0012936,0.0012549,0.0011809},{0.0013536,0.0013137,0.0012391},{0.0014138,0.0013730,0.0012968},{0.0014743,0.0014328,0.0013542},
	{0.0015351,0.0014927,0.0014119},{0.0015960,0.0015526,0.0014707},{0.0016572,0.0016127,0.0015300},{0.0017190,0.0016734,0.0015893},
	{0.0017812,0.0017348,0.0016487},{0.0018437,0.0017966,0.0017090},{0.0019066,0.0018587,0.0017704},{0.0019698,0.0019208,0.0018332},
	{0.0020336,0.0019833,0.0018969},{0.0020980,0.0020465,0.0019606},{0.0021631,0.0021111,0.0020239},{0.0022288,0.0021767,0.0020871},
	{0.0022953,0.0022430,0.0021507},{0.0023623,0.0023095,0.0022160},{0.0024297,0.0023762,0.0022834},{0.0024978,0.0024436,0.0023522},
	{0.0025669,0.0025121,0.0024212},{0.0026370,0.0025818,0.0024905},{0.0027081,0.0026525,0.0025600},{0.0027801,0.0027240,0.0026305},
	{0.0028526,0.0027959,0.0027023},{0.0029257,0.0028683,0.0027753},{0.0029995,0.0029416,0.0028489},{0.0030737,0.0030158,0.0029232},
	{0.0031486,0.0030909,0.0029983},{0.0032244,0.0031667,0.0030739},{0.0033011,0.0032431,0.0031501},{0.0033786,0.0033202,0.0032273},
	{0.0034569,0.0033978,0.0033056},{0.0035360,0.0034759,0.0033851},{0.0036156,0.0035548,0.0034659},{0.0036957,0.0036346,0.0035475},
	{0.0037768,0.0037153,0.0036293},{0.0038589,0.0037971,0.0037114},{0.0039419,0.0038798,0.0037940},{0.0040255,0.0039634,0.0038776},
	{0.0041099,0.0040478,0.0039623},{0.0041949,0.0041330,0.0040484},{0.0042807,0.0042190,0.0041358},{0.0043674,0.0043059,0.0042241},
	{0.0044553,0.0043936,0.0043133},{0.0045440,0.0044822,0.0044036},{0.0046337,0.0045715,0.0044949},{0.0047244,0.0046617,0.0045871},
	{0.0048160,0.0047529,0.0046800},{0.0049084,0.0048454,0.0047736},{0.0050016,0.0049386,0.0048684},{0.0050957,0.0050326,0.0049647},
	{0.0051907,0.0051276,0.0050620},{0.0052870,0.0052236,0.0051598},{0.0053845,0.0053204,0.0052584},{0.0054830,0.0054183,0.0053581},
	{0.0055819,0.0055175,0.0054592},{0.0056815,0.0056177,0.0055616},{0.0057821,0.0057188,0.0056653},{0.0058839,0.0058211,0.0057700},
	{0.0059866,0.0059245,0.0058759},{0.0060904,0.0060289,0.0059831},{0.0061956,0.0061343,0.0060913},{0.0063022,0.0062406,0.0062004},
	{0.0064100,0.0063479,0.0063106},{0.0065187,0.0064561,0.0064222},{0.0066285,0.0065654,0.0065350},{0.0067395,0.0066758,0.0066486},
	{0.0068517,0.0067877,0.0067628},{0.0069647,0.0069011,0.0068782},{0.0070783,0.0070158,0.0069956},{0.0071927,0.0071315,0.0071150},
	{0.0073083,0.0072481,0.0072363},{0.0074253,0.0073657,0.0073588},{0.0075440,0.0074843,0.0074822},{0.0076643,0.0076041,0.0076061},
	{0.0077859,0.0077254,0.0077310},{0.0079085,0.0078482,0.0078568},{0.0080322,0.0079724,0.0079839},{0.0081569,0.0080977,0.0081128},
	{0.0082826,0.0082240,0.0082440},{0.0084097,0.0083514,0.0083767},{0.0085384,0.0084801,0.0085104},{0.0086684,0.0086104,0.0086452},
	{0.0087995,0.0087420,0.0087817},{0.0089316,0.0088750,0.0089198},{0.0090653,0.0090091,0.0090592},{0.0092002,0.0091445,0.0091999},
	{0.0093363,0.0092814,0.0093421},{0.0094738,0.0094196,0.0094858},{0.0096129,0.0095593,0.0096307},{0.0097536,0.0097003,0.0097767},
	{0.0098957,0.0098427,0.0099246},{0.0100390,0.0099863,0.0100747},{0.0101837,0.0101313,0.0102264},{0.0103298,0.0102780,0.0103791},
	{0.0104773,0.0104262,0.0105332},{0.0106259,0.0105756,0.0106892},{0.0107756,0.0107269,0.0108466},{0.0109269,0.0108797,0.0110054},
	{0.0110798,0.0110336,0.0111659},{0.0112345,0.0111887,0.0113281},{0.0113906,0.0113453,0.0114922},{0.0115482,0.0115032,0.0116582},
	{0.0117073,0.0116625,0.0118260},{0.0118682,0.0118236,0.0119951},{0.0120305,0.0119866,0.0121655},{0.0121942,0.0121515,0.0123373},
	{0.0123598,0.0123177,0.0125111},{0.0125272,0.0124854,0.0126868},{0.0126959,0.0126549,0.0128646},{0.0128658,0.0128264,0.0130445},
	{0.0130374,0.0129996,0.0132262},{0.0132109,0.0131741,0.0134093},{0.0133862,0.0133501,0.0135941},{0.0135629,0.0135275,0.0137809},
	{0.0137408,0.0137066,0.0139696},{0.0139202,0.0138872,0.0141600},{0.0141012,0.0140691,0.0143514},{0.0142839,0.0142525,0.0145439},
	{0.0144677,0.0144372,0.0147381},{0.0146521,0.0146234,0.0149343},{0.0148373,0.0148110,0.0151318},{0.0150242,0.0149996,0.0153301},
	{0.0152121,0.0151892,0.0155293},{0.0154007,0.0153798,0.0157300},{0.0155903,0.0155711,0.0159318},{0.0157812,0.0157629,0.0161344},
	{0.0159728,0.0159551,0.0163385},{0.0161648,0.0161481,0.0165443},{0.0163578,0.0163419,0.0167509},{0.0165525,0.0165365,0.0169579},
	{0.0167490,0.0167317,0.0171653},{0.0169467,0.0169281,0.0173734},{0.0171453,0.0171257,0.0175821},{0.0173451,0.0173246,0.0177912},
	{0.0175462,0.0175245,0.0180007},{0.0177481,0.0177261,0.0182108},{0.0179505,0.0179299,0.0184218},{0.0181537,0.0181355,0.0186336},
	{0.0183581,0.0183426,0.0188473},{0.0185627,0.0185515,0.0190643},{0.0187670,0.0187628,0.0192854},{0.0189719,0.0189767,0.0195102},
	{0.0191783,0.0191925,0.0197391},{0.0193866,0.0194097,0.0199737},{0.0195969,0.0196287,0.0202146},{0.0198098,0.0198502,0.0204614},
	{0.0200267,0.0200744,0.0207132},{0.0202496,0.0203012,0.0209690},{0.0204792,0.0205315,0.0212283},{0.0207160,0.0207663,0.0214909},
	{0.0209619,0.0210064,0.0217548},{0.0212190,0.0212525,0.0220184},{0.0214863,0.0215060,0.0222828},{0.0217628,0.0217684,0.0225498},
	{0.0220488,0.0220406,0.0228201},{0.0223440,0.0223227,0.0230952},{0.0226475,0.0226150,0.0233779},{0.0229583,0.0229176,0.0236708},
	{0.0232754,0.0232303,0.0239776},{0.0235975,0.0235530,0.0243014},{0.0239249,0.0238856,0.0246431},{0.0242582,0.0242283,0.0250026},
	{0.0245960,0.0245809,0.0253825},{0.0249381,0.0249435,0.0257835},{0.0252864,0.0253163,0.0262020},{0.0256419,0.0256991,0.0266360},
	{0.0260033,0.0260922,0.0270869},{0.0263713,0.0264960,0.0275524},{0.0267490,0.0269110,0.0280257},{0.0271378,0.0273371,0.0285038},
	{0.0275371,0.0277728,0.0289875},{0.0279485,0.0282174,0.0294738},{0.0283764,0.0286702,0.0299552},{0.0288214,0.0291289,0.0304312},
	{0.0292808,0.0295911,0.0309069},{0.0297523,0.0300547,0.0313858},{0.0302338,0.0305173,0.0318713},{0.0307217,0.0309769,0.0323687},
	{0.0312118,0.0314346,0.0328799},{0.0317007,0.0318922,0.0334035},{0.0321858,0.0323504,0.0339393},{0.0326661,0.0328085,0.0344863},
	{0.0331423,0.0332666,0.0350406},{0.0336141,0.0337258,0.0355976},{0.0340804,0.0341863,0.0361556},{0.0345413,0.0346468,0.0367128},
	{0.0349976,0.0351069,0.0372665},{0.0354492,0.0355666,0.0378139},{0.0358954,0.0360257,0.0383534},{0.0363365,0.0364833,0.0388834},
	{0.0367732,0.0369383,0.0394022},{0.0372052,0.0373908,0.0399080},{0.0376322,0.0378403,0.0404002},{0.0380545,0.0382860,0.0408783},
	{0.0384724,0.0387274,0.0413407},{0.0388856,0.0391639,0.0417870},{0.0392937,0.0395947,0.0422176},{0.0396967,0.0400191,0.0426318},
	{0.0400947,0.0404373,0.0430285},{0.0404877,0.0408485,0.0434074},{0.0408754,0.0412514,0.0437698},{0.0412575,0.0416457,0.0441158},
	{0.0416336,0.0420319,0.0444449},{0.0420039,0.0424094,0.0447574},{0.0423685,0.0427776,0.0450544},{0.0427273,0.0431363,0.0453360},
	{0.0430804,0.0434854,0.0456028},{0.0434277,0.0438248,0.0458554},{0.0437690,0.0441545,0.0460944},{0.0441039,0.0444749,0.0463199},
	{0.0444329,0.0447856,0.0465325},{0.0447564,0.0450861,0.0467330},{0.0450734,0.0453769,0.0469225},{0.0453833,0.0456584,0.0471022},
	{0.0456866,0.0459301,0.0472728},{0.0459838,0.0461919,0.0474347},{0.0462737,0.0464447,0.0475889},{0.0465560,0.0466892,0.0477364},
	{0.0468318,0.0469242,0.0478776},{0.0471020,0.0471495,0.0480127},{0.0473655,0.0473667,0.0481418},{0.0476214,0.0475768,0.0482662},
	{0.0478692,0.0477798,0.0483875},{0.0481089,0.0479759,0.0485066},{0.0483414,0.0481650,0.0486227},{0.0485675,0.0483470,0.0487357},
	{0.0487870,0.0485219,0.0488474},{0.0489985,0.0486909,0.0489586},{0.0492023,0.0488552,0.0490683},{0.0493990,0.0490149,0.0491762},
	{0.0495888,0.0491695,0.0492834},{0.0497720,0.0493193,0.0493904},{0.0499493,0.0494644,0.0494964},{0.0501215,0.0496055,0.0496007},
	{0.0502877,0.0497435,0.0497036},{0.0504479,0.0498785,0.0498062},{0.0506031,0.0500104,0.0499077},{0.0507544,0.0501390,0.0500076},
	{0.0509018,0.0502648,0.0501058},{0.0510453,0.0503880,0.0502025},{0.0511849,0.0505094,0.0502973},{0.0513206,0.0506295,0.0503905},
	{0.0514525,0.0507482,0.0504822},{0.0515817,0.0508647,0.0505728},{0.0517089,0.0509787,0.0506623},{0.0518340,0.0510907,0.0507505},
	{0.0519569,0.0512019,0.0508371},{0.0520776,0.0513121,0.0509224},{0.0521966,0.0514211,0.0510070},{0.0523140,0.0515288,0.0510911},
	{0.0524300,0.0516355,0.0511745},{0.0525450,0.0517413,0.0512568},{0.0526589,0.0518464,0.0513382},{0.0527715,0.0519513,0.0514187},
	{0.0528828,0.0520561,0.0514984},{0.0529929,0.0521606,0.0515778},{0.0531019,0.0522642,0.0516575},{0.0532103,0.0523672,0.0517371},
	{0.0533180,0.0524700,0.0518163},{0.0534248,0.0525725,0.0518958},{0.0535307,0.0526749,0.0519758},{0.0536359,0.0527768,0.0520565},
	{0.0537406,0.0528784,0.0521379},{0.0538450,0.0529799,0.0522198},{0.0539490,0.0530814,0.0523020},{0.0540527,0.0531832,0.0523846},
	{0.0541561,0.0532853,0.0524676},{0.0542593,0.0533876,0.0525512},{0.0543623,0.0534899,0.0526358},{0.0544650,0.0535924,0.0527213},
	{0.0545672,0.0536951,0.0528080},{0.0546690,0.0537979,0.0528962},{0.0547706,0.0539007,0.0529858},{0.0548719,0.0540035,0.0530767},
	{0.0549730,0.0541064,0.0531691},{0.0550739,0.0542096,0.0532628},{0.0551748,0.0543130,0.0533575},{0.0552759,0.0544167,0.0534534},
	{0.0553771,0.0545205,0.0535505},{0.0554784,0.0546246,0.0536488},{0.0555797,0.0547291,0.0537482},{0.0556810,0.0548337,0.0538491},
	{0.0557822,0.0549381,0.0539516},{0.0558834,0.0550425,0.0540557},{0.0559846,0.0551468,0.0541613},{0.0560855,0.0552512,0.0542688},
	{0.0561862,0.0553559,0.0543777},{0.0562872,0.0554608,0.0544879},{0.0563885,0.0555655,0.0545993},{0.0564899,0.0556703,0.0547122},
	{0.0565912,0.0557755,0.0548261},{0.0566926,0.0558810,0.0549406},{0.0567944,0.0559864,0.0550558},{0.0568965,0.0560912,0.0551723},
	{0.0569987,0.0561958,0.0552900},{0.0571010,0.0563004,0.0554084},{0.0572035,0.0564047,0.0555279},{0.0573062,0.0565087,0.0556486},
	{0.0574090,0.0566126,0.0557701},{0.0575120,0.0567164,0.0558922},{0.0576154,0.0568198,0.0560150},{0.0577190,0.0569231,0.0561378},
	{0.0578230,0.0570266,0.0562602},{0.0579268,0.0571305,0.0563825},{0.0580305,0.0572342,0.0565052},{0.0581348,0.0573373,0.0566279},
	{0.0582401,0.0574400,0.0567491},{0.0583457,0.0575430,0.0568692},{0.0584506,0.0576463,0.0569891},{0.0585554,0.0577492,0.0571088},
	{0.0586610,0.0578514,0.0572274},{0.0587676,0.0579531,0.0573445},{0.0588742,0.0580548,0.0574605},{0.0589801,0.0581572,0.0575754},
	{0.0590855,0.0582602,0.0576891},{0.0591910,0.0583630,0.0578016},{0.0592970,0.0584648,0.0579134},{0.0594029,0.0585665,0.0580236},
	{0.0595081,0.0586687,0.0581321},{0.0596120,0.0587714,0.0582397},{0.0597150,0.0588737,0.0583469},{0.0598175,0.0589753,0.0584533},
	{0.0599194,0.0590763,0.0585588},{0.0600200,0.0591772,0.0586638},{0.0601190,0.0592785,0.0587678},{0.0602170,0.0593795,0.0588708},
	{0.0603139,0.0594797,0.0589737},{0.0604091,0.0595789,0.0590771},{0.0605029,0.0596773,0.0591804},{0.0605957,0.0597748,0.0592830},
	{0.0606876,0.0598712,0.0593851},{0.0607783,0.0599663,0.0594871},{0.0608678,0.0600603,0.0595890},{0.0609562,0.0601529,0.0596908},
	{0.0610440,0.0602443,0.0597921},{0.0611312,0.0603345,0.0598923},{0.0612177,0.0604241,0.0599912},{0.0613032,0.0605131,0.0600890},
	{0.0613880,0.0606011,0.0601858},{0.0614723,0.0606880,0.0602813},{0.0615562,0.0607743,0.0603748},{0.0616394,0.0608603,0.0604663},
	{0.0617219,0.0609458,0.0605559},{0.0618040,0.0610301,0.0606443},{0.0618859,0.0611132,0.0607313},{0.0619673,0.0611956,0.0608164},
	{0.0620478,0.0612776,0.0608997},{0.0621279,0.0613587,0.0609815},{0.0622078,0.0614384,0.0610622},{0.0622874,0.0615170,0.0611416},
	{0.0623665,0.0615949,0.0612196},{0.0624449,0.0616721,0.0612963},{0.0625227,0.0617484,0.0613722},{0.0625997,0.0618237,0.0614475},
	{0.0626761,0.0618980,0.0615219},{0.0627518,0.0619716,0.0615954},{0.0628269,0.0620443,0.0616681},{0.0629011,0.0621163,0.0617405},
	{0.0629745,0.0621874,0.0618128},{0.0630468,0.0622577,0.0618854},{0.0631183,0.0623274,0.0619581},{0.0631890,0.0623966,0.0620304},
	{0.0632593,0.0624653,0.0621021},{0.0633290,0.0625334,0.0621737},{0.0633979,0.0626008,0.0622456},{0.0634657,0.0626679,0.0623176},
	{0.0635327,0.0627351,0.0623891},{0.0635991,0.0628020,0.0624601},{0.0636649,0.0628686,0.0625311},{0.0637303,0.0629348,0.0626019},
	{0.0637954,0.0630009,0.0626718},{0.0638602,0.0630670,0.0627411},{0.0639245,0.0631330,0.0628102},{0.0639881,0.0631988,0.0628794},
	{0.0640515,0.0632643,0.0629486},{0.0641148,0.0633297,0.0630173},{0.0641782,0.0633951,0.0630852},{0.0642417,0.0634605,0.0631523},
	{0.0643053,0.0635259,0.0632189},{0.0643686,0.0635911,0.0632857},{0.0644319,0.0636561,0.0633524},{0.0644953,0.0637212,0.0634187},
	{0.0645591,0.0637864,0.0634843},{0.0646231,0.0638517,0.0635497},{0.0646872,0.0639169,0.0636151},{0.0647515,0.0639820,0.0636804},
	{0.0648160,0.0640470,0.0637457},{0.0648807,0.0641118,0.0638111},{0.0649456,0.0641764,0.0638766},{0.0650106,0.0642407,0.0639425},
	{0.0650757,0.0643048,0.0640088},{0.0651408,0.0643690,0.0640751},{0.0652062,0.0644334,0.0641412},{0.0652717,0.0644977,0.0642076},
	{0.0653374,0.0645618,0.0642744},{0.0654031,0.0646261,0.0643413},{0.0654687,0.0646907,0.0644083},{0.0655343,0.0647556,0.0644754},
	{0.0655999,0.0648209,0.0645425},{0.0656656,0.0648866,0.0646093},{0.0657315,0.0649524,0.0646762},{0.0657974,0.0650183,0.0647434},
	{0.0658631,0.0650845,0.0648108},{0.0659286,0.0651511,0.0648784},{0.0659943,0.0652178,0.0649462},{0.0660603,0.0652844,0.0650140},
	{0.0661268,0.0653510,0.0650819},{0.0661935,0.0654178,0.0651499},{0.0662602,0.0654849,0.0652182},{0.0663270,0.0655522,0.0652871},
	{0.0663939,0.0656196,0.0653564},{0.0664613,0.0656872,0.0654254},{0.0665295,0.0657548,0.0654940},{0.0665980,0.0658227,0.0655625},
	{0.0666664,0.0658909,0.0656313},{0.0667345,0.0659596,0.0657004},{0.0668026,0.0660286,0.0657697},{0.0668711,0.0660976,0.0658389},
	{0.0669402,0.0661667,0.0659078},{0.0670097,0.0662361,0.0659764},{0.0670792,0.0663060,0.0660453},{0.0671484,0.0663761,0.0661148},
	{0.0672176,0.0664465,0.0661847},{0.0672872,0.0665171,0.0662547},{0.0673573,0.0665877,0.0663248},{0.0674277,0.0666583,0.0663951},
	{0.0674982,0.0667292,0.0664656},{0.0675688,0.0668003,0.0665365},{0.0676396,0.0668716,0.0666078},{0.0677106,0.0669431,0.0666795},
	{0.0677819,0.0670148,0.0667515},{0.0678536,0.0670865,0.0668237},{0.0679258,0.0671585,0.0668961},{0.0679981,0.0672308,0.0669688},
	{0.0680706,0.0673034,0.0670417},{0.0681434,0.0673764,0.0671148},{0.0682166,0.0674497,0.0671882},{0.0682901,0.0675233,0.0672618},
	{0.0683639,0.0675974,0.0673354},{0.0684381,0.0676718,0.0674091},{0.0685129,0.0677465,0.0674830},{0.0685879,0.0678214,0.0675575},
	{0.0686631,0.0678969,0.0676321},{0.0687387,0.0679729,0.0677067},{0.0688149,0.0680490,0.0677816},{0.0688915,0.0681254,0.0678572},
	{0.0689683,0.0682023,0.0679333},{0.0690456,0.0682796,0.0680095},{0.0691233,0.0683572,0.0680861},{0.0692013,0.0684350,0.0681634},
	{0.0692796,0.0685131,0.0682413},{0.0693584,0.0685916,0.0683195},{0.0694378,0.0686706,0.0683978},{0.0695173,0.0687500,0.0684767},
	{0.0695972,0.0688297,0.0685565},{0.0696774,0.0689096,0.0686370},{0.0697583,0.0689902,0.0687176},{0.0698397,0.0690713,0.0687982},
	{0.0699217,0.0691529,0.0688795},{0.0700041,0.0692350,0.0689614},{0.0700870,0.0693178,0.0690437},{0.0701704,0.0694013,0.0691265},
	{0.0702544,0.0694853,0.0692097},{0.0703392,0.0695700,0.0692931},{0.0704248,0.0696551,0.0693767},{0.0705109,0.0697409,0.0694607},
	{0.0705972,0.0698275,0.0695454},{0.0706837,0.0699147,0.0696308},{0.0707711,0.0700025,0.0697163},{0.0708595,0.0700905,0.0698019},
	{0.0709488,0.0701792,0.0698882},{0.0710383,0.0702685,0.0699755},{0.0711284,0.0703588,0.0700636},{0.0712193,0.0704499,0.0701522},
	{0.0713110,0.0705414,0.0702418},{0.0714034,0.0706332,0.0703327},{0.0714968,0.0707258,0.0704237},{0.0715913,0.0708191,0.0705148},
	{0.0716861,0.0709130,0.0706071},{0.0717810,0.0710074,0.0707012},{0.0718766,0.0711025,0.0707961},{0.0719736,0.0711982,0.0708909},
	{0.0720718,0.0712946,0.0709859},{0.0721705,0.0713918,0.0710822},{0.0722697,0.0714899,0.0711797},{0.0723698,0.0715889,0.0712779},
	{0.0724707,0.0716889,0.0713769},{0.0725725,0.0717899,0.0714767},{0.0726755,0.0718917,0.0715769},{0.0727797,0.0719945,0.0716775},
	{0.0728849,0.0720983,0.0717791},{0.0729904,0.0722033,0.0718820},{0.0730965,0.0723096,0.0719858},{0.0732040,0.0724169,0.0720901},
	{0.0733132,0.0725248,0.0721948},{0.0734234,0.0726336,0.0723008},{0.0735342,0.0727436,0.0724081},{0.0736459,0.0728550,0.0725162},
	{0.0737585,0.0729674,0.0726253},{0.0738723,0.0730804,0.0727358},{0.0739872,0.0731940,0.0728477},{0.0741035,0.0733085,0.0729603},
	{0.0742210,0.0734242,0.0730737},{0.0743393,0.0735411,0.0731888},{0.0744583,0.0736592,0.0733060},{0.0745788,0.0737784,0.0734245},
	{0.0747012,0.0738984,0.0735439},{0.0748252,0.0740196,0.0736643},{0.0749499,0.0741423,0.0737862},{0.0750755,0.0742665,0.0739095},
	{0.0752025,0.0743916,0.0740341},{0.0753311,0.0745178,0.0741596},{0.0754610,0.0746455,0.0742858},{0.0755920,0.0747748,0.0744132},
	{0.0757243,0.0749055,0.0745417},{0.0758581,0.0750377,0.0746715},{0.0759935,0.0751713,0.0748026},{0.0761304,0.0753064,0.0749351},
	{0.0762690,0.0754433,0.0750688},{0.0764092,0.0755820,0.0752035},{0.0765508,0.0757223,0.0753396},{0.0766938,0.0758640,0.0754776},
	{0.0768385,0.0760072,0.0756170},{0.0769850,0.0761517,0.0757577},{0.0771330,0.0762978,0.0758997},{0.0772824,0.0764457,0.0760434},
	{0.0774333,0.0765952,0.0761887},{0.0775861,0.0767461,0.0763358},{0.0777407,0.0768984,0.0764850},{0.0778970,0.0770524,0.0766359},
	{0.0780551,0.0772085,0.0767884},{0.0782148,0.0773664,0.0769427},{0.0783762,0.0775259,0.0770992},{0.0785395,0.0776869,0.0772580},
	{0.0787047,0.0778497,0.0774183},{0.0788716,0.0780144,0.0775801},{0.0790401,0.0781810,0.0777440},{0.0792104,0.0783494,0.0779102},
	{0.0793824,0.0785197,0.0780784},{0.0795567,0.0786918,0.0782483},{0.0797333,0.0788659,0.0784200},{0.0799118,0.0790423,0.0785937},
	{0.0800921,0.0792211,0.0787699},{0.0802742,0.0794019,0.0789486},{0.0804586,0.0795848,0.0791293},{0.0806458,0.0797700,0.0793114},
	{0.0808352,0.0799574,0.0794957},{0.0810263,0.0801472,0.0796831},{0.0812194,0.0803394,0.0798730},{0.0814152,0.0805340,0.0800648},
	{0.0816139,0.0807308,0.0802584},{0.0818147,0.0809301,0.0804546},{0.0820176,0.0811318,0.0806535},{0.0822228,0.0813357,0.0808549},
	{0.0824306,0.0815419,0.0810585},{0.0826409,0.0817506,0.0812643},{0.0828536,0.0819616,0.0814725},{0.0830688,0.0821749,0.0816834},
	{0.0832866,0.0823905,0.0818972},{0.0835069,0.0826087,0.0821136},{0.0837299,0.0828297,0.0823327},{0.0839554,0.0830532,0.0825547},
	{0.0841839,0.0832792,0.0827793},{0.0844155,0.0835078,0.0830066},{0.0846498,0.0837390,0.0832368},{0.0848868,0.0839729,0.0834701},
	{0.0851262,0.0842095,0.0837066},{0.0853683,0.0844494,0.0839455},{0.0856135,0.0846922,0.0841866},{0.0858616,0.0849371,0.0844311},
	{0.0861127,0.0851841,0.0846793},{0.0863670,0.0854346,0.0849296},{0.0866241,0.0856892,0.0851820},{0.0868836,0.0859469,0.0854389},
	{0.0871461,0.0862074,0.0857005},{0.0874126,0.0864713,0.0859644},{0.0876832,0.0867391,0.0862305},{0.0879571,0.0870103,0.0865010},
	{0.0882339,0.0872849,0.0867760},{0.0885143,0.0875633,0.0870544},{0.0887979,0.0878456,0.0873361},{0.0890847,0.0881312,0.0876223},
	{0.0893751,0.0884200,0.0879121},{0.0896692,0.0887122,0.0882050},{0.0899663,0.0890080,0.0885019},{0.0902669,0.0893072,0.0888030},
	{0.0905713,0.0896099,0.0891076},{0.0908791,0.0899162,0.0894161},{0.0911899,0.0902262,0.0897293},{0.0915046,0.0905401,0.0900460},
	{0.0918236,0.0908578,0.0903658},{0.0921462,0.0911793,0.0906899},{0.0924723,0.0915044,0.0910188},{0.0928028,0.0918334,0.0913510},
	{0.0931376,0.0921668,0.0916868},{0.0934760,0.0925043,0.0920271},{0.0938184,0.0928460,0.0923721},{0.0941654,0.0931917,0.0927210},
	{0.0945169,0.0935416,0.0930742},{0.0948724,0.0938960,0.0934319},{0.0952323,0.0942547,0.0937943},{0.0955969,0.0946175,0.0941618},
	{0.0959659,0.0949846,0.0945341},{0.0963396,0.0953566,0.0949104},{0.0967178,0.0957332,0.0952914},{0.0970999,0.0961140,0.0956783},
	{0.0974862,0.0964994,0.0960702},{0.0978781,0.0968894,0.0964656},{0.0982753,0.0972839,0.0968653},{0.0986766,0.0976832,0.0972710},
	{0.0990818,0.0980876,0.0976826},{0.0994921,0.0984971,0.0980988},{0.0999080,0.0989113,0.0985194},{0.1003290,0.0993303,0.0989454},
	{0.1007545,0.0997544,0.0993774},{0.1011848,0.1001838,0.0998150},{0.1016208,0.1006183,0.1002574},{0.1020620,0.1010578,0.1007053},
	{0.1025078,0.1015028,0.1011595},{0.1029591,0.1019534,0.1016192},{0.1034167,0.1024090,0.1020841},{0.1038797,0.1028699,0.1025553},
	{0.1043468,0.1033370,0.1030332},{0.1048194,0.1038102,0.1035166},{0.1052989,0.1042884,0.1040048},{0.1057847,0.1047717,0.1044990},
	{0.1062750,0.1052613,0.1050001},{0.1067700,0.1057577,0.1055072},{0.1072714,0.1062600,0.1060197},{0.1077797,0.1067674,0.1065378},
	{0.1082937,0.1072810,0.1070624},{0.1088132,0.1078011,0.1075933},{0.1093389,0.1083276,0.1081304},{0.1098708,0.1088601,0.1086742},
	{0.1104090,0.1093989,0.1092251},{0.1109539,0.1099443,0.1097822},{0.1115055,0.1104964,0.1103456},{0.1120634,0.1110544,0.1109166},
	{0.1126275,0.1116190,0.1114949},{0.1131981,0.1121908,0.1120792},{0.1137750,0.1127694,0.1126700},{0.1143584,0.1133543,0.1132680},
	{0.1149486,0.1139458,0.1138727},{0.1155457,0.1145441,0.1144838},{0.1161491,0.1151494,0.1151021},{0.1167590,0.1157618,0.1157282},
	{0.1173759,0.1163812,0.1163619},{0.1180003,0.1170078,0.1170023},{0.1186322,0.1176414,0.1176504},{0.1192713,0.1182818,0.1183067},
	{0.1199170,0.1189299,0.1189710},{0.1205695,0.1195857,0.1196427},{0.1212301,0.1202483,0.1203218},{0.1218988,0.1209179,0.1210088},
	{0.1225745,0.1215956,0.1217040},{0.1232574,0.1222817,0.1224073},{0.1239482,0.1229757,0.1231182},{0.1246469,0.1236777,0.1238375},
	{0.1253538,0.1243876,0.1245655},{0.1260689,0.1251055,0.1253018},{0.1267921,0.1258317,0.1260467},{0.1275231,0.1265665,0.1268003},
	{0.1282620,0.1273096,0.1275622},{0.1290093,0.1280607,0.1283330},{0.1297647,0.1288198,0.1291129},{0.1305279,0.1295873,0.1299008},
	{0.1312994,0.1303629,0.1306960},{0.1320789,0.1311460,0.1314995},{0.1328656,0.1319372,0.1323123},{0.1336599,0.1327377,0.1331332},
	{0.1344636,0.1335473,0.1339624},{0.1352771,0.1343655,0.1348014},{0.1360997,0.1351936,0.1356510},{0.1369319,0.1360317,0.1365111},
	{0.1377736,0.1368798,0.1373806},{0.1386246,0.1377381,0.1382594},{0.1394850,0.1386042,0.1391490},{0.1403545,0.1394782,0.1400477},
	{0.1412322,0.1403623,0.1409545},{0.1421179,0.1412563,0.1418715},{0.1430128,0.1421587,0.1427986},{0.1439182,0.1430703,0.1437344},
	{0.1448332,0.1439919,0.1446801},{0.1457569,0.1449238,0.1456372},{0.1466901,0.1458663,0.1466048},{0.1476343,0.1468183,0.1475823},
	{0.1485891,0.1477799,0.1485698},{0.1495530,0.1487527,0.1495685},{0.1505262,0.1497364,0.1505788},{0.1515101,0.1507295,0.1516001},
	{0.1525046,0.1517322,0.1526315},{0.1535097,0.1527456,0.1536731},{0.1545257,0.1537696,0.1547251},{0.1555521,0.1548038,0.1557887},
	{0.1565874,0.1558489,0.1568657},{0.1576315,0.1569056,0.1579549},{0.1586873,0.1579733,0.1590535},{0.1597570,0.1590505,0.1601611},
	{0.1608390,0.1601370,0.1612804},{0.1619301,0.1612349,0.1624140},{0.1630292,0.1623464,0.1635604},{0.1641391,0.1634716,0.1647169},
	{0.1652619,0.1646064,0.1658854},{0.1663973,0.1657497,0.1670678},{0.1675449,0.1669048,0.1682608},{0.1687049,0.1680728,0.1694628},
	{0.1698748,0.1692525,0.1706781},{0.1710531,0.1704438,0.1719087},{0.1722425,0.1716466,0.1731515},{0.1734457,0.1728605,0.1744040},
	{0.1746617,0.1740857,0.1756668},{0.1758885,0.1753227,0.1769428},{0.1771270,0.1765713,0.1782326},{0.1783784,0.1778326,0.1795338},
	{0.1796413,0.1791077,0.1808476},{0.1809156,0.1803961,0.1821762},{0.1822043,0.1816963,0.1835174},{0.1835083,0.1830082,0.1848707},
	{0.1848238,0.1843336,0.1862377},{0.1861498,0.1856743,0.1876185},{0.1874903,0.1870278,0.1890116},{0.1888461,0.1883926,0.1904175},
	{0.1902143,0.1897713,0.1918374},{0.1915940,0.1911654,0.1932713},{0.1929877,0.1925732,0.1947177},{0.1943961,0.1939938,0.1961764},
	{0.1958175,0.1954270,0.1976507},{0.1972521,0.1968731,0.1991397},{0.1987011,0.1983340,0.2006382},{0.2001636,0.1998099,0.2021481},
	{0.2016381,0.2012985,0.2036755},{0.2031266,0.2027995,0.2052178},{0.2046308,0.2043153,0.2067698},{0.2061488,0.2058465,0.2083333},
	{0.2076792,0.2073921,0.2099120},{0.2092235,0.2089497,0.2115068},{0.2107835,0.2105202,0.2131153},{0.2123576,0.2121078,0.2147342},
	{0.2139448,0.2137121,0.2163664},{0.2155472,0.2153283,0.2180168},{0.2171650,0.2169577,0.2196833},{0.2187973,0.2186050,0.2213610},
	{0.2204451,0.2202692,0.2230509},{0.2221083,0.2219471,0.2247577},{0.2237860,0.2236399,0.2264819},{0.2254796,0.2253486,0.2282208},
	{0.2271897,0.2270732,0.2299733},{0.2289147,0.2288143,0.2317402},{0.2306552,0.2305706,0.2335234},{0.2324118,0.2323409,0.2353230},
	{0.2341827,0.2341269,0.2371380},{0.2359678,0.2359293,0.2389674},{0.2377686,0.2377478,0.2408123},{0.2395865,0.2395816,0.2426725},
	{0.2414213,0.2414303,0.2445485},{0.2432712,0.2432956,0.2464419},{0.2451354,0.2451773,0.2483524},{0.2470159,0.2470743,0.2502787},
	{0.2489135,0.2489874,0.2522195},{0.2508271,0.2509163,0.2541764},{0.2527566,0.2528593,0.2561519},{0.2547010,0.2548185,0.2581443},
	{0.2566610,0.2567964,0.2601516},{0.2586370,0.2587903,0.2621759},{0.2606298,0.2607982,0.2642187},{0.2626398,0.2628218,0.2662793},
	{0.2646669,0.2648633,0.2683562},{0.2667101,0.2669232,0.2704499},{0.2687692,0.2689997,0.2725624},{0.2708463,0.2710918,0.2746935},
	{0.2729420,0.2732010,0.2768424},{0.2750544,0.2753279,0.2790094},{0.2771828,0.2774737,0.2811933},{0.2793275,0.2796383,0.2833937},
	{0.2814900,0.2818167,0.2856144},{0.2836698,0.2840096,0.2878539},{0.2858662,0.2862222,0.2901072},{0.2880789,0.2884534,0.2923763},
	{0.2903084,0.2907000,0.2946663},{0.2925545,0.2929632,0.2969747},{0.2948184,0.2952445,0.2992992},{0.2971013,0.2975435,0.3016408},
	{0.2994008,0.2998623,0.3039990},{0.3017167,0.3021991,0.3063769},{0.3040509,0.3045515,0.3087751},{0.3064038,0.3069229,0.3111904},
	{0.3087745,0.3093147,0.3136224},{0.3111635,0.3117249,0.3160731},{0.3135711,0.3141542,0.3185420},{0.3159964,0.3166000,0.3210311},
	{0.3184392,0.3190614,0.3235400},{0.3208985,0.3215432,0.3260623},{0.3233741,0.3240444,0.3285999},{0.3258670,0.3265597,0.3311595},
	{0.3283777,0.3290909,0.3337378},{0.3309059,0.3316415,0.3363316},{0.3334514,0.3342112,0.3389416},{0.3360138,0.3368010,0.3415684},
	{0.3385936,0.3394078,0.3442177},{0.3411931,0.3420299,0.3468892},{0.3438126,0.3446728,0.3495747},{0.3464514,0.3473361,0.3522779},
	{0.3491095,0.3500159,0.3550051},{0.3517856,0.3527162,0.3577513},{0.3544791,0.3554380,0.3605161},{0.3571925,0.3581741,0.3633020},
	{0.3599254,0.3609256,0.3661022},{0.3626736,0.3636955,0.3689153},{0.3654342,0.3664782,0.3717477},{0.3682096,0.3692760,0.3745971},
	{0.3710020,0.3720954,0.3774604},{0.3738147,0.3749320,0.3803447},{0.3766526,0.3777868,0.3832515},{0.3795151,0.3806675,0.3861776},
	{0.3824007,0.3835723,0.3891291},{0.3853088,0.3864981,0.3921090},{0.3882368,0.3894512,0.3951098},{0.3911841,0.3924311,0.3981302},
	{0.3941553,0.3954256,0.4011742},{0.3971523,0.3984331,0.4042344},{0.4001712,0.4014598,0.4073042},{0.4032043,0.4045039,0.4103903},
	{0.4062452,0.4075651,0.4134984},{0.4092914,0.4106455,0.4166247},{0.4123497,0.4137396,0.4197619},{0.4154303,0.4168397,0.4229045},
	{0.4185327,0.4199455,0.4260523},{0.4216472,0.4230629,0.4292108},{0.4247677,0.4261964,0.4323866},{0.4278940,0.4293481,0.4355816},
	{0.4310302,0.4325188,0.4387922},{0.4341874,0.4357056,0.4420154},{0.4373720,0.4389046,0.4452542},{0.4405799,0.4421200,0.4485123},
	{0.4438052,0.4453600,0.4517915},{0.4470462,0.4486250,0.4550947},{0.4503059,0.4519146,0.4584222},{0.4535881,0.4552270,0.4617701},
	{0.4568956,0.4585571,0.4651381},{0.4602268,0.4619055,0.4685271},{0.4635768,0.4652775,0.4719335},{0.4669441,0.4686715,0.4753584},
	{0.4703291,0.4720823,0.4788045},{0.4737315,0.4755105,0.4822664},{0.4771507,0.4789568,0.4857437},{0.4805872,0.4824173,0.4892390},
	{0.4840417,0.4858927,0.4927473},{0.4875114,0.4893857,0.4962665},{0.4909928,0.4928915,0.4998036},{0.4944864,0.4964084,0.5033581},
	{0.4979949,0.4999404,0.5069206},{0.5015187,0.5034857,0.5104922},{0.5050563,0.5070408,0.5140796},{0.5086061,0.5106084,0.5176808},
	{0.5121676,0.5141899,0.5212940},{0.5157424,0.5177828,0.5249213},{0.5193317,0.5213887,0.5285609},{0.5229341,0.5250100,0.5322094},
	{0.5265500,0.5286452,0.5358704},{0.5301806,0.5322916,0.5395477},{0.5338255,0.5359519,0.5432377},{0.5374840,0.5396292,0.5469386},
	{0.5411556,0.5433201,0.5506539},{0.5448395,0.5470230,0.5543830},{0.5485362,0.5507411,0.5581211},{0.5522450,0.5544718,0.5618692},
	{0.5559653,0.5582117,0.5656292},{0.5596975,0.5619621,0.5693992},{0.5634390,0.5657243,0.5731772},{0.5671894,0.5694957,0.5769654},
	{0.5709496,0.5732748,0.5807643},{0.5747192,0.5770638,0.5845708},{0.5784975,0.5808639,0.5883842},{0.5822855,0.5846726,0.5922090},
	{0.5860861,0.5884892,0.5960457},{0.5898984,0.5923167,0.5998910},{0.5937218,0.5961580,0.6037457},{0.5975573,0.6000123,0.6076113},
	{0.6014040,0.6038771,0.6114872},{0.6052612,0.6077516,0.6153727},{0.6091282,0.6116368,0.6192669},{0.6130042,0.6155303,0.6231680},
	{0.6168885,0.6194280,0.6270765},{0.6207804,0.6233307,0.6309904},{0.6246775,0.6272413,0.6349068},{0.6285775,0.6311588,0.6388272},
	{0.6324813,0.6350775,0.6427520},{0.6363897,0.6389953,0.6466794},{0.6403004,0.6429163,0.6506076},{0.6442127,0.6468428,0.6545336},
	{0.6481274,0.6507726,0.6584602},{0.6520436,0.6547033,0.6623917},{0.6559636,0.6586372,0.6663276},{0.6598894,0.6625781,0.6702637},
	{0.6638215,0.6665252,0.6742015},{0.6677606,0.6704760,0.6781472},{0.6717055,0.6744342,0.6821011},{0.6756569,0.6784032,0.6860590},
	{0.6796165,0.6823777,0.6900220},{0.6835846,0.6863522,0.6939942},{0.6875576,0.6903302,0.6979736},{0.6915304,0.6943164,0.7019522},
	{0.6955021,0.6983070,0.7059264},{0.6994731,0.7022926,0.7098982},{0.7034426,0.7062682,0.7138647},{0.7074057,0.7102358,0.7178195},
	{0.7113565,0.7141959,0.7217620},{0.7152931,0.7181437,0.7256950},{0.7192173,0.7220784,0.7296141},{0.7231307,0.7260032,0.7335150},
	{0.7270336,0.7299172,0.7374024},{0.7309288,0.7338184,0.7412823},{0.7348189,0.7377095,0.7451590},{0.7387040,0.7415972,0.7490315},
	{0.7425853,0.7454865,0.7528986},{0.7464686,0.7493786,0.7567643},{0.7503569,0.7532721,0.7606322},{0.7542490,0.7571669,0.7645026},
	{0.7581445,0.7610641,0.7683743},{0.7620430,0.7649644,0.7722457},{0.7659421,0.7688665,0.7761156},{0.7698403,0.7727678,0.7799842},
	{0.7737361,0.7766657,0.7838499},{0.7776272,0.7805578,0.7877085},{0.7815112,0.7844426,0.7915587},{0.7853866,0.7883189,0.7953990},
	{0.7892541,0.7921852,0.7992282},{0.7931131,0.7960411,0.8030464},{0.7969641,0.7998894,0.8068521},{0.8008075,0.8037305,0.8106454},
	{0.8046443,0.8075628,0.8144303},{0.8084758,0.8113886,0.8182104},{0.8123018,0.8152099,0.8219866},{0.8161259,0.8190268,0.8257583},
	{0.8199513,0.8228392,0.8295262},{0.8237757,0.8266497,0.8332907},{0.8275987,0.8304615,0.8370511},{0.8314229,0.8342740,0.8408077},
	{0.8352477,0.8380866,0.8445607},{0.8390721,0.8418987,0.8483100},{0.8428983,0.8457108,0.8520545},{0.8467266,0.8495238,0.8557940},
	{0.8505558,0.8533365,0.8595315},{0.8543859,0.8571492,0.8632708},{0.8582197,0.8609636,0.8670141},{0.8620624,0.8647826,0.8707613},
	{0.8659174,0.8686087,0.8745103},{0.8697875,0.8724469,0.8782616},{0.8736753,0.8763031,0.8820224},{0.8775777,0.8801730,0.8857943},
	{0.8814888,0.8840508,0.8895713},{0.8854055,0.8879347,0.8933484},{0.8893269,0.8918216,0.8971232},{0.8932531,0.8957082,0.9008934},
	{0.8971838,0.8995923,0.9046563},{0.9011150,0.9034717,0.9084093},{0.9050425,0.9073426,0.9121479},{0.9089644,0.9112012,0.9158676},
	{0.9128761,0.9150437,0.9195657},{0.9167733,0.9188682,0.9232375},{0.9206495,0.9226726,0.9268785},{0.9244972,0.9264536,0.9304856},
	{0.9283130,0.9302065,0.9340543},{0.9320967,0.9339249,0.9375773},{0.9358475,0.9375976,0.9410476},{0.9395594,0.9412160,0.9444648},
	{0.9432213,0.9447778,0.9478288},{0.9468227,0.9482794,0.9511371},{0.9503568,0.9517156,0.9543847},{0.9538180,0.9550812,0.9575654},
	{0.9571998,0.9583709,0.9606735},{0.9604968,0.9615781,0.9637030},{0.9637025,0.9646964,0.9666482},{0.9668094,0.9677196,0.9695036},
	{0.9698126,0.9706414,0.9722638},{0.9727060,0.9734561,0.9749227},{0.9754830,0.9761568,0.9774743},{0.9781379,0.9787382,0.9799133},
	{0.9806645,0.9811950,0.9822341},{0.9830568,0.9835222,0.9844324},{0.9853102,0.9857142,0.9865033},{0.9874194,0.9877656,0.9884411},
	{0.9893793,0.9896716,0.9902414},{0.9911847,0.9914276,0.9919004},{0.9928315,0.9930293,0.9934140},{0.9943163,0.9944731,0.9947784},
	{0.9956353,0.9957554,0.9959900},{0.9967848,0.9968732,0.9970461},{0.9977623,0.9978239,0.9979442},{0.9985653,0.9986048,0.9986819},
	{0.9991918,0.9992141,0.9992576},{0.9996405,0.9996504,0.9996698},{0.9999101,0.9999126,0.9999174},{1.0000000,1.0000000,1.0000000}
};

static const uint miedl = sizeof(mied)/sizeof(mied[0]);

inline void SamplingBasis(const sfloat4 &iv, sfloat4 *pb1, sfloat4 *pb2){
	//TODO: Should probably handle zero-cases. Might even fix something.
	pb1->v[0] = -iv.v[2];
	pb1->v[1] = sfloat1::zero();
	pb1->v[2] = iv.v[0];
	pb1->v[3] = sfloat1::zero();
	*pb1 /= sfloat4::length3(iv.swizzle<0,3,2,3>()); //assume iv.w to be zero
	*pb2 = sfloat4::cross3(iv,*pb1);
}

namespace KernelSampler{

PhaseFunction::PhaseFunction(){
	//
}

PhaseFunction::~PhaseFunction(){
	//
}

HGPhase::HGPhase(float _g) : g1(_g){
	//
}

HGPhase::~HGPhase(){
	//
}

sfloat1 HGPhase::Evaluate(const sfloat1 &ct) const{
	sfloat1 g = sfloat1(g1);
	sfloat1 e = sfloat1(1.50f);
	return (1.0f-g*g)/(4.0f*SM_PI*sfloat1::pow(1.0f+g*g-2.0f*g*ct,e));
}

sfloat4 HGPhase::EvaluateRGB(const sfloat1 &ct) const{
	//return sfloat4(HGPhase::Evaluate(ct));
	sfloat1 phase = HGPhase::Evaluate(ct);
	sfloat4 r;
	r.v[0] = phase;
	r.v[1] = phase;
	r.v[2] = phase;
	r.v[3] = phase;
	return r;
}

sfloat4 HGPhase::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
	sfloat1 g = sfloat1(g1);
	sfloat1 sq = (1.0f-g*g)/(1.0f-g+2.0f*g*u1);
	sfloat1 ct = (1.0f+g*g-sq*sq)/(2.0f*g);
	sfloat1 st = sfloat1::sqrt(sfloat1::max(1.0f-ct*ct,sfloat1::zero()));
	sfloat1 ph = 2.0f*SM_PI*u2;

	sfloat4 b1, b2;
	SamplingBasis(iv,&b1,&b2);
	sfloat1 sph, cph;
	sincos_ps(ph.v,&sph.v,&cph.v);
	return b1*st*cph+b2*st*sph+iv*ct;
}

HGPhase HGPhase::ghg(0.75f);

MiePhase::MiePhase(){
	//
}

MiePhase::~MiePhase(){
	//
}

sfloat1 MiePhase::Evaluate(const sfloat1 &ct) const{
	sfloat1 ct1 = sfloat1::saturate2(ct); //hack rare abs(ct) > 1 cases
	sfloat1 a = sfloat1::acos(-ct1)/SM_PI;
	sfloat1 b = sfloat1((float)miedl*a);
	sfloat1 c = sfloat1::floor(b);
	c = sfloat1::min(c,(float)(miedl-2));
	c = sfloat1::max(c,0.0f);
	sfloat1 t = b-c; //frac(b)
	dfloatN X = dfloatN(c);
	dfloatN MA, MB;
	for(uint i = 0; i < BLCLOUD_VSIZE; ++i){
		MA.v[i] = mied[(uint)X.v[i]+0].x;
		MB.v[i] = mied[(uint)X.v[i]+1].x;
	}
	sfloat1 ma = sfloat1::load(&MA);
	sfloat1 mb = sfloat1::load(&MB);
	return sfloat1::lerp(ma,mb,t);
}

sfloat4 MiePhase::EvaluateRGB(const sfloat1 &ct) const{
	sfloat1 ct1 = sfloat1::saturate2(ct);
	sfloat1 a = sfloat1::acos(-ct1)/SM_PI;
	sfloat1 b = sfloat1((float)miedl*a);
	sfloat1 c = sfloat1::floor(b);
	c = sfloat1::min(c,(float)(miedl-2));
	c = sfloat1::max(c,0.0f);
	sfloat1 t = b-c; //frac(b)
	dfloatN X = dfloatN(c);
	sfloat4 ph;
	for(uint i = 0; i < 3; ++i){
		dfloatN MA, MB;
		for(uint j = 0; j < BLCLOUD_VSIZE; ++j){
			MA.v[j] = mied[(uint)X.v[j]+0][i];
			MB.v[j] = mied[(uint)X.v[j]+1][i];
		}
		sfloat1 ma = sfloat1::load(&MA);
		sfloat1 mb = sfloat1::load(&MB);
		ph.v[i] = sfloat1::lerp(ma,mb,t);
	}
	ph.v[3] = sfloat1::one();

	return ph;
}

sfloat4 MiePhase::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
	sfloat1 th = sfloat1::zero();
	sfloat1 ub = sfloat1((float)miedl*u1);
	for(uint i = 0; i < miedl-1; ++i){
		sfloat1 cdf0 = sfloat1(miecdf[i+0].x);
		sfloat1 cdf1 = sfloat1(miecdf[i+1].x);
		sfloat1 b = sfloat1::max(ub,(float)i);
		sfloat1 c = sfloat1::min(sfloat1::floor(b),(float)(miedl-1));
		sfloat1 t = b-c;
		sfloat1 cdf = sfloat1::lerp(cdf0,cdf1,t);
		sfloat1 m = sfloat1::Less(cdf,u1);
		sfloat1 s = sfloat1((float)i/(float)miedl)+t/(float)miedl;
		th = sfloat1::Or(sfloat1::And(m,s),sfloat1::AndNot(m,th));
		if(m.AllFalse())
			break;
	}
	th *= SM_PI;
	sfloat1 ph = 2.0f*SM_PI*u2;

	sfloat4 b1, b2;
	SamplingBasis(iv,&b1,&b2);
	sfloat1 ct = -cos_ps(th.v);
	sfloat1 st = sfloat1::sqrt(sfloat1::max(1.0f-ct*ct,sfloat1::zero()));
	sfloat1 sph, cph;
	sincos_ps(ph.v,&sph.v,&cph.v);

	return b1*st*cph+b2*st*sph+iv*ct;
}

MiePhase MiePhase::gmie;

BaseLight::BaseLight(){
	lights.push_back(this);
}

BaseLight::~BaseLight(){
	//
}

void BaseLight::DeleteAll(){
	for(uint i = 0; i < lights.size(); ++i)
		delete lights[i];
	lights.clear();
}

std::vector<BaseLight *> BaseLight::lights;

SunLight::SunLight(const dfloat3 *pd, const dfloat3 *pc, float _angle) : direction(*pd), color(*pc), angle(_angle){
	cosAngle = cosf(_angle);
}

SunLight::~SunLight(){
	//
}

sfloat4 SunLight::Evaluate(const sfloat4 &rd) const{
	sfloat1 ctm = cosAngle;
	sfloat4 lc = sfloat4::zero();
	sfloat1 lt = sfloat1::Greater(sfloat4::dot3(rd,sfloat4(float4::load(&direction))),ctm);

	float4 c = float4::load(&color);
	lc.v[0] = sfloat1::And(lt,c.splatN<0>());
	lc.v[1] = sfloat1::And(lt,c.splatN<1>());
	lc.v[2] = sfloat1::And(lt,c.splatN<2>());

	return lc;
}

sfloat1 SunLight::Pdf(const sfloat4 &iv) const{
	sfloat1 ctm = cosAngle;
	sfloat1 lt = sfloat1::Greater(sfloat4::dot3(iv,sfloat4(float4::load(&direction))),ctm);
	return sfloat1::And(lt,sfloat1(1.0f/(2.0f*SM_PI*(1.0f-ctm*ctm))));
}

sfloat4 SunLight::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
	sfloat1 ctm = cosAngle;
	sfloat1 ct = (1.0f-u1)+u1*ctm;
	sfloat1 st = sfloat1::sqrt(1.0f-ct*ct);
	sfloat1 ph = 2.0f*SM_PI*u2;

	sfloat4 b1, b2;
	sfloat4 lrd = sfloat4(float4::load(&direction));
	SamplingBasis(lrd,&b1,&b2);
	sfloat1 sph, cph;
	sincos_ps(ph.v,&sph.v,&cph.v);

	return b1*st*cph+b2*st*sph+lrd*ct;
}

BaseEnv::BaseEnv(){
	//
}

BaseEnv::~BaseEnv(){
	//
}

NullEnv::NullEnv(){
	//
}

NullEnv::~NullEnv(){
	//
}

sfloat4 NullEnv::Evaluate(const sfloat4 &rd) const{
	return sfloat4(0.0f);
}

NullEnv NullEnv::nenv;

MapEnv::MapEnv(){
	//
}

MapEnv::~MapEnv(){
	//
}

dfloat4 * MapEnv::Initialize(uint w, uint h){
	ptex = new dfloat4[w*h];
	this->w = w;
	this->h = h;
	return ptex;
}

sfloat4 MapEnv::Evaluate(const sfloat4 &rd) const{
	sfloat1 tha = sfloat1::acos(-rd.v[2])/SM_PI;
	sfloat1 thb = sfloat1((float)h*sfloat1::saturate(tha));
	sfloat1 thc = sfloat1::floor(thb);
	thc = sfloat1::min(thc,(float)(h-2));
	thc = sfloat1::max(thc,0.0f);
	sfloat1 tht = thb-thc;
	dfloatN thX = dfloatN(thc);

	sfloat1 pha = 0.5+sfloat1::atan2(rd.v[1],-rd.v[0])/sfloat1(2.0f*SM_PI);
	sfloat1 phb = sfloat1((float)w*sfloat1::saturate(pha));
	sfloat1 phc = sfloat1::floor(phb);
	phc = sfloat1::min(phc,(float)(w-2));
	phc = sfloat1::max(phc,0.0f);
	sfloat1 pht = phb-phc;
	dfloatN phX = dfloatN(phc);

	sfloat4 ce;
	for(uint i = 0; i < 3; ++i){
		dfloatN CA, CB, DA, DB;
		for(uint j = 0; j < BLCLOUD_VSIZE; ++j){
			CA.v[j] = ptex[(uint)(w*thX.v[j]+phX.v[j])][i];
			CB.v[j] = ptex[(uint)(w*(thX.v[j]+1)+phX.v[j])][i];
			DA.v[j] = ptex[(uint)(w*thX.v[j]+phX.v[j]+1)][i];
			DB.v[j] = ptex[(uint)(w*(thX.v[j]+1)+phX.v[j]+1)][i];
		}
		sfloat1 ca = sfloat1::load(&CA);
		sfloat1 cb = sfloat1::load(&CB);
		sfloat1 da = sfloat1::load(&DA);
		sfloat1 db = sfloat1::load(&DB);
		ce.v[i] = sfloat1::lerp(sfloat1::lerp(ca,cb,tht),sfloat1::lerp(da,db,tht),pht);
	}
	ce.v[3] = sfloat1::one();

	return ce;
}

void MapEnv::Destroy(){
	delete []ptex;
}

MapEnv MapEnv::genv;

}
