#include "main.h"
#include "KernelSampler.h"

#define USE_SSE2
#include "sse_mathfun.h"

//precomputed Mie phase (RGB channels) for cloud droplets, 1024*3 entries
static const dfloat3 mied[] = {
	{3.0156250,2.7480469,1.8994141},{3.0156250,2.7480469,1.8984375},{3.0136719,2.7460938,1.8964844},{3.0078125,2.7402344,1.8935547},
	{2.9980469,2.7324219,1.8876953},{2.9882812,2.7226562,1.8808594},{2.9746094,2.7109375,1.8730469},{2.9589844,2.6953125,1.8623047},
	{2.9414062,2.6796875,1.8515625},{2.9199219,2.6601562,1.8388672},{2.8964844,2.6406250,1.8242188},{2.8730469,2.6171875,1.8085938},
	{2.8457031,2.5937500,1.7910156},{2.8164062,2.5664062,1.7734375},{2.7851562,2.5390625,1.7539062},{2.7519531,2.5078125,1.7324219},
	{2.7187500,2.4765625,1.7109375},{2.6816406,2.4433594,1.6884766},{2.6445312,2.4101562,1.6650391},{2.6054688,2.3750000,1.6406250},
	{2.5644531,2.3378906,1.6152344},{2.5234375,2.3007812,1.5888672},{2.4824219,2.2617188,1.5625000},{2.4375000,2.2226562,1.5351562},
	{2.3945312,2.1816406,1.5078125},{2.3496094,2.1406250,1.4794922},{2.3046875,2.0996094,1.4511719},{2.2597656,2.0585938,1.4218750},
	{2.2128906,2.0175781,1.3935547},{2.1621094,1.9785156,1.3662109},{2.1093750,1.9404297,1.3417969},{2.0585938,1.8974609,1.3173828},
	{2.0117188,1.8535156,1.2910156},{1.9667969,1.8095703,1.2646484},{1.9218750,1.7666016,1.2382812},{1.8750000,1.7246094,1.2128906},
	{1.8291016,1.6845703,1.1865234},{1.7832031,1.6455078,1.1611328},{1.7382812,1.6064453,1.1357422},{1.6953125,1.5683594,1.1103516},
	{1.6513672,1.5302734,1.0849609},{1.6093750,1.4941406,1.0605469},{1.5693359,1.4580078,1.0361328},{1.5312500,1.4228516,1.0126953},
	{1.4941406,1.3876953,0.9892578},{1.4570312,1.3544922,0.9653320},{1.4189453,1.3183594,0.9409180},{1.3828125,1.2851562,0.9199219},
	{1.3496094,1.2558594,0.9008789},{1.3183594,1.2285156,0.8818359},{1.2900391,1.2031250,0.8632812},{1.2646484,1.1796875,0.8457031},
	{1.2402344,1.1572266,0.8295898},{1.2167969,1.1357422,0.8149414},{1.1933594,1.1142578,0.8012695},{1.1718750,1.0947266,0.7875977},
	{1.1513672,1.0751953,0.7744141},{1.1308594,1.0566406,0.7617188},{1.1113281,1.0380859,0.7495117},{1.0937500,1.0205078,0.7377930},
	{1.0751953,1.0048828,0.7260742},{1.0576172,0.9897461,0.7153320},{1.0419922,0.9750977,0.7045898},{1.0273438,0.9609375,0.6943359},
	{1.0126953,0.9482422,0.6845703},{0.9995117,0.9360352,0.6762695},{0.9863281,0.9233398,0.6684570},{0.9741211,0.9121094,0.6606445},
	{0.9619141,0.9013672,0.6528320},{0.9501953,0.8906250,0.6455078},{0.9389648,0.8798828,0.6376953},{0.9272461,0.8691406,0.6303711},
	{0.9155273,0.8583984,0.6225586},{0.9033203,0.8471680,0.6142578},{0.8916016,0.8359375,0.6064453},{0.8793945,0.8242188,0.5986328},
	{0.8671875,0.8129883,0.5908203},{0.8554688,0.8022461,0.5830078},{0.8437500,0.7919922,0.5751953},{0.8320312,0.7817383,0.5678711},
	{0.8222656,0.7714844,0.5615234},{0.8134766,0.7622070,0.5556641},{0.8046875,0.7543945,0.5493164},{0.7963867,0.7480469,0.5434570},
	{0.7890625,0.7416992,0.5385742},{0.7822266,0.7348633,0.5346680},{0.7753906,0.7285156,0.5312500},{0.7695312,0.7231445,0.5263672},
	{0.7636719,0.7167969,0.5219727},{0.7573242,0.7099609,0.5180664},{0.7495117,0.7041016,0.5136719},{0.7416992,0.6982422,0.5083008},
	{0.7338867,0.6909180,0.5034180},{0.7265625,0.6821289,0.4987793},{0.7187500,0.6738281,0.4931641},{0.7099609,0.6669922,0.4868164},
	{0.7011719,0.6601562,0.4809570},{0.6928711,0.6518555,0.4758301},{0.6850586,0.6435547,0.4704590},{0.6772461,0.6367188,0.4645996},
	{0.6694336,0.6298828,0.4594727},{0.6621094,0.6225586,0.4553223},{0.6547852,0.6157227,0.4506836},{0.6484375,0.6098633,0.4458008},
	{0.6420898,0.6040039,0.4411621},{0.6357422,0.5976562,0.4375000},{0.6298828,0.5913086,0.4335938},{0.6235352,0.5859375,0.4294434},
	{0.6171875,0.5810547,0.4252930},{0.6113281,0.5751953,0.4208984},{0.6054688,0.5688477,0.4169922},{0.5991211,0.5629883,0.4130859},
	{0.5927734,0.5576172,0.4086914},{0.5864258,0.5522461,0.4045410},{0.5800781,0.5458984,0.4003906},{0.5737305,0.5400391,0.3959961},
	{0.5673828,0.5341797,0.3918457},{0.5610352,0.5283203,0.3874512},{0.5546875,0.5219727,0.3833008},{0.5488281,0.5161133,0.3793945},
	{0.5424805,0.5107422,0.3754883},{0.5366211,0.5058594,0.3710938},{0.5312500,0.5004883,0.3674316},{0.5258789,0.4951172,0.3640137},
	{0.5205078,0.4902344,0.3603516},{0.5151367,0.4855957,0.3564453},{0.5102539,0.4804688,0.3530273},{0.5048828,0.4753418,0.3496094},
	{0.4995117,0.4707031,0.3459473},{0.4943848,0.4660645,0.3422852},{0.4890137,0.4606934,0.3391113},{0.4838867,0.4555664,0.3356934},
	{0.4787598,0.4511719,0.3317871},{0.4736328,0.4458008,0.3283691},{0.4685059,0.4406738,0.3251953},{0.4633789,0.4362793,0.3215332},
	{0.4582520,0.4318848,0.3178711},{0.4536133,0.4270020,0.3149414},{0.4487305,0.4223633,0.3120117},{0.4438477,0.4182129,0.3085938},
	{0.4394531,0.4140625,0.3054199},{0.4350586,0.4094238,0.3024902},{0.4306641,0.4057617,0.2990723},{0.4260254,0.4018555,0.2958984},
	{0.4213867,0.3974609,0.2937012},{0.4169922,0.3933105,0.2907715},{0.4130859,0.3898926,0.2871094},{0.4089355,0.3854980,0.2841797},
	{0.4042969,0.3811035,0.2817383},{0.3996582,0.3774414,0.2785645},{0.3952637,0.3732910,0.2753906},{0.3908691,0.3688965,0.2727051},
	{0.3864746,0.3649902,0.2695312},{0.3820801,0.3608398,0.2661133},{0.3779297,0.3559570,0.2634277},{0.3732910,0.3515625,0.2602539},
	{0.3681641,0.3479004,0.2570801},{0.3632812,0.3437500,0.2541504},{0.3588867,0.3391113,0.2509766},{0.3549805,0.3347168,0.2475586},
	{0.3513184,0.3300781,0.2445068},{0.3471680,0.3259277,0.2415771},{0.3422852,0.3229980,0.2388916},{0.3374023,0.3198242,0.2365723},
	{0.3339844,0.3161621,0.2343750},{0.3315430,0.3125000,0.2316895},{0.3291016,0.3090820,0.2290039},{0.3266602,0.3059082,0.2266846},
	{0.3229980,0.3034668,0.2249756},{0.3186035,0.3015137,0.2235107},{0.3149414,0.2990723,0.2218018},{0.3127441,0.2956543,0.2196045},
	{0.3105469,0.2922363,0.2169189},{0.3078613,0.2893066,0.2142334},{0.3044434,0.2858887,0.2124023},{0.3002930,0.2827148,0.2106934},
	{0.2961426,0.2805176,0.2080078},{0.2924805,0.2770996,0.2053223},{0.2893066,0.2727051,0.2032471},{0.2856445,0.2692871,0.2004395},
	{0.2819824,0.2661133,0.1973877},{0.2783203,0.2622070,0.1950684},{0.2744141,0.2587891,0.1928711},{0.2707520,0.2563477,0.1901855},
	{0.2678223,0.2531738,0.1882324},{0.2648926,0.2500000,0.1865234},{0.2624512,0.2480469,0.1842041},{0.2600098,0.2453613,0.1822510},
	{0.2570801,0.2424316,0.1807861},{0.2539062,0.2403564,0.1787109},{0.2509766,0.2376709,0.1763916},{0.2482910,0.2343750,0.1746826},
	{0.2453613,0.2319336,0.1723633},{0.2424316,0.2293701,0.1700439},{0.2396240,0.2263184,0.1685791},{0.2365723,0.2237549,0.1667480},
	{0.2338867,0.2216797,0.1643066},{0.2313232,0.2188721,0.1624756},{0.2287598,0.2163086,0.1607666},{0.2261963,0.2137451,0.1590576},
	{0.2236328,0.2111816,0.1574707},{0.2210693,0.2092285,0.1553955},{0.2186279,0.2070312,0.1534424},{0.2163086,0.2042236,0.1522217},
	{0.2138672,0.2019043,0.1505127},{0.2114258,0.1999512,0.1485596},{0.2089844,0.1975098,0.1468506},{0.2064209,0.1951904,0.1451416},
	{0.2041016,0.1928711,0.1434326},{0.2016602,0.1903076,0.1419678},{0.1992188,0.1882324,0.1402588},{0.1968994,0.1862793,0.1384277},
	{0.1948242,0.1838379,0.1368408},{0.1925049,0.1816406,0.1353760},{0.1900635,0.1795654,0.1337891},{0.1879883,0.1773682,0.1324463},
	{0.1857910,0.1755371,0.1306152},{0.1837158,0.1735840,0.1290283},{0.1816406,0.1712646,0.1278076},{0.1795654,0.1691895,0.1264648},
	{0.1773682,0.1677246,0.1246948},{0.1752930,0.1657715,0.1232300},{0.1733398,0.1635742,0.1218872},{0.1713867,0.1616211,0.1204224},
	{0.1693115,0.1596680,0.1189575},{0.1671143,0.1578369,0.1175537},{0.1651611,0.1561279,0.1160278},{0.1633301,0.1541748,0.1146240},
	{0.1613770,0.1522217,0.1133423},{0.1594238,0.1503906,0.1119995},{0.1574707,0.1488037,0.1105957},{0.1556396,0.1472168,0.1091919},
	{0.1538086,0.1453857,0.1079712},{0.1520996,0.1434326,0.1068115},{0.1503906,0.1419678,0.1054077},{0.1485596,0.1403809,0.1040649},
	{0.1468506,0.1386719,0.1029663},{0.1448975,0.1370850,0.1018066},{0.1433105,0.1354980,0.1005859},{0.1417236,0.1337891,0.0993042},
	{0.1400146,0.1322021,0.0980835},{0.1381836,0.1307373,0.0969849},{0.1364746,0.1291504,0.0958252},{0.1348877,0.1275635,0.0947266},
	{0.1334229,0.1259766,0.0936890},{0.1318359,0.1245117,0.0925293},{0.1301270,0.1231689,0.0913696},{0.1286621,0.1215820,0.0902710},
	{0.1270752,0.1200562,0.0892944},{0.1253662,0.1185913,0.0883179},{0.1239014,0.1170654,0.0872192},{0.1224365,0.1157837,0.0859985},
	{0.1208496,0.1144409,0.0849609},{0.1193848,0.1127319,0.0842285},{0.1179810,0.1112671,0.0833130},{0.1163940,0.1102295,0.0820923},
	{0.1150513,0.1089478,0.0809937},{0.1137695,0.1072998,0.0802612},{0.1123047,0.1059570,0.0794678},{0.1108398,0.1049194,0.0784302},
	{0.1096191,0.1036987,0.0773926},{0.1083984,0.1023560,0.0764771},{0.1069946,0.1010132,0.0758057},{0.1055298,0.0997925,0.0750732},
	{0.1043701,0.0987549,0.0739136},{0.1032104,0.0975342,0.0729370},{0.1018677,0.0961914,0.0723877},{0.1005859,0.0950317,0.0715942},
	{0.0994263,0.0939331,0.0705566},{0.0982056,0.0928345,0.0697021},{0.0968018,0.0917358,0.0689697},{0.0957031,0.0905151,0.0681152},
	{0.0946655,0.0892334,0.0672607},{0.0934448,0.0881958,0.0664062},{0.0920410,0.0872803,0.0656738},{0.0909424,0.0860596,0.0648804},
	{0.0900879,0.0848389,0.0640259},{0.0888672,0.0838623,0.0632324},{0.0875244,0.0828857,0.0625610},{0.0864258,0.0819092,0.0617065},
	{0.0855103,0.0807495,0.0608521},{0.0844116,0.0797119,0.0602112},{0.0833130,0.0787354,0.0594788},{0.0823975,0.0778198,0.0586243},
	{0.0814209,0.0768433,0.0579529},{0.0802612,0.0759888,0.0573730},{0.0791626,0.0750732,0.0567627},{0.0783691,0.0741577,0.0559692},
	{0.0776367,0.0732422,0.0550842},{0.0766602,0.0723267,0.0544739},{0.0756226,0.0712891,0.0539856},{0.0746460,0.0704956,0.0532532},
	{0.0736084,0.0698853,0.0524597},{0.0725708,0.0689697,0.0519104},{0.0718384,0.0678711,0.0513000},{0.0711670,0.0669556,0.0505066},
	{0.0703125,0.0661621,0.0497742},{0.0692139,0.0654907,0.0492249},{0.0681763,0.0646973,0.0487366},{0.0673828,0.0638428,0.0481567},
	{0.0667114,0.0629883,0.0474243},{0.0659180,0.0622253,0.0467529},{0.0650635,0.0614624,0.0461731},{0.0642090,0.0606689,0.0456238},
	{0.0634155,0.0599060,0.0450745},{0.0625610,0.0592346,0.0445251},{0.0617676,0.0585022,0.0439148},{0.0610962,0.0576782,0.0433044},
	{0.0603333,0.0569153,0.0427551},{0.0594788,0.0562744,0.0422363},{0.0586853,0.0555420,0.0417175},{0.0580139,0.0547791,0.0411377},
	{0.0573425,0.0540771,0.0405579},{0.0565491,0.0533752,0.0401001},{0.0557861,0.0527649,0.0396423},{0.0551453,0.0521545,0.0390625},
	{0.0545654,0.0513916,0.0386047},{0.0538940,0.0507507,0.0382080},{0.0531921,0.0502625,0.0376587},{0.0525208,0.0496216,0.0371399},
	{0.0518188,0.0488892,0.0367126},{0.0511169,0.0482483,0.0361938},{0.0504456,0.0475464,0.0356750},{0.0497742,0.0469055,0.0351562},
	{0.0490417,0.0463562,0.0346985},{0.0484314,0.0456848,0.0343323},{0.0479126,0.0451050,0.0338745},{0.0473633,0.0445862,0.0334167},
	{0.0467529,0.0440674,0.0330505},{0.0461731,0.0434875,0.0326843},{0.0456238,0.0429382,0.0322571},{0.0450134,0.0424194,0.0317993},
	{0.0444336,0.0418701,0.0314026},{0.0438843,0.0413208,0.0309906},{0.0433350,0.0407410,0.0305634},{0.0427551,0.0402222,0.0301666},
	{0.0421753,0.0397034,0.0297699},{0.0416260,0.0391846,0.0293427},{0.0410767,0.0386658,0.0289764},{0.0405273,0.0381470,0.0286102},
	{0.0400696,0.0375977,0.0282135},{0.0395508,0.0371094,0.0278320},{0.0389709,0.0366821,0.0274811},{0.0384521,0.0362244,0.0271301},
	{0.0380249,0.0357056,0.0267792},{0.0375366,0.0352478,0.0263977},{0.0370483,0.0348206,0.0260162},{0.0365295,0.0343628,0.0256958},
	{0.0360413,0.0339050,0.0253754},{0.0355835,0.0334778,0.0250092},{0.0351562,0.0330200,0.0246582},{0.0347290,0.0325928,0.0243530},
	{0.0342407,0.0321655,0.0240631},{0.0338135,0.0317688,0.0237427},{0.0333862,0.0313721,0.0234070},{0.0329590,0.0309296,0.0231476},
	{0.0325317,0.0304871,0.0228577},{0.0321350,0.0301208,0.0224915},{0.0317078,0.0297394,0.0221863},{0.0312500,0.0293121,0.0219269},
	{0.0308380,0.0289307,0.0216217},{0.0304413,0.0285492,0.0213013},{0.0300140,0.0281830,0.0210266},{0.0296478,0.0277863,0.0207520},
	{0.0292969,0.0273895,0.0204620},{0.0289001,0.0270538,0.0201874},{0.0284271,0.0267487,0.0199585},{0.0280762,0.0263519,0.0197144},
	{0.0278168,0.0259399,0.0194244},{0.0274811,0.0256042,0.0191193},{0.0270233,0.0253296,0.0189056},{0.0266113,0.0249939,0.0186920},
	{0.0263367,0.0246124,0.0184174},{0.0260620,0.0242615,0.0181274},{0.0256653,0.0239868,0.0178833},{0.0252686,0.0236664,0.0176697},
	{0.0249786,0.0233307,0.0174103},{0.0246887,0.0230255,0.0171356},{0.0243225,0.0227356,0.0169373},{0.0239868,0.0224304,0.0167236},
	{0.0237122,0.0221252,0.0164642},{0.0234222,0.0218353,0.0162201},{0.0230865,0.0215607,0.0160065},{0.0227356,0.0212860,0.0158386},
	{0.0224609,0.0209808,0.0156174},{0.0222321,0.0206909,0.0153503},{0.0219574,0.0204315,0.0151215},{0.0215912,0.0201721,0.0149841},
	{0.0212860,0.0198975,0.0148163},{0.0210571,0.0196533,0.0145645},{0.0208130,0.0194092,0.0143356},{0.0205078,0.0191345,0.0141754},
	{0.0202484,0.0188599,0.0139999},{0.0199738,0.0186310,0.0137787},{0.0196838,0.0184021,0.0135803},{0.0194397,0.0181427,0.0133972},
	{0.0191956,0.0178986,0.0132065},{0.0189056,0.0176697,0.0130463},{0.0186462,0.0174408,0.0128784},{0.0184326,0.0172119,0.0126724},
	{0.0182037,0.0169678,0.0125046},{0.0179291,0.0167389,0.0123825},{0.0176849,0.0165253,0.0122223},{0.0175018,0.0163269,0.0120087},
	{0.0172577,0.0161133,0.0118637},{0.0169983,0.0158997,0.0117569},{0.0167999,0.0156860,0.0115814},{0.0166321,0.0154877,0.0113831},
	{0.0164032,0.0152893,0.0112610},{0.0161743,0.0151062,0.0111084},{0.0160065,0.0149078,0.0109253},{0.0158081,0.0147095,0.0107880},
	{0.0155792,0.0145340,0.0106735},{0.0153885,0.0143661,0.0104980},{0.0152130,0.0141678,0.0103302},{0.0149994,0.0139465,0.0102234},
	{0.0148087,0.0137558,0.0100708},{0.0146484,0.0135803,0.0098648},{0.0144348,0.0133820,0.0097351},{0.0141830,0.0131760,0.0096817},
	{0.0139771,0.0130081,0.0095444},{0.0138397,0.0128708,0.0093231},{0.0136948,0.0126724,0.0092010},{0.0135117,0.0124435,0.0091476},
	{0.0133362,0.0122986,0.0090332},{0.0131683,0.0122147,0.0088654},{0.0129929,0.0120697,0.0087662},{0.0128250,0.0118942,0.0086899},
	{0.0126877,0.0117340,0.0085754},{0.0125427,0.0115967,0.0084457},{0.0123901,0.0114517,0.0083313},{0.0122223,0.0113144,0.0082245},
	{0.0120468,0.0111771,0.0081253},{0.0118942,0.0110474,0.0080185},{0.0117493,0.0109100,0.0079041},{0.0116043,0.0107651,0.0078087},
	{0.0114594,0.0106277,0.0077057},{0.0113144,0.0105133,0.0075912},{0.0111771,0.0103989,0.0074921},{0.0110397,0.0102615,0.0074081},
	{0.0109024,0.0101395,0.0073242},{0.0107574,0.0100250,0.0072365},{0.0106354,0.0099030,0.0071373},{0.0105286,0.0097733,0.0070305},
	{0.0103912,0.0096512,0.0069427},{0.0102234,0.0095367,0.0068855},{0.0100861,0.0094070,0.0068054},{0.0100021,0.0092850,0.0066872},
	{0.0098953,0.0091629,0.0065804},{0.0097504,0.0090485,0.0065231},{0.0096054,0.0089340,0.0064659},{0.0094910,0.0088348,0.0063744},
	{0.0093994,0.0087204,0.0062752},{0.0093002,0.0085907,0.0061913},{0.0091858,0.0084839,0.0061264},{0.0090485,0.0083923,0.0060577},
	{0.0089417,0.0082932,0.0059891},{0.0088501,0.0081940,0.0059128},{0.0087585,0.0081100,0.0058212},{0.0086670,0.0080109,0.0057564},
	{0.0085678,0.0079041,0.0057068},{0.0084610,0.0078278,0.0056381},{0.0083694,0.0077553,0.0055466},{0.0082779,0.0076637,0.0054703},
	{0.0081863,0.0075645,0.0054092},{0.0080872,0.0074654,0.0053558},{0.0079956,0.0073853,0.0052834},{0.0078964,0.0073204,0.0052032},
	{0.0078011,0.0072441,0.0051460},{0.0077209,0.0071564,0.0050888},{0.0076561,0.0070686,0.0050240},{0.0075607,0.0069923,0.0049820},
	{0.0074577,0.0069275,0.0049400},{0.0073814,0.0068550,0.0048714},{0.0073128,0.0067825,0.0048027},{0.0072250,0.0066948,0.0047646},
	{0.0071373,0.0065994,0.0047302},{0.0070534,0.0065193,0.0046806},{0.0069695,0.0064507,0.0046272},{0.0068855,0.0063744,0.0045815},
	{0.0068130,0.0063057,0.0045357},{0.0067482,0.0062294,0.0044937},{0.0066872,0.0061493,0.0044594},{0.0066147,0.0060806,0.0044327},
	{0.0065231,0.0060425,0.0043945},{0.0064583,0.0059853,0.0043449},{0.0064316,0.0059013,0.0042877},{0.0063782,0.0058327,0.0042381},
	{0.0062714,0.0057869,0.0042114},{0.0061722,0.0057411,0.0041771},{0.0061188,0.0056877,0.0041122},{0.0060921,0.0056267,0.0040321},
	{0.0060387,0.0055618,0.0039902},{0.0059624,0.0055084,0.0039711},{0.0058937,0.0054741,0.0039368},{0.0058403,0.0054512,0.0038757},
	{0.0057831,0.0054131,0.0038338},{0.0057297,0.0053482,0.0038109},{0.0056992,0.0052795,0.0037708},{0.0056648,0.0052299,0.0037136},
	{0.0055885,0.0051994,0.0036850},{0.0054970,0.0051613,0.0036793},{0.0054436,0.0051041,0.0036583},{0.0054283,0.0050392,0.0036087},
	{0.0054054,0.0049820,0.0035629},{0.0053406,0.0049400,0.0035419},{0.0052681,0.0048981,0.0035343},{0.0052185,0.0048485,0.0035114},
	{0.0051804,0.0048027,0.0034771},{0.0051308,0.0047569,0.0034561},{0.0050926,0.0047112,0.0034256},{0.0050774,0.0046730,0.0033703},
	{0.0050392,0.0046349,0.0033398},{0.0049553,0.0046043,0.0033512},{0.0048904,0.0045738,0.0033493},{0.0048866,0.0045433,0.0032921},
	{0.0048866,0.0045204,0.0032234},{0.0048447,0.0044899,0.0032101},{0.0047836,0.0044441,0.0032196},{0.0047417,0.0044212,0.0031929},
	{0.0047073,0.0044174,0.0031376},{0.0046616,0.0043831,0.0031166},{0.0046234,0.0043335,0.0031052},{0.0046082,0.0042953,0.0030670},
	{0.0045891,0.0042648,0.0030270},{0.0045357,0.0042458,0.0030212},{0.0044746,0.0042305,0.0030231},{0.0044479,0.0042038,0.0030079},
	{0.0044479,0.0041618,0.0029812},{0.0044365,0.0041275,0.0029583},{0.0043983,0.0041046,0.0029488},{0.0043526,0.0040817,0.0029488},
	{0.0043182,0.0040512,0.0029373},{0.0042915,0.0040245,0.0029182},{0.0042686,0.0039864,0.0029068},{0.0042458,0.0039558,0.0028896},
	{0.0042229,0.0039406,0.0028629},{0.0041924,0.0039177,0.0028477},{0.0041618,0.0038834,0.0028553},{0.0041351,0.0038605,0.0028477},
	{0.0041199,0.0038548,0.0028114},{0.0041122,0.0038433,0.0027790},{0.0040932,0.0038166,0.0027733},{0.0040665,0.0037956,0.0027695},
	{0.0040436,0.0037804,0.0027561},{0.0040321,0.0037708,0.0027313},{0.0040169,0.0037613,0.0027084},{0.0039902,0.0037441,0.0027027},
	{0.0039749,0.0037193,0.0026970},{0.0039635,0.0037022,0.0026741},{0.0039406,0.0037022,0.0026512},{0.0039101,0.0036888,0.0026531},
	{0.0038948,0.0036545,0.0026569},{0.0038929,0.0036335,0.0026417},{0.0038738,0.0036297,0.0026226},{0.0038452,0.0036201,0.0026207},
	{0.0038261,0.0035992,0.0026245},{0.0038166,0.0035763,0.0026207},{0.0037994,0.0035648,0.0026131},{0.0037804,0.0035553,0.0026054},
	{0.0037727,0.0035381,0.0025978},{0.0037670,0.0035191,0.0025883},{0.0037518,0.0035076,0.0025826},{0.0037289,0.0035057,0.0025787},
	{0.0037117,0.0035019,0.0025711},{0.0037003,0.0034924,0.0025597},{0.0036945,0.0034866,0.0025444},{0.0036888,0.0034809,0.0025311},
	{0.0036869,0.0034657,0.0025234},{0.0036774,0.0034561,0.0025177},{0.0036564,0.0034618,0.0025101},{0.0036316,0.0034657,0.0025101},
	{0.0036240,0.0034523,0.0025082},{0.0036354,0.0034389,0.0024891},{0.0036507,0.0034256,0.0024662},{0.0036449,0.0034065,0.0024681},
	{0.0036182,0.0033951,0.0024872},{0.0035858,0.0034008,0.0024986},{0.0035744,0.0033989,0.0024967},{0.0035915,0.0033760,0.0024872},
	{0.0036125,0.0033531,0.0024738},{0.0036087,0.0033455,0.0024719},{0.0035763,0.0033417,0.0024872},{0.0035419,0.0033379,0.0025063},
	{0.0035248,0.0033340,0.0025043},{0.0035267,0.0033302,0.0024834},{0.0035305,0.0033188,0.0024662},{0.0035286,0.0033054,0.0024624},
	{0.0035114,0.0033016,0.0024643},{0.0034866,0.0033112,0.0024643},{0.0034733,0.0033169,0.0024605},{0.0034828,0.0033035,0.0024548},
	{0.0034981,0.0032825,0.0024509},{0.0035057,0.0032787,0.0024433},{0.0035019,0.0032825,0.0024338},{0.0034962,0.0032711,0.0024414},
	{0.0034943,0.0032501,0.0024548},{0.0034981,0.0032368,0.0024529},{0.0035057,0.0032253,0.0024471},{0.0035114,0.0032101,0.0024490},
	{0.0035095,0.0032120,0.0024414},{0.0035038,0.0032291,0.0024261},{0.0034943,0.0032310,0.0024261},{0.0034904,0.0032196,0.0024395},
	{0.0034904,0.0032253,0.0024338},{0.0034885,0.0032444,0.0024166},{0.0034828,0.0032597,0.0024109},{0.0034771,0.0032711,0.0024090},
	{0.0034714,0.0032845,0.0024071},{0.0034618,0.0032921,0.0024128},{0.0034542,0.0032978,0.0024204},{0.0034504,0.0033035,0.0024204},
	{0.0034428,0.0033016,0.0024395},{0.0034256,0.0032959,0.0024719},{0.0034237,0.0033035,0.0024834},{0.0034428,0.0033188,0.0024738},
	{0.0034542,0.0033283,0.0024796},{0.0034466,0.0033321,0.0025139},{0.0034428,0.0033321,0.0025501},{0.0034504,0.0033360,0.0025749},
	{0.0034580,0.0033531,0.0025883},{0.0034847,0.0033722,0.0025864},{0.0035286,0.0033836,0.0025826},{0.0035572,0.0033875,0.0026035},
	{0.0035686,0.0033894,0.0026455},{0.0035915,0.0034046,0.0026665},{0.0036297,0.0034332,0.0026665},{0.0036640,0.0034561,0.0026779},
	{0.0037022,0.0034599,0.0027084},{0.0037613,0.0034637,0.0027218},{0.0038242,0.0034962,0.0027065},{0.0038662,0.0035419,0.0027008},
	{0.0038948,0.0035706,0.0027275},{0.0039291,0.0035954,0.0027542},{0.0039787,0.0036316,0.0027599},{0.0040398,0.0036736,0.0027523},
	{0.0041008,0.0037193,0.0027485},{0.0041504,0.0037708,0.0027580},{0.0042000,0.0038147,0.0027847},{0.0042381,0.0038586,0.0028248},
	{0.0042763,0.0039139,0.0028667},{0.0043259,0.0039673,0.0028934},{0.0043716,0.0040245,0.0029202},{0.0044136,0.0040741,0.0029659},
	{0.0044518,0.0041084,0.0030251},{0.0044823,0.0041580,0.0030823},{0.0044975,0.0042381,0.0031319},{0.0045166,0.0043144,0.0031834},
	{0.0045662,0.0043488,0.0032482},{0.0046196,0.0043640,0.0033321},{0.0046387,0.0044289,0.0034027},{0.0046501,0.0045166,0.0034523},
	{0.0046959,0.0045662,0.0035133},{0.0047493,0.0045815,0.0035973},{0.0047874,0.0046043,0.0036907},{0.0048103,0.0046654,0.0037575},
	{0.0048523,0.0047379,0.0038013},{0.0049133,0.0047798,0.0038471},{0.0049744,0.0048103,0.0039043},{0.0050125,0.0048714,0.0039558},
	{0.0050507,0.0049438,0.0039978},{0.0051079,0.0050240,0.0040169},{0.0051842,0.0051041,0.0040169},{0.0052643,0.0051689,0.0040283},
	{0.0053368,0.0052414,0.0040474},{0.0053864,0.0053177,0.0040779},{0.0054626,0.0053596,0.0041122},{0.0055771,0.0054092,0.0041008},
	{0.0056686,0.0054855,0.0040817},{0.0057259,0.0055275,0.0041237},{0.0058098,0.0055199,0.0041809},{0.0059242,0.0055161,0.0042076},
	{0.0059891,0.0055428,0.0042419},{0.0060081,0.0055962,0.0042915},{0.0060577,0.0056458,0.0043182},{0.0061493,0.0056496,0.0043411},
	{0.0062256,0.0056190,0.0044060},{0.0062561,0.0056038,0.0044937},{0.0062485,0.0056572,0.0045433},{0.0062332,0.0057259,0.0045776},
	{0.0062523,0.0057144,0.0046425},{0.0063133,0.0056686,0.0047035},{0.0063553,0.0056572,0.0047417},{0.0063286,0.0056877,0.0048103},
	{0.0062714,0.0057335,0.0048866},{0.0062561,0.0057869,0.0049171},{0.0063057,0.0057983,0.0049171},{0.0063515,0.0057755,0.0049515},
	{0.0063057,0.0057907,0.0050316},{0.0062485,0.0058403,0.0050812},{0.0062561,0.0058784,0.0050659},{0.0062904,0.0058784,0.0050583},
	{0.0062904,0.0058670,0.0050926},{0.0062828,0.0058708,0.0051155},{0.0062752,0.0059013,0.0051041},{0.0062675,0.0059357,0.0050850},
	{0.0062714,0.0059433,0.0050735},{0.0062790,0.0059662,0.0050354},{0.0062752,0.0060081,0.0049896},{0.0062790,0.0060196,0.0049706},
	{0.0062904,0.0060272,0.0049438},{0.0062904,0.0060730,0.0048904},{0.0062752,0.0061150,0.0048561},{0.0062675,0.0061150,0.0048485},
	{0.0062866,0.0060997,0.0048256},{0.0063095,0.0060959,0.0047798},{0.0063057,0.0061188,0.0047264},{0.0062866,0.0061378,0.0046883},
	{0.0063019,0.0061264,0.0046425},{0.0063400,0.0061264,0.0045776},{0.0063591,0.0061455,0.0045128},{0.0063705,0.0061569,0.0044594},
	{0.0063896,0.0061798,0.0043945},{0.0064049,0.0062027,0.0043335},{0.0064201,0.0061913,0.0042953},{0.0064354,0.0061836,0.0042534},
	{0.0064392,0.0061913,0.0042076},{0.0064430,0.0061913,0.0041656},{0.0064507,0.0061874,0.0041275},{0.0064697,0.0061836,0.0040932},
	{0.0065002,0.0061913,0.0040321},{0.0065346,0.0062027,0.0039787},{0.0065575,0.0062141,0.0039368},{0.0065956,0.0062332,0.0038738},
	{0.0066490,0.0062332,0.0038185},{0.0066872,0.0062294,0.0037861},{0.0067139,0.0062447,0.0037537},{0.0067444,0.0062561,0.0037231},
	{0.0067787,0.0062523,0.0037117},{0.0068130,0.0062485,0.0037060},{0.0068550,0.0062523,0.0036983},{0.0068932,0.0062675,0.0036888},
	{0.0069313,0.0063019,0.0036755},{0.0069885,0.0063438,0.0036469},{0.0070648,0.0063782,0.0036259},{0.0071449,0.0064049,0.0036144},
	{0.0072174,0.0064316,0.0036297},{0.0072708,0.0064735,0.0036602},{0.0073433,0.0065460,0.0036583},{0.0074425,0.0066071,0.0036526},
	{0.0075493,0.0066261,0.0037003},{0.0076599,0.0066452,0.0037556},{0.0077667,0.0066948,0.0037994},{0.0078506,0.0067635,0.0038586},
	{0.0079498,0.0068398,0.0039177},{0.0080719,0.0069351,0.0039520},{0.0082092,0.0070457,0.0039825},{0.0083618,0.0071335,0.0040398},
	{0.0085449,0.0071945,0.0041237},{0.0087280,0.0072937,0.0042114},{0.0088730,0.0074806,0.0042763},{0.0090485,0.0076714,0.0043373},
	{0.0093079,0.0078011,0.0044098},{0.0096207,0.0078964,0.0044937},{0.0099182,0.0080185,0.0046005},{0.0102158,0.0081863,0.0046959},
	{0.0105286,0.0083923,0.0047760},{0.0108185,0.0086212,0.0048790},{0.0111465,0.0088654,0.0049706},{0.0115891,0.0090942,0.0050011},
	{0.0120773,0.0093079,0.0050430},{0.0124969,0.0095673,0.0051537},{0.0129013,0.0099030,0.0052490},{0.0134048,0.0102539,0.0052834},
	{0.0139465,0.0106201,0.0052986},{0.0144730,0.0109940,0.0053825},{0.0150528,0.0113220,0.0055084},{0.0157013,0.0116959,0.0055656},
	{0.0162964,0.0121918,0.0055962},{0.0167847,0.0127487,0.0057335},{0.0173187,0.0132599,0.0059357},{0.0179596,0.0137711,0.0060730},
	{0.0186310,0.0143127,0.0062027},{0.0192719,0.0148468,0.0064201},{0.0198822,0.0153885,0.0067291},{0.0203857,0.0160828,0.0070648},
	{0.0208588,0.0168457,0.0074043},{0.0214844,0.0175171,0.0077553},{0.0221558,0.0181427,0.0081482},{0.0227203,0.0188904,0.0086060},
	{0.0232391,0.0196838,0.0091019},{0.0238647,0.0204163,0.0096207},{0.0244904,0.0211334,0.0101852},{0.0250092,0.0219574,0.0108337},
	{0.0255127,0.0227509,0.0115356},{0.0260925,0.0234985,0.0122757},{0.0266724,0.0242615,0.0130386},{0.0272064,0.0250702,0.0138168},
	{0.0277557,0.0258636,0.0146408},{0.0283051,0.0266418,0.0155106},{0.0288544,0.0274353,0.0163879},{0.0294037,0.0282135,0.0173035},
	{0.0299835,0.0289154,0.0182953},{0.0305481,0.0296326,0.0192719},{0.0311127,0.0303955,0.0202179},{0.0316162,0.0310974,0.0212250},
	{0.0321350,0.0316772,0.0223083},{0.0326538,0.0322571,0.0233307},{0.0332031,0.0328674,0.0242767},{0.0337219,0.0333862,0.0252533},
	{0.0342102,0.0338440,0.0262604},{0.0346985,0.0343018,0.0271912},{0.0352478,0.0346985,0.0280609},{0.0357971,0.0350037,0.0289307},
	{0.0362854,0.0353699,0.0297394},{0.0368042,0.0356750,0.0304413},{0.0374146,0.0358887,0.0310516},{0.0379944,0.0360413,0.0315857},
	{0.0385132,0.0362244,0.0320129},{0.0390625,0.0364075,0.0322571},{0.0397339,0.0364990,0.0323486},{0.0403137,0.0364990,0.0324097},
	{0.0408020,0.0366211,0.0322876},{0.0413513,0.0368042,0.0318298},{0.0419617,0.0369263,0.0312195},{0.0423584,0.0370178,0.0306549},
	{0.0425110,0.0372314,0.0299988},{0.0423279,0.0376587,0.0292664},{0.0417480,0.0380249,0.0288239},{0.0409241,0.0381470,0.0287170},
	{0.0399780,0.0381165,0.0286865},{0.0387268,0.0379028,0.0289917},{0.0372620,0.0374451,0.0296021},{0.0361328,0.0368652,0.0298309},
	{0.0354004,0.0362854,0.0295563},{0.0345764,0.0355530,0.0293884},{0.0336914,0.0347290,0.0292358},{0.0331116,0.0339661,0.0286713},
	{0.0328064,0.0332031,0.0276794},{0.0323181,0.0325012,0.0267944},{0.0317688,0.0317688,0.0259705},{0.0314636,0.0310364,0.0248260},
	{0.0312805,0.0303192,0.0235138},{0.0308990,0.0295868,0.0224457},{0.0304718,0.0288391,0.0214386},{0.0301819,0.0280914,0.0203552},
	{0.0298157,0.0273438,0.0194092},{0.0292816,0.0265656,0.0187531},{0.0286865,0.0257568,0.0182495},{0.0279846,0.0249786,0.0179291},
	{0.0271606,0.0242004,0.0177917},{0.0264282,0.0234528,0.0176697},{0.0256500,0.0228119,0.0176239},{0.0246582,0.0223236,0.0177307},
	{0.0237274,0.0219269,0.0178375},{0.0230865,0.0215759,0.0177307},{0.0225372,0.0213013,0.0175781},{0.0219727,0.0211487,0.0174255},
	{0.0215759,0.0210114,0.0172119},{0.0213776,0.0208588,0.0169067},{0.0212708,0.0207672,0.0165710},{0.0211945,0.0207367,0.0162048},
	{0.0211182,0.0207062,0.0159454},{0.0211029,0.0205841,0.0157928},{0.0212250,0.0204315,0.0155945},{0.0213928,0.0203247,0.0153809},
	{0.0214081,0.0203094,0.0152740},{0.0213776,0.0202637,0.0152893},{0.0214539,0.0201569,0.0153122},{0.0215302,0.0200500,0.0153427},
	{0.0215302,0.0200500,0.0153885},{0.0214844,0.0200653,0.0154572},{0.0215149,0.0200348,0.0155029},{0.0215302,0.0200195,0.0155334},
	{0.0214844,0.0200500,0.0155869},{0.0214081,0.0200958,0.0156555},{0.0213623,0.0201416,0.0157166},{0.0214233,0.0201569,0.0157013},
	{0.0215149,0.0202179,0.0156555},{0.0215302,0.0202942,0.0156555},{0.0214996,0.0203705,0.0157013},{0.0215454,0.0204010,0.0156860},
	{0.0216064,0.0204010,0.0156708},{0.0215607,0.0204315,0.0157166},{0.0215149,0.0204315,0.0157471},{0.0216064,0.0203857,0.0157013},
	{0.0216675,0.0203552,0.0156250},{0.0216217,0.0203400,0.0156250},{0.0215454,0.0203094,0.0156555},{0.0214844,0.0202942,0.0156403},
	{0.0214844,0.0202332,0.0155945},{0.0214844,0.0201874,0.0155258},{0.0214233,0.0201569,0.0154648},{0.0213165,0.0201416,0.0154419},
	{0.0212250,0.0200958,0.0154266},{0.0212097,0.0200195,0.0153580},{0.0212097,0.0199127,0.0152740},{0.0211487,0.0198517,0.0152054},
	{0.0210571,0.0198517,0.0151367},{0.0209808,0.0198059,0.0150909},{0.0209656,0.0196838,0.0150833},{0.0209045,0.0195923,0.0150833},
	{0.0208282,0.0195465,0.0150604},{0.0207825,0.0195312,0.0149841},{0.0207520,0.0195007,0.0149155},{0.0206909,0.0194550,0.0148773},
	{0.0205994,0.0194702,0.0148163},{0.0205383,0.0194702,0.0147705},{0.0205078,0.0193634,0.0147858},{0.0205231,0.0193176,0.0147324},
	{0.0205078,0.0193024,0.0146561},{0.0204773,0.0192413,0.0146790},{0.0204163,0.0191650,0.0147018},{0.0204010,0.0191650,0.0146027},
	{0.0204010,0.0191498,0.0144958},{0.0203400,0.0191040,0.0144730},{0.0202484,0.0190735,0.0144882},{0.0201874,0.0190430,0.0144806},
	{0.0201874,0.0189972,0.0144348},{0.0201874,0.0189514,0.0144043},{0.0201263,0.0189514,0.0144043},{0.0200806,0.0189514,0.0143814},
	{0.0201263,0.0189056,0.0143127},{0.0201263,0.0188599,0.0142822},{0.0200500,0.0188141,0.0143204},{0.0199738,0.0187836,0.0143356},
	{0.0199890,0.0188141,0.0142212},{0.0200195,0.0188446,0.0141068},{0.0200043,0.0188293,0.0140762},{0.0200348,0.0187531,0.0140915},
	{0.0200500,0.0186920,0.0141068},{0.0199890,0.0186615,0.0141602},{0.0198822,0.0186768,0.0142288},{0.0198059,0.0186920,0.0142517},
	{0.0197754,0.0187378,0.0142059},{0.0197906,0.0187683,0.0141068},{0.0198822,0.0187683,0.0139771},{0.0199890,0.0187073,0.0139160},
	{0.0200043,0.0186462,0.0139694},{0.0199738,0.0186157,0.0140533},{0.0199585,0.0186157,0.0140762},{0.0200043,0.0186615,0.0140381},
	{0.0200348,0.0186920,0.0140152},{0.0200043,0.0187225,0.0140533},{0.0199280,0.0187531,0.0140991},{0.0199127,0.0187988,0.0140915},
	{0.0199585,0.0187988,0.0140686},{0.0199738,0.0187988,0.0140839},{0.0199585,0.0188293,0.0141068},{0.0200195,0.0188751,0.0140839},
	{0.0201721,0.0188599,0.0140457},{0.0202942,0.0188293,0.0140381},{0.0202942,0.0189056,0.0140610},{0.0202484,0.0189667,0.0141525},
	{0.0202484,0.0189667,0.0142593},{0.0203247,0.0190430,0.0142288},{0.0204163,0.0191498,0.0141678},{0.0204926,0.0191803,0.0142136},
	{0.0205841,0.0191498,0.0143127},{0.0206146,0.0192261,0.0143814},{0.0206604,0.0193176,0.0144272},{0.0207520,0.0193939,0.0144424},
	{0.0207977,0.0194855,0.0144730},{0.0208130,0.0195618,0.0145569},{0.0209045,0.0196381,0.0145721},{0.0210419,0.0197449,0.0145340},
	{0.0211792,0.0198517,0.0145264},{0.0213165,0.0199432,0.0145569},{0.0214539,0.0200195,0.0146332},{0.0215302,0.0200806,0.0148010},
	{0.0215912,0.0201569,0.0150223},{0.0217133,0.0202332,0.0151672},{0.0219574,0.0203247,0.0152054},{0.0221405,0.0204926,0.0151978},
	{0.0222626,0.0207214,0.0152283},{0.0224304,0.0209045,0.0152664},{0.0225677,0.0211029,0.0153580},{0.0226440,0.0212860,0.0155487},
	{0.0228271,0.0214386,0.0157013},{0.0231018,0.0215759,0.0157928},{0.0233459,0.0216827,0.0159760},{0.0235901,0.0218811,0.0161133},
	{0.0238647,0.0221863,0.0160828},{0.0241089,0.0224609,0.0161133},{0.0242767,0.0226135,0.0163269},{0.0244293,0.0227203,0.0166016},
	{0.0245514,0.0227814,0.0169373},{0.0247345,0.0229340,0.0171661},{0.0251312,0.0233307,0.0170135},{0.0255585,0.0238037,0.0168152},
	{0.0258636,0.0242004,0.0169373},{0.0261536,0.0244751,0.0173187},{0.0265503,0.0245667,0.0178375},{0.0269623,0.0246735,0.0184174},
	{0.0273743,0.0251160,0.0187531},{0.0278625,0.0257721,0.0188141},{0.0284729,0.0263672,0.0189209},{0.0291443,0.0269470,0.0191040},
	{0.0297699,0.0275116,0.0194550},{0.0303497,0.0279694,0.0201111},{0.0310516,0.0285339,0.0207062},{0.0319519,0.0294495,0.0209351},
	{0.0328674,0.0304413,0.0212708},{0.0337830,0.0312805,0.0220184},{0.0347900,0.0320129,0.0229950},{0.0359802,0.0329285,0.0239868},
	{0.0373535,0.0342102,0.0248718},{0.0390320,0.0358582,0.0255280},{0.0410461,0.0378723,0.0260773},{0.0432434,0.0398254,0.0270996},
	{0.0455017,0.0418091,0.0287628},{0.0479126,0.0440063,0.0307770},{0.0506897,0.0463867,0.0329590},{0.0539856,0.0492249,0.0349121},
	{0.0577087,0.0525208,0.0365601},{0.0617065,0.0557556,0.0383911},{0.0655518,0.0589905,0.0403442},{0.0686646,0.0625610,0.0422363},
	{0.0708008,0.0656128,0.0444336},{0.0725098,0.0673828,0.0464172},{0.0749512,0.0673828,0.0468140},{0.0773926,0.0661621,0.0449829},
	{0.0759888,0.0657959,0.0423279},{0.0690918,0.0662231,0.0410767},{0.0603943,0.0633545,0.0426025},{0.0592346,0.0535583,0.0431519},
	{0.0679932,0.0467224,0.0336609},{0.0703125,0.0519714,0.0245056},{0.0632935,0.0601196,0.0299530},{0.0586853,0.0635376,0.0466003},
	{0.0676270,0.0654907,0.0578308},{0.0867920,0.0755005,0.0516052},{0.0911865,0.0840454,0.0563660},{0.0897827,0.0853882,0.0633545},
};

//preintegrated cumulative distribution (from 1D pdf)
static const dfloat3 miecdf[] = {
	{0.0000000,0.0000000,0.0000000},{0.0132446,0.0130175,0.0125932},{0.0264850,0.0260304,0.0251768},{0.0397081,0.0390247,0.0377441},
	{0.0528970,0.0519867,0.0502823},{0.0660430,0.0649070,0.0627784},{0.0791375,0.0777765,0.0752259},{0.0921677,0.0905812,0.0876119},
	{0.1051249,0.1033119,0.0999266},{0.1179964,0.1159593,0.1121637},{0.1307692,0.1285142,0.1243101},{0.1434391,0.1409673,0.1363560},
	{0.1559975,0.1533094,0.1482919},{0.1684315,0.1655312,0.1601113},{0.1807325,0.1776235,0.1718075},{0.1928920,0.1895770,0.1833678},
	{0.2049057,0.2013825,0.1947856},{0.2167649,0.2130354,0.2060576},{0.2284612,0.2245309,0.2171775},{0.2399902,0.2358645,0.2281387},
	{0.2513433,0.2470270,0.2389348},{0.2625163,0.2580137,0.2495592},{0.2735092,0.2688200,0.2600088},{0.2843134,0.2794412,0.2702802},
	{0.2949245,0.2898728,0.2803704},{0.3053426,0.3001101,0.2902759},{0.3155635,0.3101531,0.2999937},{0.3255870,0.3200018,0.3095204},
	{0.3354090,0.3296562,0.3188560},{0.3450165,0.3391209,0.3280071},{0.3543966,0.3484029,0.3369865},{0.3635495,0.3574930,0.3458040},
	{0.3724879,0.3663771,0.3544532},{0.3812247,0.3750532,0.3629275},{0.3897642,0.3835233,0.3712269},{0.3981022,0.3917922,0.3793547},
	{0.4062364,0.3998669,0.3873109},{0.4141690,0.4077542,0.3950954},{0.4219022,0.4154564,0.4027116},{0.4294424,0.4229759,0.4101594},
	{0.4367917,0.4303150,0.4174388},{0.4439523,0.4374784,0.4245531},{0.4509327,0.4444705,0.4315054},{0.4577416,0.4512938,0.4382991},
	{0.4643853,0.4579506,0.4449373},{0.4708661,0.4644455,0.4514185},{0.4771818,0.4707761,0.4577394},{0.4833344,0.4769425,0.4639098},
	{0.4893348,0.4829609,0.4699473},{0.4951937,0.4888452,0.4758586},{0.5009217,0.4946045,0.4816452},{0.5065318,0.5002482,0.4873120},
	{0.5120325,0.5057832,0.4928671},{0.5174282,0.5112141,0.4983202},{0.5227209,0.5165432,0.5036793},{0.5279149,0.5217752,0.5089478},
	{0.5330168,0.5269146,0.5141273},{0.5380285,0.5319639,0.5192209},{0.5429524,0.5369252,0.5242320},{0.5477947,0.5418010,0.5291637},
	{0.5525577,0.5465982,0.5340177},{0.5572414,0.5513224,0.5387973},{0.5618521,0.5559762,0.5435056},{0.5663964,0.5605617,0.5481442},
	{0.5708763,0.5650835,0.5527165},{0.5752951,0.5695465,0.5572289},{0.5796560,0.5739504,0.5616879},{0.5839612,0.5782976,0.5660950},
	{0.5882127,0.5825929,0.5704504},{0.5924117,0.5868372,0.5747555},{0.5965603,0.5910306,0.5790105},{0.6006585,0.5951732,0.5832152},
	{0.6047052,0.5992649,0.5873698},{0.6086994,0.6033045,0.5914709},{0.6126411,0.6072909,0.5955187},{0.6165302,0.6112230,0.5995146},
	{0.6203657,0.6151007,0.6034586},{0.6241486,0.6189264,0.6073509},{0.6278801,0.6227024,0.6111914},{0.6315601,0.6264297,0.6149817},
	{0.6351930,0.6301085,0.6187266},{0.6387851,0.6337411,0.6224311},{0.6423385,0.6373332,0.6260951},{0.6458545,0.6408917,0.6297186},
	{0.6493361,0.6444202,0.6333065},{0.6527867,0.6479174,0.6368652},{0.6562072,0.6513834,0.6403997},{0.6595999,0.6548217,0.6439066},
	{0.6629668,0.6582322,0.6473828},{0.6663069,0.6616114,0.6508314},{0.6696159,0.6649606,0.6542526},{0.6728906,0.6682821,0.6576413},
	{0.6761310,0.6715723,0.6609960},{0.6793381,0.6748244,0.6643192},{0.6825120,0.6780360,0.6676084},{0.6856495,0.6812117,0.6708579},
	{0.6887483,0.6843550,0.6740669},{0.6918097,0.6874625,0.6772395},{0.6948356,0.6905307,0.6803773},{0.6978272,0.6935630,0.6834778},
	{0.7007845,0.6965630,0.6865420},{0.7037086,0.6995294,0.6895753},{0.7066005,0.7024623,0.6925795},{0.7094624,0.7053651,0.6955522},
	{0.7122964,0.7082401,0.6984932},{0.7151025,0.7110862,0.7014068},{0.7178818,0.7139023,0.7042952},{0.7206343,0.7166906,0.7071570},
	{0.7233589,0.7194546,0.7099912},{0.7260567,0.7221932,0.7127970},{0.7287288,0.7249029,0.7155754},{0.7313741,0.7275836,0.7183278},
	{0.7339915,0.7302378,0.7210527},{0.7365810,0.7328665,0.7237493},{0.7391427,0.7354674,0.7264184},{0.7416764,0.7380395,0.7290591},
	{0.7441823,0.7405837,0.7316715},{0.7466603,0.7431003,0.7342556},{0.7491105,0.7455879,0.7368113},{0.7515338,0.7480466,0.7393403},
	{0.7539303,0.7504787,0.7418434},{0.7563000,0.7528865,0.7443190},{0.7586450,0.7552701,0.7467678},{0.7609665,0.7576282,0.7491932},
	{0.7632644,0.7599620,0.7515952},{0.7655386,0.7622732,0.7539720},{0.7677904,0.7645613,0.7563245},{0.7700196,0.7668252,0.7586544},
	{0.7722253,0.7690659,0.7609607},{0.7744079,0.7712846,0.7632428},{0.7765674,0.7734796,0.7655023},{0.7787039,0.7756498,0.7677399},
	{0.7808179,0.7777974,0.7699531},{0.7829093,0.7799219,0.7721421},{0.7849783,0.7820215,0.7743093},{0.7870247,0.7840986,0.7764538},
	{0.7890486,0.7861548,0.7785740},{0.7910511,0.7881891,0.7806723},{0.7930326,0.7902008,0.7827512},{0.7949927,0.7921917,0.7848090},
	{0.7969324,0.7941629,0.7868450},{0.7988529,0.7961134,0.7888608},{0.8007540,0.7980441,0.7908555},{0.8026353,0.7999570,0.7928284},
	{0.8044962,0.8018502,0.7947834},{0.8063373,0.8037231,0.7967215},{0.8081601,0.8055781,0.7986376},{0.8099653,0.8074146,0.8005320},
	{0.8117511,0.8092303,0.8024085},{0.8135166,0.8110269,0.8042664},{0.8152623,0.8128050,0.8061032},{0.8169886,0.8145629,0.8079207},
	{0.8186957,0.8163011,0.8097187},{0.8203834,0.8180202,0.8114948},{0.8220524,0.8197180,0.8132507},{0.8237021,0.8213937,0.8149872},
	{0.8253303,0.8230504,0.8167026},{0.8269366,0.8246886,0.8183978},{0.8285224,0.8263059,0.8200727},{0.8300901,0.8279019,0.8217258},
	{0.8316411,0.8294765,0.8233574},{0.8331750,0.8310302,0.8249692},{0.8346890,0.8325672,0.8265624},{0.8361816,0.8340897,0.8281390},
	{0.8376560,0.8355961,0.8297006},{0.8391175,0.8370850,0.8312460},{0.8405683,0.8385573,0.8327736},{0.8420083,0.8400139,0.8342846},
	{0.8434350,0.8414572,0.8357823},{0.8448439,0.8428901,0.8372694},{0.8462352,0.8443125,0.8387460},{0.8476136,0.8457212,0.8402097},
	{0.8489823,0.8471136,0.8416571},{0.8503404,0.8484910,0.8430868},{0.8516850,0.8498533,0.8445014},{0.8530130,0.8512000,0.8459044},
	{0.8543228,0.8525341,0.8472928},{0.8556154,0.8538548,0.8486633},{0.8568930,0.8551570,0.8500181},{0.8581556,0.8564407,0.8513567},
	{0.8594021,0.8577088,0.8526758},{0.8606325,0.8589601,0.8539771},{0.8618463,0.8601941,0.8552635},{0.8630435,0.8614142,0.8565337},
	{0.8642262,0.8626210,0.8577885},{0.8653961,0.8638128,0.8590311},{0.8665541,0.8649924,0.8602604},{0.8677014,0.8661610,0.8614755},
	{0.8688370,0.8673164,0.8626793},{0.8699591,0.8684598,0.8638714},{0.8710678,0.8695920,0.8650488},{0.8721642,0.8707101,0.8662130},
	{0.8732483,0.8718145,0.8673637},{0.8743194,0.8729071,0.8684991},{0.8753780,0.8739864,0.8696219},{0.8764238,0.8750524,0.8707339},
	{0.8774569,0.8761074,0.8718316},{0.8784785,0.8771509,0.8729152},{0.8794888,0.8781816,0.8739870},{0.8804879,0.8792002,0.8750475},
	{0.8814757,0.8802066,0.8760971},{0.8824523,0.8812024,0.8771345},{0.8834179,0.8821883,0.8781586},{0.8843730,0.8831623,0.8791721},
	{0.8853177,0.8841243,0.8801759},{0.8862516,0.8850760,0.8811676},{0.8871748,0.8860174,0.8821472},{0.8880871,0.8869475,0.8831154},
	{0.8889886,0.8878667,0.8840723},{0.8898796,0.8887742,0.8850186},{0.8907600,0.8896708,0.8859545},{0.8916298,0.8905578,0.8868786},
	{0.8924901,0.8914344,0.8877913},{0.8933406,0.8923001,0.8886940},{0.8941808,0.8931556,0.8895865},{0.8950110,0.8940010,0.8904693},
	{0.8958318,0.8948369,0.8913416},{0.8966432,0.8956637,0.8922025},{0.8974455,0.8964805,0.8930541},{0.8982387,0.8972869,0.8938973},
	{0.8990226,0.8980849,0.8947301},{0.8997970,0.8988747,0.8955522},{0.9005626,0.8996548,0.8963650},{0.9013196,0.9004250,0.8971684},
	{0.9020678,0.9011860,0.8979622},{0.9028066,0.9019380,0.8987464},{0.9035363,0.9026816,0.8995210},{0.9042576,0.9034166,0.9002858},
	{0.9049707,0.9041423,0.9010417},{0.9056752,0.9048590,0.9017889},{0.9063711,0.9055677,0.9025270},{0.9070587,0.9062688,0.9032558},
	{0.9077382,0.9069618,0.9039759},{0.9084100,0.9076459,0.9046881},{0.9090743,0.9083219,0.9053918},{0.9097307,0.9089906,0.9060864},
	{0.9103795,0.9096515,0.9067728},{0.9110201,0.9103047,0.9074519},{0.9116531,0.9109503,0.9081230},{0.9122790,0.9115881,0.9087858},
	{0.9128977,0.9122181,0.9094403},{0.9135086,0.9128409,0.9100871},{0.9141118,0.9134564,0.9107265},{0.9147077,0.9140644,0.9113583},
	{0.9152969,0.9146649,0.9119831},{0.9158794,0.9152582,0.9126005},{0.9164547,0.9158448,0.9132103},{0.9170230,0.9164245,0.9138126},
	{0.9175846,0.9169969,0.9144080},{0.9181389,0.9175621,0.9149970},{0.9186863,0.9181202,0.9155790},{0.9192273,0.9186717,0.9161534},
	{0.9197615,0.9192170,0.9167203},{0.9202891,0.9197551,0.9172813},{0.9208103,0.9202856,0.9178369},{0.9213250,0.9208103,0.9183853},
	{0.9218333,0.9213294,0.9189261},{0.9223358,0.9218416,0.9194608},{0.9228322,0.9223467,0.9199904},{0.9233223,0.9228461,0.9205140},
	{0.9238064,0.9233402,0.9210307},{0.9242851,0.9238283,0.9215409},{0.9247581,0.9243099,0.9220459},{0.9252249,0.9247856,0.9225462},
	{0.9256858,0.9252558,0.9230402},{0.9261416,0.9257207,0.9235271},{0.9265920,0.9261796,0.9240090},{0.9270366,0.9266325,0.9244864},
	{0.9274758,0.9270800,0.9249578},{0.9279098,0.9275224,0.9254229},{0.9283380,0.9279595,0.9258827},{0.9287608,0.9283912,0.9263373},
	{0.9291788,0.9288169,0.9267861},{0.9295919,0.9292372,0.9272294},{0.9299992,0.9296528,0.9276673},{0.9304011,0.9300634,0.9281002},
	{0.9307986,0.9304681,0.9285277},{0.9311916,0.9308677,0.9289496},{0.9315790,0.9312626,0.9293668},{0.9319610,0.9316530,0.9297788},
	{0.9323385,0.9320382,0.9301852},{0.9327117,0.9324183,0.9305866},{0.9330800,0.9327935,0.9309835},{0.9334439,0.9331643,0.9313751},
	{0.9338036,0.9335307,0.9317617},{0.9341587,0.9338927,0.9321441},{0.9345088,0.9342504,0.9325226},{0.9348547,0.9346039,0.9328964},
	{0.9351973,0.9349530,0.9332646},{0.9355362,0.9352978,0.9336279},{0.9358706,0.9356379,0.9339875},{0.9362006,0.9359738,0.9343431},
	{0.9365261,0.9363063,0.9346937},{0.9368471,0.9366351,0.9350397},{0.9371643,0.9369592,0.9353820},{0.9374783,0.9372786,0.9357195},
	{0.9377890,0.9375939,0.9360521},{0.9380954,0.9379057,0.9363803},{0.9383971,0.9382140,0.9367052},{0.9386948,0.9385185,0.9370265},
	{0.9389893,0.9388189,0.9373434},{0.9392805,0.9391154,0.9376557},{0.9395681,0.9394084,0.9379638},{0.9398520,0.9396977,0.9382682},
	{0.9401323,0.9399833,0.9385689},{0.9404089,0.9402654,0.9388660},{0.9406820,0.9405443,0.9391593},{0.9409518,0.9408195,0.9394485},
	{0.9412184,0.9410909,0.9397339},{0.9414815,0.9413590,0.9400157},{0.9417410,0.9416238,0.9402941},{0.9419973,0.9418851,0.9405688},
	{0.9422506,0.9421429,0.9408397},{0.9425007,0.9423974,0.9411071},{0.9427474,0.9426488,0.9413716},{0.9429910,0.9428973,0.9416325},
	{0.9432319,0.9431426,0.9418901},{0.9434701,0.9433845,0.9421448},{0.9437053,0.9436237,0.9423963},{0.9439374,0.9438603,0.9426444},
	{0.9441666,0.9440936,0.9428893},{0.9443926,0.9443237,0.9431310},{0.9446156,0.9445506,0.9433693},{0.9448357,0.9447743,0.9436042},
	{0.9450527,0.9449952,0.9438358},{0.9452668,0.9452132,0.9440647},{0.9454783,0.9454282,0.9442909},{0.9456876,0.9456407,0.9445140},
	{0.9458942,0.9458506,0.9447344},{0.9460983,0.9460580,0.9449524},{0.9462999,0.9462627,0.9451677},{0.9464989,0.9464649,0.9453801},
	{0.9466954,0.9466645,0.9455897},{0.9468893,0.9468616,0.9457966},{0.9470808,0.9470559,0.9460007},{0.9472699,0.9472477,0.9462021},
	{0.9474564,0.9474370,0.9464008},{0.9476404,0.9476238,0.9465968},{0.9478220,0.9478082,0.9467902},{0.9480012,0.9479902,0.9469811},
	{0.9481782,0.9481696,0.9471696},{0.9483531,0.9483465,0.9473554},{0.9485255,0.9485213,0.9475388},{0.9486955,0.9486940,0.9477199},
	{0.9488635,0.9488643,0.9478986},{0.9490294,0.9490324,0.9480750},{0.9491932,0.9491983,0.9482488},{0.9493548,0.9493622,0.9484202},
	{0.9495141,0.9495239,0.9485896},{0.9496714,0.9496835,0.9487567},{0.9498268,0.9498410,0.9489214},{0.9499802,0.9499964,0.9490839},
	{0.9501317,0.9501498,0.9492444},{0.9502812,0.9503012,0.9494029},{0.9504287,0.9504507,0.9495593},{0.9505744,0.9505983,0.9497136},
	{0.9507182,0.9507438,0.9498662},{0.9508602,0.9508873,0.9500166},{0.9510004,0.9510291,0.9501647},{0.9511387,0.9511690,0.9503110},
	{0.9512750,0.9513069,0.9504554},{0.9514096,0.9514431,0.9505977},{0.9515424,0.9515774,0.9507381},{0.9516734,0.9517100,0.9508766},
	{0.9518028,0.9518407,0.9510133},{0.9519306,0.9519696,0.9511481},{0.9520565,0.9520971,0.9512812},{0.9521806,0.9522228,0.9514127},
	{0.9523033,0.9523467,0.9515425},{0.9524248,0.9524688,0.9516703},{0.9525445,0.9525894,0.9517964},{0.9526623,0.9527086,0.9519211},
	{0.9527785,0.9528261,0.9520441},{0.9528936,0.9529418,0.9521653},{0.9530072,0.9530561,0.9522847},{0.9531190,0.9531690,0.9524026},
	{0.9532294,0.9532803,0.9525189},{0.9533384,0.9533901,0.9526335},{0.9534461,0.9534985,0.9527464},{0.9535522,0.9536054,0.9528581},
	{0.9536569,0.9537110,0.9529681},{0.9537604,0.9538151,0.9530765},{0.9538626,0.9539179,0.9531833},{0.9539632,0.9540194,0.9532889},
	{0.9540624,0.9541195,0.9533932},{0.9541606,0.9542182,0.9534959},{0.9542576,0.9543156,0.9535970},{0.9543532,0.9544117,0.9536968},
	{0.9544474,0.9545066,0.9537956},{0.9545404,0.9546003,0.9538930},{0.9546323,0.9546928,0.9539889},{0.9547231,0.9547841,0.9540834},
	{0.9548126,0.9548741,0.9541768},{0.9549009,0.9549629,0.9542689},{0.9549880,0.9550506,0.9543597},{0.9550739,0.9551372,0.9544491},
	{0.9551588,0.9552225,0.9545373},{0.9552424,0.9553068,0.9546244},{0.9553249,0.9553900,0.9547103},{0.9554063,0.9554720,0.9547951},
	{0.9554868,0.9555530,0.9548785},{0.9555661,0.9556328,0.9549611},{0.9556443,0.9557116,0.9550427},{0.9557216,0.9557894,0.9551230},
	{0.9557979,0.9558662,0.9552022},{0.9558731,0.9559421,0.9552805},{0.9559474,0.9560169,0.9553579},{0.9560208,0.9560907,0.9554340},
	{0.9560933,0.9561636,0.9555091},{0.9561649,0.9562356,0.9555833},{0.9562355,0.9563067,0.9556563},{0.9563054,0.9563768,0.9557283},
	{0.9563743,0.9564461,0.9557995},{0.9564423,0.9565145,0.9558697},{0.9565095,0.9565821,0.9559388},{0.9565759,0.9566487,0.9560069},
	{0.9566413,0.9567143,0.9560742},{0.9567060,0.9567791,0.9561403},{0.9567699,0.9568429,0.9562053},{0.9568327,0.9569058,0.9562697},
	{0.9568946,0.9569679,0.9563334},{0.9569557,0.9570292,0.9563960},{0.9570161,0.9570897,0.9564574},{0.9570759,0.9571491,0.9565183},
	{0.9571348,0.9572077,0.9565786},{0.9571930,0.9572658,0.9566379},{0.9572505,0.9573233,0.9566964},{0.9573072,0.9573801,0.9567543},
	{0.9573632,0.9574360,0.9568115},{0.9574186,0.9574913,0.9568679},{0.9574734,0.9575459,0.9569236},{0.9575274,0.9575998,0.9569785},
	{0.9575807,0.9576531,0.9570327},{0.9576333,0.9577057,0.9570862},{0.9576852,0.9577577,0.9571390},{0.9577365,0.9578091,0.9571911},
	{0.9577871,0.9578597,0.9572426},{0.9578372,0.9579098,0.9572933},{0.9578865,0.9579593,0.9573433},{0.9579353,0.9580083,0.9573927},
	{0.9579835,0.9580566,0.9574416},{0.9580311,0.9581043,0.9574898},{0.9580781,0.9581515,0.9575375},{0.9581245,0.9581982,0.9575845},
	{0.9581705,0.9582442,0.9576308},{0.9582157,0.9582896,0.9576767},{0.9582603,0.9583345,0.9577221},{0.9583045,0.9583787,0.9577668},
	{0.9583482,0.9584224,0.9578108},{0.9583913,0.9584656,0.9578542},{0.9584338,0.9585082,0.9578973},{0.9584757,0.9585502,0.9579399},
	{0.9585172,0.9585918,0.9579818},{0.9585583,0.9586328,0.9580232},{0.9585989,0.9586733,0.9580640},{0.9586389,0.9587132,0.9581044},
	{0.9586784,0.9587528,0.9581444},{0.9587175,0.9587918,0.9581838},{0.9587562,0.9588304,0.9582227},{0.9587944,0.9588686,0.9582611},
	{0.9588323,0.9589063,0.9582991},{0.9588697,0.9589436,0.9583368},{0.9589066,0.9589805,0.9583738},{0.9589432,0.9590170,0.9584104},
	{0.9589794,0.9590531,0.9584465},{0.9590151,0.9590887,0.9584822},{0.9590504,0.9591238,0.9585174},{0.9590853,0.9591587,0.9585522},
	{0.9591198,0.9591932,0.9585865},{0.9591539,0.9592273,0.9586205},{0.9591876,0.9592610,0.9586540},{0.9592210,0.9592943,0.9586872},
	{0.9592540,0.9593272,0.9587201},{0.9592866,0.9593599,0.9587526},{0.9593189,0.9593922,0.9587847},{0.9593508,0.9594241,0.9588164},
	{0.9593823,0.9594556,0.9588479},{0.9594135,0.9594867,0.9588791},{0.9594443,0.9595174,0.9589100},{0.9594747,0.9595478,0.9589405},
	{0.9595048,0.9595778,0.9589707},{0.9595346,0.9596075,0.9590007},{0.9595641,0.9596368,0.9590303},{0.9595933,0.9596658,0.9590598},
	{0.9596222,0.9596945,0.9590891},{0.9596507,0.9597230,0.9591181},{0.9596790,0.9597511,0.9591467},{0.9597071,0.9597789,0.9591750},
	{0.9597349,0.9598064,0.9592030},{0.9597622,0.9598337,0.9592308},{0.9597892,0.9598608,0.9592583},{0.9598160,0.9598876,0.9592853},
	{0.9598427,0.9599141,0.9593119},{0.9598690,0.9599403,0.9593383},{0.9598950,0.9599663,0.9593645},{0.9599208,0.9599922,0.9593904},
	{0.9599463,0.9600179,0.9594160},{0.9599716,0.9600434,0.9594413},{0.9599967,0.9600686,0.9594665},{0.9600217,0.9600935,0.9594913},
	{0.9600464,0.9601182,0.9595158},{0.9600707,0.9601427,0.9595403},{0.9600948,0.9601670,0.9595646},{0.9601186,0.9601911,0.9595887},
	{0.9601424,0.9602148,0.9596125},{0.9601660,0.9602383,0.9596360},{0.9601893,0.9602616,0.9596595},{0.9602123,0.9602847,0.9596828},
	{0.9602352,0.9603076,0.9597060},{0.9602578,0.9603302,0.9597290},{0.9602803,0.9603526,0.9597518},{0.9603026,0.9603748,0.9597744},
	{0.9603248,0.9603969,0.9597966},{0.9603468,0.9604188,0.9598188},{0.9603684,0.9604405,0.9598410},{0.9603899,0.9604621,0.9598630},
	{0.9604113,0.9604836,0.9598846},{0.9604327,0.9605049,0.9599060},{0.9604538,0.9605261,0.9599273},{0.9604748,0.9605471,0.9599486},
	{0.9604955,0.9605680,0.9599695},{0.9605161,0.9605888,0.9599903},{0.9605365,0.9606095,0.9600109},{0.9605567,0.9606299,0.9600314},
	{0.9605769,0.9606502,0.9600516},{0.9605970,0.9606704,0.9600716},{0.9606168,0.9606904,0.9600917},{0.9606364,0.9607104,0.9601117},
	{0.9606559,0.9607302,0.9601315},{0.9606754,0.9607499,0.9601512},{0.9606948,0.9607694,0.9601708},{0.9607140,0.9607888,0.9601904},
	{0.9607331,0.9608080,0.9602099},{0.9607520,0.9608271,0.9602293},{0.9607708,0.9608461,0.9602486},{0.9607895,0.9608649,0.9602679},
	{0.9608081,0.9608836,0.9602869},{0.9608265,0.9609022,0.9603059},{0.9608449,0.9609207,0.9603248},{0.9608631,0.9609391,0.9603437},
	{0.9608812,0.9609573,0.9603624},{0.9608993,0.9609756,0.9603810},{0.9609173,0.9609937,0.9603994},{0.9609352,0.9610117,0.9604178},
	{0.9609531,0.9610297,0.9604361},{0.9609708,0.9610476,0.9604543},{0.9609885,0.9610654,0.9604723},{0.9610061,0.9610832,0.9604903},
	{0.9610235,0.9611009,0.9605082},{0.9610410,0.9611184,0.9605260},{0.9610583,0.9611360,0.9605436},{0.9610756,0.9611535,0.9605612},
	{0.9610927,0.9611709,0.9605788},{0.9611098,0.9611881,0.9605964},{0.9611269,0.9612053,0.9606139},{0.9611438,0.9612225,0.9606313},
	{0.9611607,0.9612396,0.9606486},{0.9611775,0.9612566,0.9606660},{0.9611942,0.9612735,0.9606834},{0.9612108,0.9612904,0.9607007},
	{0.9612274,0.9613072,0.9607180},{0.9612440,0.9613239,0.9607351},{0.9612605,0.9613405,0.9607523},{0.9612769,0.9613571,0.9607694},
	{0.9612932,0.9613737,0.9607865},{0.9613095,0.9613903,0.9608035},{0.9613258,0.9614068,0.9608204},{0.9613420,0.9614233,0.9608373},
	{0.9613582,0.9614398,0.9608540},{0.9613743,0.9614562,0.9608707},{0.9613904,0.9614726,0.9608874},{0.9614065,0.9614890,0.9609040},
	{0.9614224,0.9615054,0.9609207},{0.9614383,0.9615217,0.9609373},{0.9614543,0.9615380,0.9609537},{0.9614703,0.9615541,0.9609700},
	{0.9614863,0.9615702,0.9609865},{0.9615021,0.9615863,0.9610030},{0.9615178,0.9616024,0.9610196},{0.9615336,0.9616185,0.9610361},
	{0.9615494,0.9616344,0.9610526},{0.9615653,0.9616503,0.9610690},{0.9615810,0.9616661,0.9610854},{0.9615967,0.9616820,0.9611020},
	{0.9616122,0.9616978,0.9611186},{0.9616277,0.9617135,0.9611351},{0.9616432,0.9617293,0.9611515},{0.9616587,0.9617450,0.9611679},
	{0.9616741,0.9617606,0.9611842},{0.9616895,0.9617763,0.9612005},{0.9617048,0.9617920,0.9612169},{0.9617201,0.9618077,0.9612332},
	{0.9617354,0.9618233,0.9612494},{0.9617508,0.9618388,0.9612657},{0.9617662,0.9618543,0.9612818},{0.9617815,0.9618699,0.9612980},
	{0.9617969,0.9618853,0.9613142},{0.9618122,0.9619007,0.9613305},{0.9618276,0.9619160,0.9613468},{0.9618430,0.9619312,0.9613630},
	{0.9618584,0.9619464,0.9613792},{0.9618738,0.9619617,0.9613954},{0.9618892,0.9619770,0.9614114},{0.9619045,0.9619923,0.9614276},
	{0.9619199,0.9620075,0.9614437},{0.9619352,0.9620229,0.9614598},{0.9619505,0.9620383,0.9614758},{0.9619658,0.9620537,0.9614918},
	{0.9619811,0.9620693,0.9615078},{0.9619963,0.9620848,0.9615238},{0.9620115,0.9621004,0.9615398},{0.9620266,0.9621161,0.9615558},
	{0.9620418,0.9621317,0.9615720},{0.9620568,0.9621474,0.9615882},{0.9620719,0.9621630,0.9616047},{0.9620870,0.9621787,0.9616211},
	{0.9621021,0.9621944,0.9616375},{0.9621173,0.9622102,0.9616541},{0.9621324,0.9622260,0.9616709},{0.9621475,0.9622418,0.9616879},
	{0.9621627,0.9622576,0.9617050},{0.9621780,0.9622735,0.9617222},{0.9621934,0.9622895,0.9617393},{0.9622089,0.9623056,0.9617565},
	{0.9622246,0.9623216,0.9617739},{0.9622403,0.9623377,0.9617915},{0.9622561,0.9623539,0.9618092},{0.9622722,0.9623702,0.9618269},
	{0.9622883,0.9623866,0.9618448},{0.9623047,0.9624030,0.9618628},{0.9623214,0.9624195,0.9618808},{0.9623383,0.9624362,0.9618987},
	{0.9623553,0.9624530,0.9619167},{0.9623725,0.9624700,0.9619349},{0.9623899,0.9624871,0.9619532},{0.9624075,0.9625044,0.9619714},
	{0.9624253,0.9625219,0.9619897},{0.9624435,0.9625396,0.9620079},{0.9624618,0.9625576,0.9620263},{0.9624803,0.9625758,0.9620449},
	{0.9624990,0.9625942,0.9620638},{0.9625179,0.9626129,0.9620829},{0.9625370,0.9626318,0.9621022},{0.9625563,0.9626510,0.9621217},
	{0.9625758,0.9626704,0.9621416},{0.9625954,0.9626899,0.9621618},{0.9626151,0.9627098,0.9621824},{0.9626349,0.9627301,0.9622034},
	{0.9626549,0.9627506,0.9622247},{0.9626750,0.9627712,0.9622465},{0.9626954,0.9627921,0.9622688},{0.9627158,0.9628132,0.9622916},
	{0.9627363,0.9628348,0.9623147},{0.9627570,0.9628564,0.9623382},{0.9627780,0.9628782,0.9623624},{0.9627990,0.9629001,0.9623871},
	{0.9628203,0.9629224,0.9624122},{0.9628417,0.9629450,0.9624375},{0.9628634,0.9629677,0.9624632},{0.9628854,0.9629906,0.9624893},
	{0.9629075,0.9630138,0.9625157},{0.9629298,0.9630375,0.9625422},{0.9629524,0.9630614,0.9625689},{0.9629753,0.9630858,0.9625956},
	{0.9629986,0.9631104,0.9626223},{0.9630221,0.9631354,0.9626493},{0.9630460,0.9631607,0.9626764},{0.9630702,0.9631862,0.9627037},
	{0.9630949,0.9632120,0.9627308},{0.9631199,0.9632381,0.9627580},{0.9631453,0.9632643,0.9627855},{0.9631710,0.9632904,0.9628134},
	{0.9631972,0.9633166,0.9628414},{0.9632235,0.9633430,0.9628697},{0.9632500,0.9633696,0.9628982},{0.9632768,0.9633964,0.9629269},
	{0.9633040,0.9634231,0.9629559},{0.9633314,0.9634497,0.9629855},{0.9633589,0.9634763,0.9630154},{0.9633863,0.9635033,0.9630457},
	{0.9634137,0.9635304,0.9630762},{0.9634413,0.9635573,0.9631072},{0.9634691,0.9635842,0.9631385},{0.9634970,0.9636110,0.9631702},
	{0.9635246,0.9636381,0.9632024},{0.9635522,0.9636654,0.9632349},{0.9635797,0.9636928,0.9632675},{0.9636075,0.9637202,0.9633002},
	{0.9636353,0.9637476,0.9633333},{0.9636629,0.9637752,0.9633668},{0.9636904,0.9638029,0.9634005},{0.9637179,0.9638308,0.9634341},
	{0.9637455,0.9638586,0.9634677},{0.9637732,0.9638864,0.9635016},{0.9638007,0.9639143,0.9635355},{0.9638283,0.9639423,0.9635692},
	{0.9638558,0.9639704,0.9636029},{0.9638834,0.9639987,0.9636365},{0.9639109,0.9640270,0.9636697},{0.9639385,0.9640555,0.9637027},
	{0.9639661,0.9640840,0.9637356},{0.9639937,0.9641127,0.9637682},{0.9640213,0.9641416,0.9638005},{0.9640489,0.9641705,0.9638327},
	{0.9640764,0.9641995,0.9638648},{0.9641041,0.9642283,0.9638966},{0.9641318,0.9642573,0.9639282},{0.9641595,0.9642863,0.9639594},
	{0.9641871,0.9643154,0.9639903},{0.9642149,0.9643444,0.9640209},{0.9642428,0.9643734,0.9640510},{0.9642707,0.9644026,0.9640808},
	{0.9642987,0.9644318,0.9641101},{0.9643268,0.9644611,0.9641391},{0.9643550,0.9644905,0.9641677},{0.9643832,0.9645198,0.9641960},
	{0.9644115,0.9645491,0.9642241},{0.9644398,0.9645784,0.9642519},{0.9644681,0.9646077,0.9642794},{0.9644965,0.9646370,0.9643066},
	{0.9645250,0.9646664,0.9643336},{0.9645536,0.9646957,0.9643601},{0.9645823,0.9647251,0.9643864},{0.9646112,0.9647546,0.9644123},
	{0.9646403,0.9647841,0.9644378},{0.9646696,0.9648136,0.9644630},{0.9646990,0.9648432,0.9644880},{0.9647286,0.9648728,0.9645128},
	{0.9647583,0.9649024,0.9645374},{0.9647881,0.9649320,0.9645620},{0.9648181,0.9649616,0.9645866},{0.9648483,0.9649913,0.9646111},
	{0.9648787,0.9650211,0.9646355},{0.9649092,0.9650510,0.9646598},{0.9649401,0.9650811,0.9646839},{0.9649713,0.9651114,0.9647079},
	{0.9650028,0.9651418,0.9647319},{0.9650347,0.9651724,0.9647561},{0.9650668,0.9652032,0.9647804},{0.9650992,0.9652344,0.9648046},
	{0.9651321,0.9652657,0.9648290},{0.9651655,0.9652972,0.9648537},{0.9651994,0.9653288,0.9648788},{0.9652337,0.9653606,0.9649041},
	{0.9652684,0.9653929,0.9649299},{0.9653036,0.9654255,0.9649560},{0.9653394,0.9654586,0.9649823},{0.9653757,0.9654922,0.9650089},
	{0.9654129,0.9655261,0.9650360},{0.9654508,0.9655604,0.9650636},{0.9654895,0.9655954,0.9650918},{0.9655288,0.9656313,0.9651204},
	{0.9655691,0.9656680,0.9651494},{0.9656107,0.9657051,0.9651789},{0.9656536,0.9657428,0.9652090},{0.9656978,0.9657812,0.9652399},
	{0.9657434,0.9658205,0.9652713},{0.9657902,0.9658608,0.9653033},{0.9658385,0.9659022,0.9653359},{0.9658884,0.9659447,0.9653690},
	{0.9659404,0.9659883,0.9654023},{0.9659943,0.9660330,0.9654361},{0.9660501,0.9660791,0.9654706},{0.9661079,0.9661269,0.9655055},
	{0.9661679,0.9661763,0.9655406},{0.9662304,0.9662275,0.9655761},{0.9662952,0.9662804,0.9656122},{0.9663627,0.9663349,0.9656489},
	{0.9664330,0.9663915,0.9656859},{0.9665056,0.9664505,0.9657235},{0.9665805,0.9665121,0.9657622},{0.9666580,0.9665762,0.9658020},
	{0.9667384,0.9666427,0.9658427},{0.9668216,0.9667117,0.9658845},{0.9669076,0.9667833,0.9659281},{0.9669960,0.9668579,0.9659739},
	{0.9670866,0.9669359,0.9660219},{0.9671796,0.9670173,0.9660721},{0.9672754,0.9671017,0.9661249},{0.9673739,0.9671894,0.9661804},
	{0.9674749,0.9672808,0.9662391},{0.9675783,0.9673758,0.9663012},{0.9676845,0.9674742,0.9663669},{0.9677932,0.9675762,0.9664366},
	{0.9679041,0.9676821,0.9665108},{0.9680175,0.9677917,0.9665897},{0.9681333,0.9679048,0.9666736},{0.9682517,0.9680216,0.9667627},
	{0.9683724,0.9681423,0.9668571},{0.9684955,0.9682666,0.9669570},{0.9686210,0.9683947,0.9670628},{0.9687489,0.9685265,0.9671745},
	{0.9688793,0.9686618,0.9672926},{0.9690123,0.9688005,0.9674171},{0.9691477,0.9689427,0.9675481},{0.9692854,0.9690883,0.9676855},
	{0.9694254,0.9692370,0.9678299},{0.9695677,0.9693884,0.9679812},{0.9697123,0.9695427,0.9681390},{0.9698593,0.9696996,0.9683033},
	{0.9700085,0.9698588,0.9684741},{0.9701598,0.9700202,0.9686513},{0.9703134,0.9701837,0.9688345},{0.9704694,0.9703488,0.9690235},
	{0.9706277,0.9705154,0.9692181},{0.9707882,0.9706837,0.9694176},{0.9709512,0.9708532,0.9696215},{0.9711168,0.9710236,0.9698292},
	{0.9712848,0.9711947,0.9700401},{0.9714552,0.9713668,0.9702532},{0.9716282,0.9715394,0.9704674},{0.9718040,0.9717123,0.9706822},
	{0.9719821,0.9718855,0.9708967},{0.9721625,0.9720594,0.9711093},{0.9723455,0.9722341,0.9713184},{0.9725306,0.9724092,0.9715235},
	{0.9727170,0.9725851,0.9717247},{0.9729033,0.9727624,0.9719212},{0.9730879,0.9729417,0.9721138},{0.9732695,0.9731221,0.9723046},
	{0.9734472,0.9733027,0.9724949},{0.9736200,0.9734828,0.9726862},{0.9737869,0.9736612,0.9728805},{0.9739480,0.9738373,0.9730776},
	{0.9741051,0.9740105,0.9732745},{0.9742588,0.9741807,0.9734699},{0.9744087,0.9743471,0.9736643},{0.9745554,0.9745098,0.9738563},
	{0.9747002,0.9746689,0.9740432},{0.9748432,0.9748245,0.9742238},{0.9749839,0.9749768,0.9743988},{0.9751228,0.9751255,0.9745672},
	{0.9752606,0.9752708,0.9747275},{0.9753971,0.9754127,0.9748799},{0.9755319,0.9755511,0.9750254},{0.9756651,0.9756859,0.9751640},
	{0.9757968,0.9758172,0.9752959},{0.9759266,0.9759449,0.9754224},{0.9760539,0.9760689,0.9755451},{0.9761783,0.9761890,0.9756651},
	{0.9762994,0.9763055,0.9757835},{0.9764171,0.9764184,0.9759011},{0.9765315,0.9765279,0.9760181},{0.9766420,0.9766348,0.9761354},
	{0.9767482,0.9767397,0.9762533},{0.9768510,0.9768427,0.9763712},{0.9769512,0.9769442,0.9764883},{0.9770490,0.9770448,0.9766044},
	{0.9771446,0.9771446,0.9767192},{0.9772389,0.9772438,0.9768324},{0.9773326,0.9773424,0.9769434},{0.9774258,0.9774407,0.9770521},
	{0.9775187,0.9775389,0.9771587},{0.9776115,0.9776367,0.9772639},{0.9777044,0.9777338,0.9773680},{0.9777980,0.9778303,0.9774707},
	{0.9778920,0.9779266,0.9775723},{0.9779860,0.9780227,0.9776737},{0.9780800,0.9781184,0.9777752},{0.9781744,0.9782136,0.9778768},
	{0.9782690,0.9783086,0.9779787},{0.9783634,0.9784036,0.9780810},{0.9784579,0.9784986,0.9781836},{0.9785524,0.9785935,0.9782866},
	{0.9786468,0.9786884,0.9783897},{0.9787410,0.9787835,0.9784933},{0.9788350,0.9788788,0.9785974},{0.9789289,0.9789742,0.9787015},
	{0.9790232,0.9790698,0.9788055},{0.9791177,0.9791658,0.9789093},{0.9792122,0.9792621,0.9790133},{0.9793068,0.9793587,0.9791174},
	{0.9794015,0.9794553,0.9792214},{0.9794963,0.9795520,0.9793255},{0.9795909,0.9796488,0.9794298},{0.9796856,0.9797455,0.9795341},
	{0.9797806,0.9798420,0.9796379},{0.9798757,0.9799384,0.9797416},{0.9799705,0.9800346,0.9798453},{0.9800650,0.9801308,0.9799491},
	{0.9801593,0.9802268,0.9800526},{0.9802537,0.9803225,0.9801558},{0.9803479,0.9804181,0.9802586},{0.9804418,0.9805135,0.9803611},
	{0.9805352,0.9806088,0.9804634},{0.9806284,0.9807039,0.9805655},{0.9807215,0.9807984,0.9806671},{0.9808146,0.9808926,0.9807681},
	{0.9809072,0.9809867,0.9808687},{0.9809996,0.9810806,0.9809690},{0.9810917,0.9811741,0.9810690},{0.9811836,0.9812671,0.9811691},
	{0.9812753,0.9813598,0.9812690},{0.9813666,0.9814524,0.9813686},{0.9814579,0.9815448,0.9814678},{0.9815489,0.9816371,0.9815666},
	{0.9816395,0.9817293,0.9816650},{0.9817299,0.9818215,0.9817631},{0.9818200,0.9819135,0.9818611},{0.9819101,0.9820051,0.9819590},
	{0.9820002,0.9820966,0.9820565},{0.9820902,0.9821879,0.9821537},{0.9821800,0.9822789,0.9822512},{0.9822697,0.9823696,0.9823483},
	{0.9823593,0.9824604,0.9824448},{0.9824487,0.9825510,0.9825409},{0.9825379,0.9826414,0.9826369},{0.9826267,0.9827317,0.9827330},
	{0.9827153,0.9828218,0.9828288},{0.9828040,0.9829117,0.9829245},{0.9828925,0.9830014,0.9830200},{0.9829808,0.9830912,0.9831155},
	{0.9830691,0.9831809,0.9832106},{0.9831575,0.9832703,0.9833054},{0.9832457,0.9833596,0.9834003},{0.9833336,0.9834486,0.9834953},
	{0.9834214,0.9835377,0.9835900},{0.9835092,0.9836269,0.9836839},{0.9835971,0.9837161,0.9837774},{0.9836850,0.9838051,0.9838708},
	{0.9837731,0.9838938,0.9839643},{0.9838610,0.9839823,0.9840580},{0.9839486,0.9840707,0.9841521},{0.9840357,0.9841592,0.9842466},
	{0.9841226,0.9842479,0.9843409},{0.9842095,0.9843367,0.9844348},{0.9842966,0.9844256,0.9845279},{0.9843842,0.9845144,0.9846204},
	{0.9844720,0.9846028,0.9847129},{0.9845598,0.9846911,0.9848058},{0.9846475,0.9847793,0.9848991},{0.9847353,0.9848676,0.9849923},
	{0.9848232,0.9849560,0.9850853},{0.9849111,0.9850446,0.9851784},{0.9849988,0.9851334,0.9852717},{0.9850863,0.9852224,0.9853652},
	{0.9851739,0.9853114,0.9854586},{0.9852615,0.9854005,0.9855519},{0.9853492,0.9854896,0.9856454},{0.9854370,0.9855789,0.9857389},
	{0.9855253,0.9856683,0.9858322},{0.9856142,0.9857575,0.9859253},{0.9857033,0.9858469,0.9860185},{0.9857923,0.9859366,0.9861120},
	{0.9858812,0.9860264,0.9862062},{0.9859703,0.9861165,0.9863007},{0.9860598,0.9862069,0.9863949},{0.9861496,0.9862977,0.9864890},
	{0.9862399,0.9863885,0.9865836},{0.9863303,0.9864794,0.9866787},{0.9864210,0.9865707,0.9867742},{0.9865119,0.9866624,0.9868700},
	{0.9866032,0.9867545,0.9869658},{0.9866945,0.9868469,0.9870621},{0.9867861,0.9869398,0.9871587},{0.9868783,0.9870331,0.9872552},
	{0.9869710,0.9871268,0.9873516},{0.9870643,0.9872211,0.9874480},{0.9871582,0.9873157,0.9875448},{0.9872526,0.9874107,0.9876424},
	{0.9873473,0.9875060,0.9877413},{0.9874424,0.9876017,0.9878414},{0.9875383,0.9876978,0.9879421},{0.9876351,0.9877944,0.9880429},
	{0.9877326,0.9878920,0.9881438},{0.9878308,0.9879906,0.9882449},{0.9879296,0.9880901,0.9883465},{0.9880289,0.9881905,0.9884489},
	{0.9881288,0.9882917,0.9885526},{0.9882296,0.9883936,0.9886570},{0.9883316,0.9884961,0.9887623},{0.9884347,0.9885992,0.9888687},
	{0.9885389,0.9887036,0.9889755},{0.9886442,0.9888094,0.9890823},{0.9887505,0.9889161,0.9891898},{0.9888575,0.9890235,0.9892990},
	{0.9889650,0.9891313,0.9894102},{0.9890732,0.9892395,0.9895233},{0.9891828,0.9893491,0.9896366},{0.9892941,0.9894608,0.9897488},
	{0.9894070,0.9895745,0.9898607},{0.9895212,0.9896897,0.9899743},{0.9896370,0.9898059,0.9900909},{0.9897545,0.9899225,0.9902111},
	{0.9898738,0.9900404,0.9903344},{0.9899951,0.9901610,0.9904589},{0.9901188,0.9902845,0.9905841},{0.9902453,0.9904107,0.9907101},
	{0.9903747,0.9905397,0.9908380},{0.9905067,0.9906711,0.9909692},{0.9906416,0.9908050,0.9911045},{0.9907799,0.9909423,0.9912426},
	{0.9909223,0.9910841,0.9913826},{0.9910686,0.9912303,0.9915261},{0.9912192,0.9913802,0.9916754},{0.9913746,0.9915341,0.9918312},
	{0.9915357,0.9916931,0.9919932},{0.9917034,0.9918590,0.9921603},{0.9918793,0.9920337,0.9923314},{0.9920644,0.9922177,0.9925077},
	{0.9922593,0.9924110,0.9926930},{0.9924644,0.9926143,0.9928904},{0.9926809,0.9928284,0.9931017},{0.9929108,0.9930548,0.9933268},
	{0.9931561,0.9932958,0.9935638},{0.9934183,0.9935523,0.9938123},{0.9936978,0.9938241,0.9940734},{0.9939925,0.9941120,0.9943472},
	{0.9942988,0.9944155,0.9946346},{0.9946135,0.9947305,0.9949359},{0.9949373,0.9950497,0.9952450},{0.9952718,0.9953660,0.9955494},
	{0.9956087,0.9956786,0.9958389},{0.9959273,0.9959913,0.9961155},{0.9962116,0.9962982,0.9963929},{0.9964743,0.9965751,0.9966773},
	{0.9967537,0.9968126,0.9969320},{0.9970574,0.9970463,0.9971249},{0.9973508,0.9973118,0.9973054},{0.9976187,0.9976047,0.9975593},
	{0.9978961,0.9979103,0.9979056},{0.9982352,0.9982442,0.9982684},{0.9986260,0.9986221,0.9986265},{0.9990234,0.9990234,0.9990234}
};

static const uint miedl = sizeof(mied)/sizeof(mied[0]);

inline void SamplingBasis(const sfloat4 &iv, sfloat4 *pb1, sfloat4 *pb2){
    //TODO: should probably handle zero-cases
    pb1->v[0] = -iv.v[2];
    pb1->v[1] = sfloat1::zero();
    pb1->v[2] = iv.v[0];
    pb1->v[3] = sfloat1::zero();
    *pb1 /= sfloat4::length3(iv.swizzle<0,3,2,3>()); //assume iv.w to be zero
    *pb2 = sfloat4::cross3(iv,*pb1);
}

namespace KernelSampler{

PhaseFunction::PhaseFunction(){
	//
}

PhaseFunction::~PhaseFunction(){
	//
}

HGPhase::HGPhase(float _g) : g1(_g){
	//
}

HGPhase::~HGPhase(){
	//
}

sfloat1 HGPhase::Evaluate(const sfloat1 &ct) const{
    sfloat1 g = sfloat1(g1);
    sfloat1 e = sfloat1(1.50f);
    return (1.0f-g*g)/(4.0f*SM_PI*sfloat1::pow(1.0f+g*g-2.0f*g*ct,e));
}

sfloat4 HGPhase::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
    sfloat1 g = sfloat1(g1);
    sfloat1 sq = (1.0f-g*g)/(1.0f-g+2.0f*g*u1);
    sfloat1 ct = (1.0f+g*g-sq*sq)/(2.0f*g);
    sfloat1 st = sfloat1::sqrt(sfloat1::max(1.0f-ct*ct,sfloat1::zero()));
    sfloat1 ph = 2.0f*SM_PI*u2;

    sfloat4 b1, b2;
    SamplingBasis(iv,&b1,&b2);
    sfloat1 sph, cph;
    sincos_ps(ph.v,&sph.v,&cph.v);
    return b1*st*cph+b2*st*sph+iv*ct;
}

HGPhase HGPhase::ghg(0.35f); //also panel.py description

MiePhase::MiePhase(){
	//
}

MiePhase::~MiePhase(){
	//
}

sfloat1 MiePhase::Evaluate(const sfloat1 &ct) const{
	sfloat1 a = sfloat1::acos(ct)/SM_PI;
	sfloat1 b = sfloat1((float)miedl*a);
	sfloat1 c = sfloat1::floor(b);
	c = sfloat1::min(c,(float)(miedl-1));
	sfloat1 t = b-c; //frac(b)
	dfloatN X = dfloatN(c);
	dfloatN MA, MB;
	for(uint i = 0; i < BLCLOUD_VSIZE; ++i){
		MA.v[i] = mied[(uint)X.v[i]+0].x;
		MB.v[i] = mied[(uint)X.v[i]+1].x;
	}
	sfloat1 ma = sfloat1::load(&MA);
	sfloat1 mb = sfloat1::load(&MB);

	return sfloat1::lerp(ma,mb,t);
}

sfloat4 MiePhase::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
	sfloat1 th;
	for(uint i = 0; i < miedl-1; ++i){
		//sfloat1 cdf0 = sfloat1(miecdf[i+0].x);
		sfloat1 cdf1 = sfloat1(miecdf[i+1].x);
		//sfloat1 t = u1-cdf0;
		//sfloat1 b = sfloat1((float)miedl*u1);
		sfloat1 m = sfloat1::Less(u1,cdf1);
		sfloat1 s = sfloat1((float)i/(float)miedl);
		th = sfloat1::Or(sfloat1::And(m,s),sfloat1::AndNot(m,th)); //TODO: interpolation
		if(m.AllFalse())
			break;
	}
	th *= sfloat1(SM_PI);
	sfloat1 ph = 2.0f*SM_PI*u2;

	sfloat4 b1, b2;
    SamplingBasis(iv,&b1,&b2);
	sfloat1 st, ct;
	sincos_ps(th,&st.v,&ct.v);
    sfloat1 sph, cph;
    sincos_ps(ph.v,&sph.v,&cph.v);
    return b1*st*cph+b2*st*sph+iv*ct;
}

MiePhase MiePhase::gmie;

BaseLight::BaseLight(){
	//
}

BaseLight::~BaseLight(){
	//
}

SunLight::SunLight(const dfloat3 *pd, const dfloat3 *pc, float _angle) : direction(*pd), color(*pc), angle(_angle){
	//
}

SunLight::~SunLight(){
	//
}

sfloat4 SunLight::Evaluate(const sfloat4 &rd) const{
	sfloat4 lc = sfloat1::zero();
	sfloat1 lt = sfloat1::Greater(sfloat4::dot3(rd,sfloat4(float4::load(&direction))),sfloat1(angle));

	float4 c = float4::load(&color);
	lc.v[0] = sfloat1::Or(sfloat1::And(lt,c.splat<0>()),sfloat1::AndNot(lt,lc.v[0]));
	lc.v[1] = sfloat1::Or(sfloat1::And(lt,c.splat<1>()),sfloat1::AndNot(lt,lc.v[1]));
	lc.v[2] = sfloat1::Or(sfloat1::And(lt,c.splat<2>()),sfloat1::AndNot(lt,lc.v[2]));

	return lc;
}

sfloat1 SunLight::Pdf(const sfloat4 &iv) const{
	sfloat1 ctm = sfloat1::sqrt(1.0f-angle*angle);
    return sfloat1(1.0f/(2.0f*SM_PI*(1.0f-ctm)));
}

sfloat4 SunLight::Sample(const sfloat4 &iv, const sfloat1 &u1, const sfloat1 &u2) const{
	//iv: light vector in this case
    //t = asin(theta = r/d)
    //cos(asin(t)) = sqrt(1-(r/d)^2)
    //sfloat1 u1 = RNG_Sample(prs);
    sfloat1 ctm = sfloat1::sqrt(1.0f-angle*angle);
    sfloat1 ct = (1.0f-u1)+u1*ctm;
    sfloat1 st = sfloat1::sqrt(1.0f-ct*ct);
    sfloat1 ph = 2.0f*SM_PI*u2;

    sfloat4 b1, b2;
    SamplingBasis(iv,&b1,&b2);
    sfloat1 sph, cph;
    sincos_ps(ph.v,&sph.v,&cph.v);
    return b1*st*cph+b2*st*sph+iv*ct;
}

}
